%%
%% This is file `manual/hicite.tex',
%% generated with the docstrip utility.
%%
%% The original source files were:
%%
%% src/intro.dtx  (with options: `doc')
%% src/parts.dtx  (with options: `intro')
%% src/quickstart.dtx  (with options: `doc')
%% src/prelims.dtx  (with options: `doc')
%% src/options.dtx  (with options: `doc')
%% src/parts.dtx  (with options: `references')
%% src/refs.dtx  (with options: `doc')
%% src/cparse.dtx  (with options: `doc')
%% src/names.dtx  (with options: `doc')
%% src/dates.dtx  (with options: `doc')
%% src/xref.dtx  (with options: `doc')
%% src/urls.dtx  (with options: `doc')
%% src/struct.dtx  (with options: `doc')
%% src/anonymous.dtx  (with options: `doc')
%% src/parts.dtx  (with options: `citations')
%% src/iface.dtx  (with options: `doc')
%% src/parse.dtx  (with options: `doc')
%% src/signals.dtx  (with options: `doc')
%% src/pages.dtx  (with options: `doc')
%% src/parens.dtx  (with options: `doc')
%% src/parts.dtx  (with options: `features')
%% src/toa.dtx  (with options: `doc')
%% src/endnotes.dtx  (with options: `doc')
%% src/short.dtx  (with options: `doc')
%% src/parts.dtx  (with options: `formatting')
%% src/draw.dtx  (with options: `doc')
%% src/abbrevs.dtx  (with options: `doc')
%% src/fonts.dtx  (with options: `doc')
%% src/state.dtx  (with options: `doc')
%% src/supra.dtx  (with options: `doc')
%% src/format.dtx  (with options: `doc')
%% src/parts.dtx  (with options: `alltypes')
%% src/caseref.dtx  (with options: `doc')
%% src/constrefs.dtx  (with options: `doc')
%% src/statrefs.dtx  (with options: `doc')
%% src/govrefs.dtx  (with options: `doc')
%% src/bookrefs.dtx  (with options: `doc')
%% src/artrefs.dtx  (with options: `doc')
%% src/foreignrefs.dtx  (with options: `doc')
%% src/specrefs.dtx  (with options: `doc')
%% src/otherrefs.dtx  (with options: `doc')
%% src/nondocrefs.dtx  (with options: `doc')
%% src/parts.dtx  (with options: `allparams')
%% src/genparams.dtx  (with options: `doc')
%% src/commparams.dtx  (with options: `doc')
%% src/caseparams.dtx  (with options: `doc')
%% src/legparams.dtx  (with options: `doc')
%% src/bookparams.dtx  (with options: `doc')
%% src/refparams.dtx  (with options: `doc')
%% src/parts.dtx  (with options: `support')
%% src/strings.dtx  (with options: `doc')
%% src/abbrev.dtx  (with options: `doc')
%% src/sortlist.dtx  (with options: `doc')
%% src/hibib.dtx  (with options: `doc')
%% src/parts.dtx  (with options: `appendix')
%% src/conclusion.dtx  (with options: `doc')
%% 
%% This is a generated file.
%% 
%% Copyright 2013-2023 Charles Duan. This program is free software: you can
%% redistribute it and/or modify it under the terms of the GNU General Public
%% License as published by the Free Software Foundation, either version 3 of the
%% License, or (at your option) any later version.
%% 
%% This program is distributed in the hope that it will be useful, but WITHOUT
%% ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
%% FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.
%% 
%% You should have received a copy of the GNU General Public License along with
%% this program.  If not, see <http://www.gnu.org/licenses/>.
%% 
%%
%% \iffalse filename: intro.dtx \fi
%%

\documentclass{ltxdoc}

\usepackage{hidoc}
\DisableCrossrefs
\PageIndex
\RecordChanges

\def\sec#1{section \ref{s:#1}}
\def\pt#1{Part \ref{p:#1}}
\def\partname{Part}

\title{\emph{Hereinafter}: A Legal Citation Program}
\author{Charles Duan\thanks{\textcopyright 2013-2023 Charles Duan. This manual
is made available under a Attribution-NonCommercial-ShareAlike 4.0 International
license. To view a copy of this license, visit
\url{http://creativecommons.org/licenses/by-nc-sa/4.0/} or send a letter to
Creative Commons, PO Box 1866, Mountain View, CA 94042, USA.}}

\begin{document}
\maketitle
\tableofcontents

\clearpage

\makeatletter

\clearpage
\part{Introduction}
\label{p:intro}
%%
%% \iffalse filename: intro.dtx \fi
%%

You've done the research, your stack of cases and articles is overflowing, the
ideas are swimming in your head, and are ready to start writing. But as you open
your document, a troubling question creeps in.

\emph{Will you format citations as you
write?} That will interrupt your train of thought every few minutes as you pull
out the style guide. And as you edit and rearrange, your citations
will need to be redone many times over. All those \emph{supra} and \emph{id.\@}
citations will quickly become out of place and perhaps unintelligible as you
polish the text.

\emph{Or will you put off citation formatting
for later?} In that case your coauthors and draft reviewers will see a mess of
an unfinished paper. And you'll have to reserve hours or days before submitting
for publication, to
slog through an unrewarding round of citation formatting.

\hia* offers a better way. With it, you can type citations in your writing
concisely and efficiently, but with all the features of
a rich legal citation system. You can edit and reorganize with almost no
need to manually update existing citations in your document. And you can
produce correctly formatted citations at any stage of the writing process, so
that
when you and others are reviewing drafts, you aren't distracted by incomplete
formatting.

I have been developing \hia* since I started law school in 2004. In the years
since, I have used it to format tens of thousands of citations in hundreds of
legal briefs, administrative comments, and journal articles. It produces tables
of authorities without hesitation and handles lengthy law review pieces without
difficulty. I can confidently polish my pieces right up to the deadline, knowing
that my \emph{supra} and \emph{id.}\ citations will still be perfect after a
recompile.

Most
importantly, when the computer handles the appearance of my writing, I get to
focus on the substance. This has made the writing process far more rewarding and
enjoyable. Have you ever read through one of your own drafts and thought,
``Part II.A really belongs after II.B, but it'll be too much trouble to fix
the footnotes''? I don't. \hia* lets me strive toward my best work, rather
than settling for the easy but imperfect.

To me, \hia* is an indispensable tool for legal writing.
I hope it will also become your choice hereinafter.

\section{Quick Start Guide}

This introductory guide will show the basic concepts you'll need to use \hia* to
add citations to your document. As with other automated citation systems, you
will need to do two things:
\begin{enumerate}
\item Define your references (cases, books, articles,
and so on) by entering bibliographic information for them.
\item Cite references by entering citation commands into your document.
\end{enumerate}

Importantly, these two steps do not need to be done in order. In my personal
workflow, I will often first write, entering citation commands for references
that I've read but have not defined. I find that this order preserves my train
of thought best. \hia* displays a list of undefined references and other missing
items at the end of document compilation, conveniently letting you know what
needs to be fixed.

\subsection{Prerequisites}

At this stage, I assume that you have general knowledge both of legal citation
and of the \LaTeX\ typesetting system. \hia* operates purely within \LaTeX, and
is controlled by commands described below in this manual.

To begin, you should include the package in the preamble of your document:
\begin{demo}
|\usepackage|\oarg{options}|{hicite}|
\end{demo}
The \meta{options} are described in \sec{options}. The most important of these
are the options \opt{review} and \opt{memo}, which determine whether the package
will follow the rules for law review articles or for legal memoranda,
respectively.

\subsection{Defining References}

A \emph{reference} is a single work of authority that you want to cite. In order
to cite a reference in \hia*, you must ``define'' it by entering key information
about the reference.

To define a reference, you will need to (1) choose a nickname
for the reference, (2) determine the type of reference, and (3)
identify the relevant bibliographic information for the type.
Part~\ref{p:alltypes} lists the available reference types; common ones are
\rtype{book}, \rtype{case}, \rtype{website}, and \rtype{jrnart} (journal
articles). The bibliographic information is entered as parameter-value pairs.
For example:
\begin{demo}
|\defcase{wheaton}{| \\
|    p=Wheaton,| \\
|    d=Peters,| \\
|    vol=33,| \\
|    rep=U.S.,| \\
|    page=591,| \\
|    year=1834,| \\
|}|
\end{demo}
defines a reference named |wheaton| for the famous lawsuit between two Supreme
Court reporters.

\hia* permits for various shortcuts to simplify the entry of references. The
following are equivalent to the above definition:
\begin{demo}
|\defcase{wheaton}{| \\
|    parties=Wheaton v. Peters,| \\
|    cite=33 U.S. 591,| \\
|    year=1834,| \\
|}| \\
|\defcase{wheaton}{| \\
|    Wheaton v. Peters, 33 U.S. 591 (1834)| \\
|}|
\end{demo}

There is also rich support for author names and dates. The following definition
shows how to enter a report with an individual author and an institutional
author:
\begin{demo}
|\defbook{ftc-pharma}{| \\
|    author=Markus H. Meier et al.,| \\
|    instauth=Federal Trade Commission,| \\
|    title=Overview of FTC Actions [...],| \\
|    date=june 2019,| \\
|}|
\end{demo}

For a more detailed overview of how to define references, see \sec{refs-syntax}
and the sections that follow. Shortcuts for reference entry are described in
\sec{cparse}, and authors and dates in \sec{names} and \sec{dates} respectively.
Example reference definitions are given in Part~\ref{p:alltypes}.

\subsection{Entering Citations}

To cite references in a document, the key commands are |\sentence| and
|\clause|, which produce sentence-style and clause-style citations. For law
review articles, these commands should be used in footnotes, and the |\note|
command creates a footnote with a sentence-style citation.

All of these commands receive a single argument of a citation string following a
syntax described in \sec{parse}. By design, the syntax looks like a simplified
legal citation. The following would generate a two-element string-cite to
\emph{Wheaton v.~Peters}, describing a (hypothetical) tension between two parts
of the decision:
\begin{demo}
|\sentence{|see, e.g., wheaton at 598 note 3 (Story, J.) (describing holding);
but see wheaton at 600-602 (noting alternative views)|}|.
\Produces
\emph{See, e.g.}, \emph{Wheaton v.~Peters}, 33 U.S. 591, 598 n.3
(1834) (Story, J.) (describing holding); \emph{but see} \emph{id.}~at 600--02
(noting alternative views).
\end{demo}

This example shows a number of notable features of \hia*. First, references are
always cited by identifier; any short or \emph{id.}~form is selected
automatically without user intervention. This means that citations are portable:
They largely can be moved around the document unchanged, simplifying
reorganizations of one's writing.

Second, there is rich support for signals, pin cites, and parentheticals in
citations. In particular, pin cites can involve page numbers, section numbers,
footnotes, and more, as described in \sec{pages}. They are abbreviated
automatically, as shown above. Parentheticals and signals are
also ordered, arranged, and formatted appropriately.

Third and perhaps most importantly, nearly all the formatting work is hidden
from the writer. Abbreviations, fonts, and keywords are automatically chosen to
conform to a given citation system. Importantly, this makes it easy to conform
an already-written document to another citation system. If one journal prefers
small caps but another does not, it is simple to produce different documents for
each.

\paragraph{Inline Citations}
In addition to sentence and clause citations, \hia* supports citing references
as parts of the text: naming a case as the subject of a sentence, for example.
The relevant commands are |\inline|, |\Inline|, |\adjective|, and |\Adjective|
depending on whether the reference is being cited at the beginning of a sentence
and the part of speech the reference is taking on:
\begin{demo}
|In \inline{wheaton}, the Court....| \\
|\sentence{wheaton at 603}.| \\
\Produces In \emph{Wheaton v.~Peters}, the Court\ldots. \emph{See} 33 U.S. 591,
603 (1834).
\end{demo}
Note how the |\sentence| citation automatically omits the case name because it
was displayed in with the previous |\inline| command.

For more on the parts and syntax of sentence, clause, and inline citations, see
Part~\ref{p:citations}.

\subsection{Additional Features}

Most of \hia* involves transforming reference definitions and citation commands
into formatted text. However, the package provides a few additional features of
interest: It can produce tables of authorities (see \sec{toa}), switch from
footnotes to endnotes (see \sec{endnotes}), and manage abbreviations in text
(see reference type \rtype{abbrev}).

Perhaps the most important additional feature is cross-references, described in
\sec{xref}. To mark a part of a document for cross-referencing:
\begin{demo}
|\hilabel{keypart}| \\
|This is the key part!| \\
|\hiendlabel{keypart}|
\end{demo}
The |\hilabel| command automatically chooses the best way to refer to the marked
section depending on where it is used (in a footnote, in a figure, or in plain
text). The |\hisectlabel| command can label sections by number.

To insert a cross-reference, simply use a citation to the predefined reference
\rtype{this} with the cross-reference label as the pincite:
\begin{demo}
|\sentence{see this at keypart}.|
\end{demo}
Again, the value of this cross-referencing system is that the cited numbers
automatically update as the document is edited, minimizing the amount of manual
updating.


\section{Structure of This Manual}

Besides simply describing how \hia* works, this manual is intended to explain my
conceptual framework for legal citation that is embedded in the system.
With that framework in mind, this manual on a
more practical level then teaches writers how to write citation input commands
that will produce formatted citations meeting their needs, and explains how
those inputs are formatted. As a result, it has three main objectives:
\begin{itemize}
\item Describing the data model behind \hia*'s legal citations
\item Specifying the input formats that writers must use
\item To a lesser extent, explaining the algorithms for producing formatted
citations
\end{itemize}

The manual is organized topically for different elements of legal citations,
with each section covering these three objectives of the data model, input
formats, and formatting algorithms (to the extent that each objective is
relevant). There are five parts:
\begin{enumerate}
\item How references are defined, including common parameters of references such
as authors and dates.
\item How citations are entered into documents.
\item General formatting algorithms used, such as keeping track of previous
citations for short forms.
\item All reference definition parameters.
\item All reference types.
\end{enumerate}

As currently written, this manual is primarily for writers of legal
documents who already have a baseline knowledge of legal citation, and
secondarily for software developers who wish to learn how the system works so
that they can modify it to produce different citation formats. It is not as
useful for learning how to format legal citations, as most citation manuals are.
First, it explains the formatting of citations in a manner that is useful to
programmers but probably confusing to human cite-checkers. \unskip\footnote{In
particular, a computer reads and formats citations sequentially, starting
from the beginning and never looking backwards, so at any given point it must
keep track of a great deal of information in memory about prior citations.
Computers do this easily, but a person would have to write copious and
error-prone notes to check the citations purely in forward order. A more
reasonable approach for a person would be to read the citations backwards to
find necessary information about previous citations.} Second, this manual does
not discuss the meanings of citation elements: It does not explain what citation
signals mean, when parentheticals are appropriate, or which edition of a book to
cite, for example.

It would not be difficult to revise this manual to address
these deficiencies and turn it into a guide on manual citation formatting, by
augmenting the data model sections to describe semantics and by rewriting the
formatting algorithm sections. Were that work to be done, the hope is that
presenting students with a data model and principles in tandem with formats
would offer them a clearer, enriched view of the seemingly arcane world of legal
citation.

\paragraph{Grammatical structures}
In many places, this manual describes expected inputs in terms of grammatical
structures. These are shown in blue boxes and use a version of Backus-Naur form.
\unskip\footnote{Spaces between items are not specified rigorously in these
grammars.}
For example:
\begin{grammar}
\meta{address} := \meta{number} \meta{street} [ \meta{apartment} ] \|
\littext{PO Box} \meta{number}
\end{grammar}
For those unfamiliar with this notation:
\begin{itemize}
\item The items between angle brackets represent text values, akin to entry
spaces in a form.
\item := means that the item on the left is defined to consist of the specified
items on the right.
\item \| means to choose either of the items to the left or right.
\item Square brackets [ ]  mean that the material inside is optional.
\item \underline{Underlined} text needs to be included literally.
\item ( \meta{item} )* means that whatever is inside the parentheses can be
repeated (or used once, or omitted entirely).
\end{itemize}

So to explain the above statement, an \meta{address} can take on two forms. It
can be a \meta{number} followed by a \meta{street} and optionally an
\meta{apartment} number, such as ``123 Elm Lane'' or ``15 Broadway \#5. Or it
can be a post office box like ``PO Box 123''. In general, grammatical
definitions will be followed by examples to help demonstrate what input is
expected.

In other cases, the manual will show expected inputs using a \LaTeX\ syntax:
\begin{grammar}
|\command|\oarg{option}\marg{required}
\end{grammar}
This means that the macro |\command| accepts an optional argument \meta{option},
surrounded by square brackets if present, and needs a mandatory argument
\meta{required}, surrounded by curly braces.

\paragraph{Documentation files}
This manual is one of two parts of documentation for \hia*. The package source
code is contained in multiple module files compiled into a unified main package,
and most chapters of this manual correspond to module files. The module files
are written as literate programming \LaTeX\ |.dtx| files, and contain further
documentation of the internal macros and implementation. For each chapter
having a corresponding module file, the filename is listed in the margin so that
the expanded documentation can be identified.

The manual alone should be sufficient for writers of legal documents to
understand how to use \hia*. The module file documentation is intended to help
package authors who wish to correct, modify, or extend the citation program
itself, perhaps to adapt it to other citation formatting regimes.

\section{Installation and Usage}

\hia* comprises a suite of files:
\begin{itemize}
\item The package file itself, \texttt{hicite.sty}.
\item Several auxiliary package files, described in \pt{support}.
\item Tables of abbreviations and other information.
\end{itemize}
All of these files need to be installed in a \TeX-accessible location.

To use the package, simply include it in a document:
\begin{demo}
|\usepackage|\oarg{options}|{hicite}|
\end{demo}
Then compile it using \LaTeX\ or an equivalent. No auxiliary programs are
needed, even for table indexing. However, multiple compilation runs may be
necessary in order to get cross-references and short citations to be correct.

If you have an existing Biblatex file, see \sec{hibib} for possible
compatibility options.

\section{Intellectual Property Concerns}

Over the years, there have been multiple disputes over intellectual property in
legal citation systems and manuals. It is both necessary to address both what
rights I claim as the author of \hia*, and what rights of others it implicates.

The source code of \hia* is released under the GNU General Public License (GPL)
version 3.0. That license applies to any executable code. The text of this
manual itself and all other documentation is released under a Creative Commons
license as described on the first page of the manual.
For purposes of clarity, the Creative Commons license applies to any text found
in this user manual and any text found in comments in the package source code;
the GPL license applies otherwise.

With respect to other legal citation manuals and systems, this software and
manual are not endorsed by, affiliated with, or authorized by any other legal
citation system, such as the Bluebook, the University of Chicago Manual of Legal
Citation (the ``Maroonbook''), the ALWD Guide to Legal Citation, or the Indigo
Book. It does not claim to be compatible with or identical to any of those
systems; indeed a design principle of \hia* is to be more flexible than any of
these existing systems. To the extent that material from existing citation
systems is used (primarily for tables of abbreviations), it has been taken from
the Indigo Book, which has been placed in the public domain.

%%
%% \iffalse filename: options.dtx \fi
%%
\input driver
\thisis{options}{Package Options}

The following options are accepted by this package.

\ExplainOption{review} Law review formatting: selects law review fonts, expects
footnotes, formats \emph{supra} cites with note numbers, and so on.


\ExplainOption{journal} Alias for \opt{review}.


\ExplainOption{journalfonts} Selects law review fonts. Same as
|\UseFontPack{review}|. Other formatting aspects are not changed.


\ExplainOption{memofonts} Selects legal memorandum fonts. Same as
|\UseFontPack{memo}|. Other formatting aspects are not changed.


\ExplainOption{memo} Legal memorandum formatting: selects memorandum fonts,
expects citations in text, and so on.


\ExplainOption{brief} Alias for \opt{memo}.


\ExplainOption{endnote} Uses endnotes rather than footnotes for formatting.


\ExplainOption{endnotes} Same as \opt{endnote}.


\ExplainOption{fullurl} URLs are displayed with their full text.


\ExplainOption{toaurl} URLs are displayed with their full text in the table of
authorities and a shortcut otherwise, as described in \sec{urls-appearance}.


\ExplainOption{linkurl} URLs are displayed as a linked word, as described in
\sec{urls-appearance}.


\ExplainOption{italcase} Case names are italicized regardless of font packs
previously chosen.


\ExplainOption{toastar} Stars are added to common references in the table of
authorities, as described in \sec{toa-star}.


\ExplainOption{somenotename} In general, if a case is named inline in text and
a citation to the case is made immediately thereafter, then the case name is
suppressed in the citation so as to avoid redundancy. This option makes an
exception where the citation to the case is the first citation in a footnote. In
such cases, the inline use was in text potentially distant from the footnote, so
naming the case again in the footnote is less redundant and potentially helpful
to readers.


\ExplainOption{nonotename} Suppresses case names even in citations at the
start of footnotes. This is typical of most legal journals.


\ExplainOption{useopturl} Redefines the \param{opturl} parameter to be the same
as \param{url}, as described in the documentation for the former parameter.


\ExplainOption{noterefs} Cross-references to text will refer to the closest
footnote numbers. This is typical of law reviews and is the standard when the
\opt{review} option is selected.


\ExplainOption{pagerefs} Cross-references to text will refer to the page
numbers on which the relevant text is found. This is typical of legal memoranda
and is the standard when the \opt{memo} option is selected.


\ExplainOption{noauthwarn} No warning will be issued if three or more authors
are given without the \param{noetal} parameter.

\part{References}
\label{p:references}
%%
%% \iffalse filename: refs.dtx \fi
%%
\input driver
\thisis{refs}{Defining References}

A reference represents a single citable work of authority. What constitutes a
single work may be uncertain, particularly for statutes and multi-authored
works, as described previously. The general test for whether two items are two
references or subdivisions of a single reference is whether, if they were cited
immediately in sequence, \emph{id.}\ should be used for the second item. In some
cases this is a matter of the writer's taste, so this package generally gives
writers the flexibility to define references however they see fit.

If a reference is used in a citation string but not defined, this package will
issue an error, or it will keep track of the missing citation. See \sec{draw}
for more information on missing references.

\subsection{Data Model}

Each reference consists of:
\begin{itemize}
\item A reference type, such as a book, case, or statute. The complete list of
reference types is given in Part~\ref{p:alltypes}. The reference type determines
how the reference is formatted and what parameters are necessary to define the
reference.

\item An identifier nickname that will be used to identify this reference in
citations (and, on occasion, inside other references). The nickname must be
unique and generally should not contain spaces.

\item Parameters providing information about the reference. For
example, a book uses parameters for the author, title, and publication year.
The reference type determines which parameters are required and optional; this
is documented in Part~\ref{p:alltypes}.
There are also parameters of general applicability to all reference types,
described in \sec{genparams}. The complete list of parameters
is given in Part~\ref{p:allparams}.
\end{itemize}

Each reference type is further associated with a category, used to organize a
Table of Authorities as described in \sec{toa}.
The category can be altered using the reference
definition parameter \param{citetype}.
The categories are associated with a textual
description that is used to assemble the headings for the table of authorities,
as described in \sec{toa}.


The following are the reference categories. The group associated with each
category is a label for the group in the table of authorities that the reference
will be placed together with (so, for example, statutes and regulations are
placed in the same category). The text associated with each category will be
used for the heading in the table of authorities.

\begin{demo}
\def\hi@newcitetype#1#2{\expandafter\hi@newcitetype@\string#1\@mark#2\@stop}
\expandafter\def\expandafter\hi@newcitetype@
    \string\hi@type@#1\@mark#2:#3\@stop{%
    #1&#2&#3\\%
}
\begin{tabular}{lll}
\textbf{Category} & \textbf{Group} & \textbf{Text} \\
\hline
\hi@newcitetype\hi@type@other{other:Other Source/s}
\hi@newcitetype\hi@type@const{const:Constitutional Provision/s}
\hi@newcitetype\hi@type@found{const:Foundational Document/s}
\hi@newcitetype\hi@type@statute{statute:Statute/s}
\hi@newcitetype\hi@type@regulation{statute:Regulation/s}
\hi@newcitetype\hi@type@rule{statute:Rule/s}
\hi@newcitetype\hi@type@case{case:Case/s}
\hi@newcitetype\hi@type@admin{case:Administrative Decision/s}
\hi@newcitetype\hi@type@treaty{statute:Treat/y/ies}
\end{tabular}
\end{demo}


\subsection{Input Syntax}
\label{s:refs-syntax}

The package provides its own syntax for writers to use when defining references.
As an alternative, \sec{hibib} describes a compatibility layer that
accepts Biblatex reference definitions, so long as the parameter names
correspond with those of this package.

Generally, references are defined as follows:
\begin{demo}
|\def|\meta{reference type} \marg{name} |{| \\
|    |\meta{param1} |=| \meta{value1}|,| \\
|    |\meta{param2} |=| \meta{value2}|,| \\
|    |\ldots \\
|}|
\end{demo}
For example, to define the historic case on copyrightability:
\begin{demo}
|\defcase{baker}{|\\
|    parties=Baker v. Selden,|\\
|    cite=101 U.S. 99,|\\
|    year=1880,|\\
|}|
\end{demo}
The input follows \TeX\ syntax and uses the |keyval| package, so if there are
equal signs or commas in the parameter values, then the parameter should be
surrounded with braces.

Entering the parameter names for every reference can be tedious, so for common
reference types there are shortcuts described in \sec{cparse}.


\subsection{Citation Groups}

\label{s:refs-citegroups}

\DescribeMacro\defcitegroup
Often there will be several references that follow a standard conventional form,
so it would be convenient to define all of them in one go. The |\defcitegroup|
macro enables this to an extent. It takes four arguments:
\begin{itemize}
\item (optional) A prefix for the reference nicknames to be defined, default
blank
\item A reference definer macro (|\def|\meta{type})
\item Initial text for the reference definition body
\item A comma-separated list of texts used both as the nickname and as a suffix
to the reference definition
\end{itemize}

For example, say you want to define references for several sections of the
Patent Act. That could be achieved with the following three definitions:
\begin{demo}
|\defstatcode{101}{35 U.S.C. S 101}| \\
|\defstatcode{102}{35 U.S.C. S 102}| \\
|\defstatcode{103}{35 U.S.C. S 103}| \\
\end{demo}
This works (using the reference parser for statutes) but is repetitive. Instead,
you can write:
\begin{demo}
|\defcitegroup\defstatcode{35 U.S.C. S }{101, 102, 103}|
\end{demo}
Each of the items in the comma-separated list (e.g., |101|) becomes both a
reference nickname and the end of the reference definition.

With the optional argument, the reference names can be given a prefix:
\begin{demo}
|\defcitegroup[17usc]\defstatcode{17 U.S.C. S }{101, 102, 103}|
\end{demo}
would define |17usc101| as the statute ``17 U.S.C. \textsection~101'' and so on.

%%
%% \iffalse filename: cparse.dtx \fi
%%
\input driver
\thisis{cparse}{Simplified Input}

While all references can be defined using the parameter-value input described
previously, that input is fairly verbose. To simplify the entry process, common
reference types accept an alternate form of input, in which the elements of the
reference are given in a citation-like string. The package parses that string to
extract parameters, thereby defining the reference.

To use this simplified input, ensure that the reference type is one of the types
listed in this section, and then enter the simplified input string in lieu of
the parameter-value pairs as follows:
\begin{demo}
|\defcase{baker}{|\\
|    Baker v. Selden, 101 U.S. 99 (1880)|\\
|}|
\end{demo}
Please ensure that the simplified input has no equal signs.
If there are additional parameters for the reference definition,
they may be entered after a semicolon as
follows:
\begin{demo}
|\defcase{baker}{|\\
|    Baker v. Selden, 101 U.S. 99 (1880);|\\
|    docket=No. 95|\\
|}|
\end{demo}

\subsection{Common Elements}

The simplified input formats use several common elements, described below.

\paragraph{Parentheticals} Text at the end of a formatted reference input
surrounded by parentheses is detected and interpreted as a parenthetical.
In the specifications for reference type parsers below, text matching this form
will be identified as content inside parentheses.


\paragraph{Volume/Reporter/Page}
Many of the reference type parsers will detect this pattern commonly found in
reported case citations and consecutively-paginated journal citations:
\begin{grammar}
\meta{volume} \meta{reporter} \meta{page} \grammarparen{date} \\
\Example |123 F.3d 456 (2000)|
\end{grammar}
Text matching this format can be detected and separated into parts, according to
the following algorithm:
\begin{enumerate}
\item If there is a parenthetical, then remove it and use it as the date.
\item The first word of the input is the volume.
\item If the second-to-last word is a division name (see \sec{pages}), then the
last two words are the page. Otherwise, just the last word is the page.
\item Any words remaining are the reporter/journal name.
\end{enumerate}
Alternatively, the volume, reporter, and page
elements can be separated with slashes (i.e.,
\meta{volume}/\meta{reporter}/\meta{page}).

In explaining reference inputs below, text matching this form will be identified
as \meta{vol-rep-page}.


\paragraph{Journal-Like Titles}

Many reference types can accept parseable input of the form:
\begin{grammar}
\meta{journal-text} := \meta{authors} \littext{, } \meta{title} \littext{, }
\meta{journal-id}
\\
\meta{authors} := \meta{author} [ \littext{ \& } \meta{author} ] \\
\Example |John Doe & Jane Q. Public, A Theory of Law, ...|
\end{grammar}
The \param{author} and \param{title} parameters are automatically set from this,
and
\meta{journal-id} is passed back to the reference type parser for further
analysis. In parsing this text, \meta{authors} is taken to be anything before
the first comma in the text, and \meta{journal-id} is text following the last
comma. (Thus, \meta{journal-text} must contain at least two commas.)

Text matching this form will be denoted as \meta{journal-text} in explaining the
parsers below, and those explanations will further describe how
\meta{journal-id} is used.


\paragraph{URLs} Any parseable reference input can have a URL appended to it,
set off with a comma. (The URL must start with |http://| or |https://|.) The URL
will be extracted from the input text and automatically set as parameter
\param{url}.
Because every parseable reference type will accept this, it is not shown in the
explanations below. The URL must be the last item in the parseable reference
input.


\subsection{Cases}

The \rtype{case} reference type can parse the following input syntax:
\begin{grammar}
\meta{case} := \meta{case-name} \littext{, } \meta{case-cite} \littext{(}
\meta{court} \meta{date} \littext{)} \\
\meta{case-name} := \meta{p} \littext{ v. } \meta{d} \| \meta{name} \\
\meta{case-cite} := \meta{vol-rep-page} \| \littext{No. } \meta{docket} \\
\Example |\defcase{wheaton}{Wheaton v. Peters, 33 U.S. 591 (1834)}|
\end{grammar}
This sets parameters \param{p} and \param{d} or \param{name} as the case party
name(s); \param{vol},
\param{rep}, and \param{page} or \param{docket} from the locator information
(detected as the last
pre-parenthetical text following a comma), and \param{court} and \param{date}
from the
parenthetical.


\subsection{Codified Statutes}

The \rtype{statcode} reference type can parse input
conforming to \meta{vol-rep-page}. For
example:
\begin{demo}
|\defstatcode{patent-eligibility}{35 U.S.C. S 101}|
\end{demo}


\subsection{Journal Articles}

The \rtype{jrnart} reference type can parse the following input syntax:
\begin{grammar}
\meta{jrnart} := \meta{journal-text} \grammarparen{date} \\
where \meta{journal-id} := \meta{cite} \\
\Example |\defjrnart{doe}{| \\
|    John Doe, Article, 12 Law Review 345 (1950)| \\
|}|
\end{grammar}
In other words, the start of the parseable input is used for parameters
\param{author} and \param{name},
as explained for \meta{journal-text} above. The text after the last comma before
the parenthetical is passed as the \param{cite} parameter, and the parenthetical
is interpreted as \param{year}.


\subsection{Websites and Magazines}

The \rtype{website} reference type can parse the following input syntax:
\begin{grammar}
\meta{website} := \meta{journal-text} \grammarparen{date} \\
where \meta{journal-id} := \meta{rep} \\
\Example |\defmagart{doe}{| \\
|    John Doe, Latest Memes, Slate (June 5 2000)| \\
|}|
\end{grammar}
In other words, a parseable website reference input is just like a journal
article except without a volume or page number; anything following the title is
passed to the parameter \param{rep} to be used as a journal title.

Magazines (\rtype{magart})
are identical except a page number is given after the magazine title:
\begin{grammar}
\meta{journal-id} := \meta{rep} \meta{page} \\
\Example |\defmagart{doe}{| \\
|    John Doe, Politics, Newsweek 16 (June 5 2000)| \\
|}|
\end{grammar}
As a result, the parseable
reference input for magazines does \emph{not} look like conventional magazine
citations, which typically set the date with a comma after the magazine title,
rather than putting the date in a parenthetical.


\subsection{Books}
The \rtype{book} reference type can parse the following input syntax:
\begin{grammar}
\meta{book} := \meta{authors} \littext{, } \meta{name} \grammarparen{date} \\
\Example |\defbook{blackstone}{| \\
|    William Blackstone, Commentaries on the Laws of England (1765)| \\
|}|
\end{grammar}
where \meta{authors} is as defined above with respect to \meta{journal-text}
(i.e., one author or two separated with an ampersand).


\subsection{Court Documents}
The \rtype{courtdoc} reference type can parse the following input syntax:
\begin{grammar}
\meta{courtdoc} := \meta{name} \grammarparen{date} \\
\Example |\defcourtdoc{motion}{Motion for Leave (June 5 2000)}|
\end{grammar}


\subsection{Abbreviations}

The \rtype{abbrev} reference type can parse the following input syntax:
\begin{grammar}
\meta{abbrev} := \meta{name} \grammarparen{inline} \\
\Example |\defabbrev{fda}{| \\
|    the Food and Drug Administration (the FDA)| \\
|}|
\end{grammar}
In other words, the full text is before the parentheses and the abbreviation
inside them.


\subsection{The \texttt{cite} Parameter}

The parameter \param{cite} accepts as input a string conforming to
\meta{vol-rep-page} described above. It sets the parameters \param{vol},
\param{rep}, \param{page}, and possibly \param{year}.

%%
%% \iffalse filename: names.dtx \fi
%%
\input driver
\thisis{names}{Authors and Other Names}

\hia* offers comprehensive support for lists of names in references, such as
authors and editors. Among other things, it provides for both personal and
institutional authors, optional list truncation with ``et al.,'' and formation
of last-name lists for short citations.

To enter a list of names for a reference, include the appropriate parameter
(e.g., \param{author} or \param{instauth}) once for each name in the list. The
names will automatically be compiled into a formatted list. Every name entered
will be listed, although a warning will be issued unless the \param{noetal}
parameter is included or the \opt{noauthwarn} option is given for the package.
To truncate a list, enter only the initial name with ``et
al.''\ attached to the end. For example:
\begin{demo}
|\defbook{nimmer}{| \\
|    author=Melville B. Nimmer, author=David Nimmer, ...| \\
|}| \\
|\defjrnart{als}{| \\
|   noetal, author=John R. Allison, author=Mark A. Lemley,| \\
|   author=David L. Schwartz, ...| \\
|}| \\
|\defjrnart{als}{author=John R. Allison et al., ...}|
\end{demo}

The remainder of this section provides details on how \hia* parses and uses name
lists, and how to fine-tune those processes.

\subsection{Data Model}

A name list is an ordered sequence of one or more names, each of which is
either a personal name and an institutional name.
\unskip\footnote{To avoid questions of what constitutes personhood (e.g.,
AI-authored works), a ``personal name'' is one that has a family-name component
and would not be abbreviated in citations.}
An institutional name is simple text, although it is abbreviated in citations.
A personal name, by contrast, consists of five parts:
\begin{itemize}
\item The given name, which includes the middle initials or names. This is the
only mandatory part.

\item The family name. If only one name is given (e.g., Aristotle), it is
treated as a given name, and the short-form name instead uses the given name.

\item Suffix to the family name, such as Jr.\ or III. It should not be included
in the last-name-only forms.

\item The institution.

\item An ``et al.''\ indicator for abbreviating the author list.
\end{itemize}
Separating these parts is necessary, for example, to enable short citations
using just the author's last name.

Institutional affiliations attached to personal names are distinct from
institutional names included in a name list.
Consider, for example, a government report written by Al Anderson
at the Federal
Trade Commission and Bob Baker at the Department of Justice. If the report
expresses
the views of the agencies, then the agencies could be included as authors:
\begin{demo}
Al Anderson \& Bob Baker, Fed.~Trade Comm'n \& Dep't of Justice
\end{demo}
By contrast, if the report represents the views of the individuals in their
official capacities but not necessarily the views of the agencies, then only the
individuals should be authors, with their affiliations attached to their names:
\begin{demo}
Al Anderson, Fed.~Trade Comm'n \& Bob Baker, Dep't of Justice
\end{demo}
Providing these options gives
writers more flexibility to cite mixed personal and institutional authors to
convey
accurate and useful information.


\subsection{Inputs}

For each type of name list, there will be two reference definition parameters,
one for personal names and one for institutions:
\begin{demo}
\catcode`\|=12
\begin{tabular}{l|ll}
& \textbf{Personal} & \textbf{Institutional} \\
\hline
Authors & \param{author} & \param{instauth} \\
Editors & \param{editor} & \param{insted} \\
Letter recipients & \param{to} & \param{instto} \\
\end{tabular}
\end{demo}

Institutional authors are given simply as an unabbreviated name; the package
handles abbreviation. If an ``et al.''\ is desired after an institutional
author, that may be appended to the name. It is treated as if it were part of
the institution's name and not processed further.

Because personal authors have five component parts that need to be analyzed
individually, they must be given in a specific format. An institutional
affiliation is always any part of a name following a comma. To separate the
given name, family name, and suffix, the most explicit way is to surround the
family name and name suffix with curly braces:
\begin{grammar}
\meta{name} := \meta{given-name} \\
\qquad[ \littext{ \{} \meta{family-name}
    [ \littext{ \{} \meta{suffix} \littext{\}} ]
  \littext{\}}
] \\
\qquad[ \littext{, } \meta{institution} ] \\
\qquad[ \littext{et al.} ]
\Examples
\texttt{John \{Marshall\}} \\
\texttt{Fiona \{Scott Morton\}} \\
\texttt{Nicholson \{Price \{II\}\}} \\
\texttt{Oliver Wendell \{Holmes \{Jr.\}\}, Massachusetts Supreme Judicial Court}
\end{grammar}
Regarding the last two items,
some style guides prefer a comma before the name
suffix. \hia* does not explicitly support this, but with a preceding comma the
name suffix would be treated as an institutional affiliation, which produces
desirable results.

Because including the braces around family names is cumbersome, this package can
infer name parts with a few heuristics, such that no braces are required.


\paragraph{Family names.} When no braces delimit the family name, the package
first looks for nobiliary particles that indicate a family name: von, van, de,
and so on. If that succeeds, it removes suffixes from the family name, thereby
separating all the components. If there is no nobiliary particle, then the
package first removes suffixes from the whole name, and takes whatever is the
last word in the remaining name as the family name.


\paragraph{Name suffixes.} When no braces delimit the suffix, the package looks
for common suffixes (Jr., Sr., and roman numerals through X). The first such
suffix found is treated as a name suffix.

To see this automatic parsing in action, consider the following name input,
which would be parsed as follows:
\begin{demo}
\texttt{author=\{Georg von Trapp Jr., Family Singers\}}
\vskip\baselineskip
\begin{tabular}{lp{0.6\textwidth}}
|Georg| & Given name \\
|von Trapp| & Family name, based on the nobiliary particle ``von'' \\
|Jr.| & Name suffix, as it is on the list of common suffixes \\
|Family Singers| & Institutional affiliation, as it follows a comma \\
\end{tabular}
\end{demo}


\subsection{Formatting}

Once names have been read and separated into component parts, the
package arranges and assembles those names into text amenable to inclusion in a
citation. There are two matters to address here: Formatting the text of each
name, and arranging and punctuating the list.

In terms of name formatting, the primary task is to abbreviate institutional
names and affiliations.
As a convenience, the package also checks that personal names ``look''
correct, in that they should not contain institution-like words such as ``and''
or ``Corp.''


With regard to arrangement and punctuation, the following rules apply. First, as
noted above, the list of names is separated into two sublists: a list of
personal names
and a list of institutional names. For each sublist, the last name
is delimited by an ampersand and every other name is delimited by a comma. An
``et al.''\ can apply to either the personal name list or the institutional
name list. Finally, if both lists contain entries, they are joined by a comma.
For example:
\begin{itemize}
\item Author One, Author Two \& Author Three (a coauthored work)
\item Author One et al. (alternative to above example)
\item Author One et al., Inst. (a work written by several people at a
single institution)
\item Author One, Inst.\ et al.\ (a work written by one person on behalf of
several institutions)
\item Author One \& Author Two, Inst.\ One \& Inst.\ Two (a joint
report)
\end{itemize}


\paragraph{Using Partial Lists.} Some citation systems place the institutional
names in a different place from the personal names. This package provides
infrastructure for separating out these sublists, although it is not used in the
package itself.

%%
%% \iffalse filename: dates.dtx \fi
%%
\input driver
\thisis{dates}{Dates}

Nearly every reference cited in a legal document must be dated.
\unskip\footnote{The main exceptions are for in-force codified statutes, assumed
to be dated as of the time of the writer's publication, and well-known timeless
works for which a date is immaterial, such as the Bible, Blackstone,
Shakespeare, and the \emph{Federalist} papers.} \hia* supports a wide variety of
date specifications, in view of the many types of legal documents and the
frequency with which historical documents are cited in legal research.

Typical legal citation systems have specific rules about the form of date to use
with different reference types. \hia* does not enforce such rules, instead using
a single date syntax in all places where dates are used. As a result, it is left
to the discretion of writers to choose, for example, whether to include an exact
date or just a year for any reference.

Dates may be entered in a variety of formats, so long as the month is spelled
out in letters. The key additional feature of \hia* dates is support for
``qualifier words,'' namely phrases that precede the date and explain its
relevance. Qualifier words are considered part of the date and thus may be
included in any place where a date is allowed; indeed, qualifier words are
required in certain contexts.

\subsection{Data Model}

A date contains the following components:
\begin{itemize}
\item A year. This is the only required component. The phrase ``n.d.''\ can be
used for undated references. It may be a range.

\item Qualifier words preceding the date and explaining its relevance to the
reference. For example, ``submitted for ratification Sept.~17, 1787'' includes
qualifier words ``submitted for ratification'' that explain the relevance of the
given date. Typical qualifier words are verbs
ending in ``ed,'' though any text preceding a number or keyword will be
considered part of the qualifier. Qualifier words are useful, for example, when
citing to cases still in litigation (e.g., ``cert.\ granted, \meta{date}'').

\item A month and date number. They may also be ranges. The
month can also be a season.

\item Modifiers such as ``c.''\ for circa, ``A.D.,'' ``A.C.E.,'' ``B.C.'', and
``B.C.E\@.''
\end{itemize}

\subsection{Input Syntax}

Dates are entered, generally as parameters to references, as follows:
\begin{grammar}
\meta{date} := [ \meta{qualifier} ] ( \meta{date-range} \| \meta{date-word} \|
\meta{modifier} )*
\\
\meta{date-range} := \meta{date-word} \littext{-} \meta{date-word} \\
\meta{date-word} := \meta{month} \| \meta{day} \| \meta{year}
\\
\Examples |2009|\\
|sept-oct 1980|\\
|adopted july 4 1776|\\
|c. 538 BC|
\end{grammar}
In other words, a date consists of qualifier words followed by one or more
tokens that may be either date words or ranges of date words.
\unskip\footnote{Technically by this syntax, a range can consist of two
unrelated date words---\meta{month}-\meta{day} for example. However, the parser
may interpret that construction in unexpected ways.}
Date words of letters are interpreted as months or modifier words, while date
words of numbers are interpreted as days or years.
Punctuation is ignored other than dashes, used for ranges. Modifiers such as
``A.C.E.'' and ``n.d\@.'' should be entered with no dots (i.e., |ACE|, |ace|,
|nd|).

Alternately, a date beginning with |!| will be used unformatted.


\paragraph{Permissible Words}
The following are permissible words in dates.

\begin{demo}
\def\hi@setup@month#1#2{\texttt{#2}&#1\\}
\begin{tabular}{ll}
\textbf{Date Word Input} & \textbf{Output} \\
\hline
\hi@setup@month{Jan.}{jan, Jan, January, january}
\hi@setup@month{Feb.}{feb, Feb, February, february}
\hi@setup@month{Mar.}{mar, mar, Mar, March, march}
\hi@setup@month{Apr.}{apr, apr, Apr, April, april}
\hi@setup@month{May}{may, May}
\hi@setup@month{June}{june, June, jun, Jun}
\hi@setup@month{July}{july, July, jul, Jul}
\hi@setup@month{Aug.}{aug, Aug, August, august}
\hi@setup@month{Sept.}{sept, Sept, sep, Sep, september, September}
\hi@setup@month{Oct.}{oct, Oct, october, October}
\hi@setup@month{Nov.}{nov, Nov, november, November}
\hi@setup@month{Dec.}{dec, Dec, december, December}
\hi@setup@month{Winter}{winter, win, Winter, Win}
\hi@setup@month{Summer}{summer, sum, summ, Summer, Sum, Summ}
\hi@setup@month{Fall}{fall, Fall}
\hi@setup@month{Spring}{spring, spr, Spring, Spr}
\texttt{c, circa} & c.\ [circa]    \\
\texttt{nd}       & n.d.\ [no date]\\
\texttt{ad, AD}   & A.D.           \\
\texttt{bc, BC}   & B.C.           \\
\texttt{ace, ACE} & A.C.E.         \\
\texttt{bce, BCE} & B.C.E.         \\
\end{tabular}
\end{demo}


\DescribeMacro\AD
\DescribeMacro\BC
\DescribeMacro\BCE
\DescribeMacro\ACE
The actual text for the latter few abbreviations can be redefined with |\AD|,
|\BC|, |\BCE|, and |\ACE|.

%%
%% \iffalse filename: xref.dtx \fi
%%
\input driver
\thisis{xref}{Cross-References}

\hia* offers comprehensive support for cross-references in citations. The model
is conceptually similar to \LaTeX, in which the writer uses commands to label
parts of the document and then references those labels. However, legal citation
requires and \hia* supports much more complex cross-referencing. It is possible
to label ranges of a document in addition to specific points, and the package
automatically determines the best wording to describe the labeled regions. More
importantly, use of cross-references is integrated into the citation system, so
cross-references can include signals, parentheticals, and other features of
citations.

\subsection{Types of Cross-References}

A cross-reference citation points to another part of the document, but the
writer must specify whether that other part is a page, footnote, section, or
other element of the document. Thus, the package must support different types of
cross-references. The following types are currently supported.

\begin{itemize}
\item Points in or ranges of body text. In legal memoranda, these are cited by
the page numbers where the range lies. For law review articles, they are cited
with reference to the footnote numbers that the range encompasses.

\item Footnotes, cited by the footnote number or range of numbers.

\item Sections, cited by the fully qualified section number (e.g., ``Section
II.A.3'').

\item Floats (tables or figures), cited by the float type and number (e.g.,
``Figure 3'').
\end{itemize}

\subsection{Labeling Document Parts}

The following commands are used to mark parts of a document with labels.

\DescribeMacro\hilabel
\cmd\hilabel\oarg{text}\marg{label} labels the current point in text. It detects
whether it is inside a footnote, table, figure, or body text, and adjusts the
label accordingly.

\DescribeMacro\hiendlabel
\cmd\hiendlabel\marg{label} closes a labeled range opened with |\hilabel|. Note
that the type of text marked at the beginning and end must be the same (e.g.,
|\hilabel| called in a footnote cannot be followed by |\hiendlabel| in body
text). Currently, only contiguous ranges can be labeled, although a desirable
additional feature for the package would be support for non-contiguous
cross-reference ranges.

\DescribeMacro\hitanlabel
\DescribeMacro\hiendtanlabel
\DescribeMacro\hiflabel
\DescribeMacro\hinotelabel
Particularly for law review articles, it is sometimes desirable to
cross-reference ``notes $x$--$y$ and accompanying text.'' This is done with
\cmd\hitanlabel\ and \cmd\hiendtanlabel. There are also provided commands
|\hiflabel| and |\hinotelabel| for labeling floats and footnotes, respectively.


\DescribeMacro\hisectlabel
\cmd\hisectlabel\marg{label} labels the current section.
\DescribeMacro\hiendsectlabel
\cmd\hiendsectlabel\marg{label} labels an end of a section range.

For law review articles, top-level cross-references will use the word ``Part''
while other cross-references will use ``Section.'' (The distinction is
determined by whether the section number contains a dot.) For legal memoranda,
``Section'' will always be used. To change this, redefine the internal macro
|\hi@xref@sect@choose|.


\subsection{Using Cross-References}

The ordinary citation commands are used to produce a cross-reference citation,
using the pseudo-reference \rtype{this} with the ``page number'' being the
cross-reference label. For example, assuming that |section-i| is defined as a
label:
\begin{demo}
\ttfamily
|\sentence|\{see this at section-i (providing background)\}.
\end{demo}
As this example suggests, cross-reference citation items can include
parentheticals and signals, just like ordinary citation items.

Cross-references to floats and sections can also be used inline, producing text
like ``Figure $X$.'' Again, the syntax mirrors inline citations for other
references:
\begin{demo}
\ttfamily
Data is shown in |\inline|\{this at section-i\}.
\end{demo}

%%
%% \iffalse filename: urls.dtx \fi
%%
\input driver
\thisis{urls}{URLs}

Every reference type can include a URL. \hia* formats URLs, makes them clickable
links, and inserts line breaks into them. In that last respect, \hia*'s
procedure is superior to other \LaTeX\ URL packages, which fail when a
hyperlinked URL in a footnote breaks across a page, a common occurrence for law
review articles.

\subsection{Input Syntax}

The \param{url} and \param{opturl} parameters add a URL to a reference. The URL
should be entered as unformatted text, except that percent signs should be
escaped with backslashes to avoid being interpreted as comment symbols.

URLs will allow line breaks after main punctuation, similar to the package
|url.sty|. \unskip\footnote{An exception is for the percent sign, where the line
break will be inserted \emph{before} the symbol, so that URL-encoded entities
are kept intact.}
If there is a long string of alphanumeric characters, then this
package may not find a suitable breakpoint. Including \verb*|\ | (that is, a
backslashed space) in the URL will force a breakpoint to be inserted into the
URL, with no effect on appearance.

\DescribeMacro\url
The command |\url|\marg{url} can be used to format a URL in text.


\subsection{Alternate Presentations of URLs}

\label{s:urls-appearance}

By default, URLs are shown in text. This format, logical for print publications
with no other easy access to hyperlinks, can look lengthy and cumbersome in
legal memoranda and other contexts. Accordingly, several other options are
provided.

In documents with tables of authorities, URLs can be presented in an alternate
format: The URLs are included only in the table listing, and citations in the
document include a marker ``\emph{available online}.'' A footnote is added after
the first such omitted URL, informing the reader that omitted URLs are in the
Table of Authorities. To select this format, use the package option
\opt{toaurl}.

This format has the advantage of producing cleaner-looking briefs, particularly
given the large font-to-text-field ratios that most courts require of briefs
(such that URLs could take up a large fraction of a page). The main disadvantage
is that it actually increases word count, since URLs typically count only as one
word.

The text to be shown in place of URLs can be redefined with the macro
\DescribeMacro\ToaUrlMark
|\ToaUrlMark|.
The text to be shown in the footnote after the first such replaced URL can be
redefined with the macro
\DescribeMacro\ToaUrlText
|\ToaUrlText|.


Alternatively, in documents intended to be used only electronically, URLs can be
replaced with a word that is hyperlinked.
To select this format, use the package option \opt{linkurl}.

\DescribeMacro\LinkText
The text to be used in place of the URL is defined in the macro |\LinkText|.
No line break protection is performed on the word, so it should be an
unbreakable word or the macro should be defined to include an unbreakable
|\hbox|.

%%
%% \iffalse filename: struct.dtx \fi
%%
\input driver
\thisis{struct}{Context-Dependent Parameters}

For some references, different parts need different parameters. For example,
multivolume treatises often have different authors per volume, and some old
multivolume works were published over multiple years. One possibility would be
to cite each volume as a different reference, but that would mean that different
volumes of the same work would not receive short or \emph{id.}\ citations.

As a result, the better option is to allow these complex works to be defined as
a single reference, but enable an option for changing parameter values depending
on the part cited. The \param{struct} parameter enables this.

The value passed to \param{struct} is a key-value listing where the keys are the
determinative document component (typically but not always the volume number),
and the values are another key-value listing of replacement parameters. For
example:
\begin{demo}
|\defbook{treatise}{|\\
|  author=A A,|\\
|  title=The Treatise,|\\
|  year=1800,|\\
|  struct={1={author=B B},|\\
|          2={title=The Treatise Revised},|\\
|          3={year=1805}},|\\
|}|
\end{demo}
Here, the default citation would be ``\textsc{A A}, \textsc{The Treatise}
(1800).'' But if volume 1 is cited then the author would be changed, the
title changed if volume 2 is cited, and the year changed if volume 3 is cited.

Only certain reference types support parameter structures, and the particular
parameters that can be replaced are determined by the reference type.

%%
%% \iffalse filename: anonymous.dtx \fi
%%
\input driver
\thisis{anonymous}{References Within References}

Often a shorter work will be included in a larger compilation, and both need to
be cited in order to facilitate access to the shorter work. A private letter may
be reprinted in a volume of collected letters, for example, or a brief filed in
a case may appear within the docket for a case. \hia* provides a number of ways
to support this.

First, some reference parameters accept another reference nickname as input. All
references accept the parameter \param{reprinted}, and some such as
\rtype{casedoc} accept the parameter \param{citation}. More generally, the
reference type \rtype{citecontainer} provides a comprehensive mechanism for
citing a reference contained within another reference.

As an example, consider the following reference definitions:
\begin{demo}
|\defletter{madison-letter}{|\\
|    author=James Madison,|\\
|    to=W.T. Barry,|\\
|    date=aug 4 1822,|\\
|    reprinted=madison-writings,|\\
|}|\\
|\defbook{madison-writings}{|\\
|    name=Letters and Other Writings of|\\
|         James Madison,|\\
|    year=1884,|\\
|}|
\end{demo}
The parameter \param{reprinted} in the letter's reference definition identifies
the book in which the letter has been reprinted by its reference nickname, and
the book is defined separately as a reference. This approach works perfectly
well, but it can be cumbersome to define the book as its own reference with its
own nickname. If the book is never used
anywhere else, it might be convenient to define the book reference inside the
letter reference definition.

``Anonymous references'' allow for this.
Instead of providing a reference name as the value to
\param{reprinted}, the book can be included in the letter reference definition
as follows:
\begin{demo}
|\defletter{madison-letter}{|\\
|    author=James Madison,|\\
|    to=W.T. Barry,|\\
|    date=aug 4 1822,|\\
|    reprinted=book: {|\\
|        name=Letters and Other Writings|\\
|             of James Madison,|\\
|        year=1884,|\\
|    },|\\
|}|
\end{demo}

More generally, anonymous reference definitions consist of the reference type
(without the |\def| prefix), a colon and space, and a set of parameter-value
pairs in braces. Note that whitespace following the parameter-value pairs can
confuse the parser, so it is best to place a comma after the closing brace as
shown above.

\clearpage
\part{Citations}
\label{p:citations}

A citation to a reference in a document consists of a \emph{citation command}
followed by a \emph{citation string} as the argument to the command. Citation
commands are described in \sec{iface}, and citation strings are explained
generally in \sec{parse}. The remainder of this Part then describes individual
components of citation strings in more detail.

%%
%% \iffalse filename: iface.dtx \fi
%%
\input driver
\thisis{iface}{Citation Forms and Commands}

Depending on grammatical context, a legal citation in a work will take on one of
several forms. \hia* supports these different grammatical forms of citation by
offering several citation commands in this section.
\unskip\footnote{\hia* also produces a distinct citation form for tables of
authorities, but writers do not use this citation form directly.} This section
describes each citation form along with the command used to access the form.


\subsection{Sentences}

A \emph{sentence}-form citation is set off from the text as a separate
sentence:
\begin{demo}
|Segregation is unconstitutional. \sentence{see brown at 495}.| \\
\Produces Segregation is unconstitutional. \emph{See} \emph{Brown v.~Bd.\ of
Educ.}, 347 U.S. 483 (1954).
\end{demo}

\DescribeMacro\sentence
As seen above, |\sentence| produces this style of citation.
The trailing period
is mandatory; it avoids mistakes and assists word processors' detection of
missed capitalization. In legal memoranda, the command may appear anywhere in a
document. In law review articles, |\sentence| must appear in a
footnote, and if it appears in body text, it will be automatically converted to
|\note|. However, a sentence-style citation at the beginning of a paragraph in
body text (typically used to cite a block quotation) cannot be automatically
converted, so a warning is generated.


\subsection{Clauses, Instructions, and Nested Citations}

A \emph{clause}-form citation falls within a sentence, preceded by a comma and
followed by a comma unless there is other punctuation.
Typically clause-style citations are used when different citations are needed
for different parts of a single long sentence.
\begin{demo}
|Education is important, \clause{see brown at 493}, and segregation has a ``detrimental effect,'' \clause{brown at 494}.| \\
\Produces Education is important, \emph{see} \emph{Brown}, 347 U.S. at 493, and
segregation has a ``detrimental effect,'' \emph{id.}\ at 494.
\end{demo}

\DescribeMacro\clause
The |\clause| command makes a clause-form citation. It should be surrounded by
appropriate punctuation, and in particular there must be punctuation immediately
following the command. In law review articles,
|\clause| must appear in a footnote, and if it appears in body text, it will be
automatically converted to |\note|. However, a clause citation followed by
punctuation that is not a comma cannot be automatically converted, so a warning
is generated.

\paragraph{Instructional Citations}
Citations may also appear in instructional sentences that end with a |\clause|
citation. Typically these will be imperative sentences with an unitalicized
spelled-out signal:
\begin{demo}
|On scientific evidence, see \clause{brown at 494 note 11}.| \\
\Produces On scientific evidence, see \emph{Brown}, 347 U.S. at 494 n.11.
\end{demo}
Although this context differs grammatically from other |\clause| citations, the
formatting is largely identical so only one command is provided.
\unskip\footnote{Some style guides use a slightly different format in
which citation items are separated with commas and the word ``and'' rather than
semicolons. This is a somewhat rare usage that could be accomplished by
issuing separate \cmd\clause\ commands for each citation item, so there seems to
be no particular need to implement a separate command for this use case.}

\paragraph{Nested Citations}
Citations may also appear nested in parentheticals within other citations. This
can be accomplished by using |\clause| inside the parenthetical:
\begin{demo}
|\sentence{see brown at 494-495 (overruling \clause{plessy})}.| \\
\Produces \emph{See} \emph{Brown}, 347 U.S. at 494--95 (overruling \emph{Plessy
v.~Ferguson}, 163 U.S. 537 (1896)).
\end{demo}
More on nested citations, including a more convenient shortcut
form, may be found in \sec{parens}.


\subsection{Inline Citations}

An \emph{inline}-form citation acts as a part of speech within a sentence,
typically a noun or an adjective. Naming a case in text uses an
inline citation:
\begin{demo}
|\Inline{brown} followed \inline{sweatt}.| \\
\Produces \emph{Brown} followed \emph{Sweatt v.~Painter}.
\end{demo}

The following commands produce inline citations. Any of them may be used in text
or footnotes, regardless of the document type.
\begin{itemize}
\item \DescribeMacro\inline |\inline| makes a typical inline citation.

\item \DescribeMacro\Inline |\Inline| capitalizes the first letter of the
citation.

\item \DescribeMacro\adjective |\adjective| removes leading ``the'' from the
citation text, making it amenable to use as an adjective in a sentence.

\item \DescribeMacro\Adjective |\Adjective| is like |\adjective| but capitalizes
the first letter.
\end{itemize}

\hia*'s support for inline citations is the most comprehensive for cases and
statutes, where there are reasonably well-defined conventions for how to form
such citations. For other reference types, such as books and articles, the
package uses author names to the extent given. Support for more complete
coverage of inline citations is a potential future improvement to the package.

Using inline citation commands is preferable to manually entering inline
citations in text for several reasons. First, inline
citations often have long and short forms, so programmatic formatting of inline
citations ensures that the right one is chosen even if paragraphs or sections of
text are moved around.
Furthermore, inline citations can affect the surrounding non-inline citations.
When citing a case for the first time, it is typical to omit the case name from
a sentence citation when the case name was used inline:
\begin{demo}
|\Inline{brown} involved class actions. \sentence{see brown at 495}.| \\
\Produces \emph{Brown} involved class actions. \emph{See} 347 U.S. at 495.
\end{demo}
This package detects such situations and removes duplicative names
automatically.

\paragraph{Inline Citations and \emph{Id.}}\label{s:iface-invisible}
One of the most nuanced considerations for inline citations is the effect on
\emph{id.}\ short forms. Consider the following:
\begin{demo}
|\sentence{brown at 496}. The Court overruled \inline{plessy}. \sentence{brown at 494-495}.| \\
\Produces \emph{Brown}, 347 U.S. at 496. The Court overruled \emph{Plessy}.
\textbf{???}
\end{demo}
Absent the inline citation to \emph{Plessy}, the final citation in the above
sentence should be ``\emph{Id.}\ at 494--95.'' But with the inline citation, it
is ambiguous which case the \emph{Id.}\ refers to. The better option, which
\hia* follows, is to use the named short form.

If this is undesirable, one can cause the \emph{Id.}\ form to be used by hiding
the inline citation with braces:
\begin{demo}
|\sentence{brown at 496}. The Court overruled {\inline{plessy}}. \sentence{brown at 494-495}.| \\
\Produces \emph{Brown}, 347 U.S. at 496. The Court overruled \emph{Plessy}.
\emph{Id.}\ at 494--95.
\end{demo}

By contrast, consider:
\begin{demo}
|\sentence{brown at 496}. The Court applied \inline{14th-amend}. \sentence{brown at 494}.|
\Produces \emph{Brown}, 347 U.S. at 496. The Court applied the Fourteenth
Amendment. \emph{Id.}~at 494.
\end{demo}
Here, it is unambiguous that the \emph{Id.}\ does not refer to the constitution.
\hia* implements this distinction by designating the inline forms of statutes,
constitutions, and a few other references as ``invisible'' to the
\emph{id.}~citation algorithm. This behavior can be overridden by using the
|\noid| command.


\subsection{Note}

\DescribeMacro\note |\note| makes a sentence-style citation inside a footnote;
it is essentially a synonym for:
\begin{demo}
|\unskip\footnote{\sentence{|\meta{string}|}.}|
\end{demo}
It provides two conveniences for the author. First, the |\unskip| means that a
space before |\note| is automatically removed, making \TeX\ code more readable.
Second, |\note| can take a second argument of text (which can include sentence
and clause citations) appended after the citation:
\begin{demo}
|\note{case}{For further information, see \clause{case2}.}|
\end{demo}


\subsection{Optional Clause}

\DescribeMacro\optclause
The |\optclause| command is placed immediately after an |\inline| citation and
takes no arguments. Its purpose is to serve a style of citation that some
writers prefer, in which a clause-style citation (in text or in a footnote,
depending on the type of document) immediately follows the first inline citation
to a reference:
\begin{demo}
|In \inline{brown}\optclause, the Court held...| \\
\Produces
\emph{[When case already cited]} In \emph{Brown}, the Court held\ldots \\
\emph{[When case not already cited]} In \emph{Brown v.~Board of Education}, 347
U.S. 483 (1954), the Court held\ldots
\end{demo}
In other words, this is identical to |\inline{ref}, \clause{ref at 570},| if the
reference has not been cited so far, but produces nothing if it has been cited
already.
\unskip\footnote{Personally, I do not like this style of citation, as it breaks
the rule that a citation comes after the proposition being cited. But it is a
common enough style that I provide it as an option.}


\subsection{Miscellaneous Commands}

A few additional commands are defined here.

\DescribeMacro\textellipsis
Ellipses in legal documents are idiosyncratic, using full spaces between dots.
The package redefines ellipses in \LaTeX\ to conform.


\DescribeMacro{\sic}
The |\sic!| command inserts a properly formatted [\emph{sic}] into text. The
exclamation point deals with \TeX\ spacing issues.


Several macros affect memory of citation state to change what forms of citations
will be produced.
\begin{itemize}
\item
\DescribeMacro{\noid}
The |\noid| command informs the package not to use \emph{id.}\ for the next
citation, by resetting memory of the last reference cited.

\item
\DescribeMacro\fullcite
Similarly, the |\fullcite|\marg{ref} command informs the package to produce a
full citation of \meta{ref} by resetting memory of that reference's use.

\item
\DescribeMacro\nofullcite
By contrast, the |\nofullcite|\marg{ref} effectively cites \meta{ref} without
displaying anything, so that the next citation to that reference is a short
form.

\item
\DescribeMacro\fulltitle
The |\fulltitle|\marg{ref} command resets memory of the last statutory title
cited.

\item
\DescribeMacro\addtotoa
The |\addtotoa|\marg{ref} command adds \meta{ref} to the table of authorities
without producing any citation text.
\end{itemize}

\subsection{Shorter Commands}

The following are synonyms to the citation commands thus described.

\begin{demo}
\begin{tabular}{ll}
\textbf{Command} & \textbf{Synonym} \\
\hline
\cmd\sentence & \DescribeMacro\Ct \cmd\Ct \\
\cmd\clause & \DescribeMacro\ct \cmd\ct \\
\cmd\Inline & \DescribeMacro\Ci\cmd\Ci \\
\cmd\inline & \DescribeMacro\ci\cmd\ci \\
\cmd\note & \DescribeMacro\cn\cmd\cn \\
\cmd\addtotoa & \DescribeMacro\cx\cmd\cx \\
\end{tabular}
\end{demo}
%%
%% \iffalse filename: parse.dtx \fi
%%
\input driver
\thisis{parse}{Citation Strings}

To specify the information needed to cite references in a document, this package
provides a compact but flexible input syntax intended to capture the many types
of information that may be included in a citation. This section first describes
a data model for the information that goes into a citation, and then explains
the syntax for input text that this package uses to receive that information.
The input text syntax is used for all citation commands that this package
accepts (\cmd\sentence, \cmd\clause, \cmd\inline, etc.).

\subsection{Data Model}

A \emph{citation string} is an ordered list of one or more \emph{citation
items}. \unskip\footnote{Multiple citation items are permitted even for citation
command types like \cmd\inline\ that ought to accept only one item.} Each
citation item includes the following components:
\begin{itemize}
\item A signal (see \sec{signals}).
\item A reference name.
\item A volume number.
\item A pin cite (see \sec{pages}).
\item An ``optional argument,'' used by some reference types to fine-tune the
citation display.
\item A list of parentheticals (see \sec{parens}).
\end{itemize}
All of the components are optional other than the reference name. The syntax and
meanings of signals, pin cites, and parentheticals are treated in other
documentation sections; the reference name, volume number, and optional argument
are freeform text that is used as-is with no processing.

\subsection{Input Syntax}

Citation strings are given to the package using the following syntax:
\begin{grammar}
\meta{citation-string} := \meta{citation-item} ( \littext{; }
\meta{citation-item} )* \\
\meta{citation-item} := [ \meta{signal} ] \\
\qquad[ \meta{volume} ] \\
\qquad\meta{reference-name} \\
\qquad[ \littext{ [} \meta{opt-argument} \littext{]} ] \\
\qquad[ \littext{ at } \meta{pincite} ] \\
\qquad( \grammarparen{parenthetical} )*
\end{grammar}

More concretely, citation strings are one or more semicolon-separated items. The
following cites three references:
\begin{demo}
\ttfamily
ref-a; ref-b; ref-c
\end{demo}

A complete citation item with every component might look like this:
\begin{demo}
\ttfamily
see, e.g., 5 treatise[opt] at 35-60 (citing references) (outdated)
\end{demo}
This would cite volume 5, pages 35--60 of a reference named |treatise| with the
signal |see, e.g.|, an optional argument |opt|, and two parentheticals.

More commonly, only a few components of a citation item will be included. An
example citation string in ordinary use might look as follows:
\begin{demo}
\ttfamily
statute at S 167; see also supporting-case at 189; another-case at 465; cf.
journal-article at 754 (discussing related applications of the statute); see
generally 7 treatise at S 56
\end{demo}

Note that if the same reference is cited multiple times in a row, there is no
facility for writing \emph{id.}\ or the like in the input syntax. The reference
must be fully identified and pin-cited on each use, and the package will
automatically compute whether \emph{id.}\ should be inserted as described in
\sec{state}. While this may seem like unnecessary work, there is a major
advantage: The citation string input is fully independent of where in the
document the citation string appears. As a result, writers can freely move
blocks of text around a document without having to rewrite input citation
strings. If \emph{id.}\ or other shortcuts had been used in the document, then
they likely would become unintelligible upon a document reorganization.

%%
%% \iffalse filename: signals.dtx \fi
%%
\input driver
\thisis{signals}{Signals}

Items in a citation string may be preceded by a signal, indicating how the
writer of the citation understands the relationship of a cited reference to the
writer's argument. A citation preceded with \emph{see} indicates that the
reference supports the writer's proposition; \emph{compare} can identify warring
sides of a debate; \emph{cf.}~can identify cleverly related connections or coyly
disguise contradictory authorities; and \emph{see generally} can point to
background reading. Signals introduce a great deal of expressiveness into a
system of legal citation, enabling writers to compactly distill a complete
literature into a single citation string.

\subsection{Data Model (List of Signals)}


Each signal belongs to one of four classes: support, comparison, contrary, and
background. Here are all the signals available, along with their classes.

\begin{demo}
\def\AddSignal#1#2{\emph{#1}&\csname sig@#2\endcsname\\}
\def\sig@s{Support}
\def\sig@p{Comparison}
\def\sig@c{Contrary}
\def\sig@b{Background}

\begin{tabular}{ll}
\textbf{Signal} & \textbf{Class} \\
\hline
\AddSignal{see}{s}
\AddSignal{see, e.g.,}{s}
\AddSignal{see also}{s}
\AddSignal{see also, e.g.,}{s}
\AddSignal{e.g.,}{s}
\AddSignal{accord}{s}
\AddSignal{accord, e.g.,}{s}
\AddSignal{cf.}{s}
\AddSignal{compare}{p}
\AddSignal{and}{p}
\AddSignal{with}{p}
\AddSignal{contra}{c}
\AddSignal{but see}{c}
\AddSignal{but see, e.g.,}{c}
\AddSignal{but cf.}{c}
\AddSignal{see generally}{b}
\end{tabular}
\end{demo}

\subsection{Input Syntax}

As described in \sec{parse}, the signal for a citation
item is placed at the beginning of the input text for the citation item, in all
lowercase text. As a convenience, duplicative sequential signals may be omitted.
For example, the following are equivalent:
\begin{demo}
\ttfamily
see ref1; ref2; see also ref3; ref4 \\
see ref1; see ref2; see also ref3; see also ref4 \\
\end{demo}
In both cases, the \emph{see} signal will apply to |ref1| and |ref2|, and
\emph{see also} to |ref3| and |ref4|.

This package does not deal with two aspects of citation signals. First, it does not
enforce an order in which signals must be used. This provides slightly more
flexibility to writers, although it is expected that most writers will follow
conventional ordering of signals. Second, comparison signal citations typically
include \emph{and} before the penultimate item of each side of the comparison,
for example:
\begin{demo}
\emph{Compare} A, B, \emph{and} C, \emph{with} D, \emph{and} F.
\end{demo}
For implementation reasons, \unskip\footnote{As described in the implementation
discussion of citation formatting, each citation item is formatted by executing
a group of commands for the citation. To figure out whether an \emph{and} is
needed in the middle of a comparison citation string, it would be necessary to
read ahead to the next citation item in advance. While this could be done, it
would be cumbersome to program, and the workaround described here is not enough
of an inconvenience to make the effort seem worthwhile.} this package does not
add the \emph{and} automatically. Instead, \emph{and} is defined as a comparison
signal for the writer to insert in the appropriate place in a citation string.

\subsection{Formatting}

There are four matters to be handled with respect to formatting of signals.
\begin{enumerate}
\item The citation must be formatted with the correct fonts.

\item The punctuation between citation items depends on the surrounding signals.
Citation items are generally separated by semicolons, but with two
exceptions:
\begin{itemize}
\item Between citation items using comparison-class signals, commas are used.
\item In a sentence-style citation, citation items are separated with a period
if the signal class changes. The signal is also capitalized.
\end{itemize}

\item If the same signal is used two or more times in a row, it is only
displayed on the first use.

\item In a series of citation items with contrary-class signals, the word
``but'' is omitted from all but the first negative signal.
\end{enumerate}

%%
%% \iffalse filename: pages.dtx \fi
%%
\input driver
\thisis{pages}{Page Numbers and Other Pin Cites}

The often extraordinary length of legal documents, articles, and treatises
necessitates citing specific portions of them in order to inform readers of the
relevant parts of a reference that support the writer's claims. Yet the
diversity of forms of legal references makes pin-citing the relevant parts a
challenge. Some documents are paginated, others divided into sections, others
marked with star-pagination reflecting archaic publications. And some forms of
citation require identifying multiple pin cites for different published versions
of a work---cases reported in several reporters, for example, or for session
laws both the statutory section number and the page number of the \emph{Statutes
at Large}.

It is not desirable to put the burden on the user to manage formatting of page
numbers and subdivisions. A legal citation system must understand users' page
number inputs to compose tables of authorities, determine whether to omit page
numbers in \emph{id.}\ citations, and cite subsections of statutes, for example.
Furthermore, there are many rules of pin-cite formatting that are inconvenient
and burdensome for writers to remember and better suited for automatic
processing---abbreviation of words like ``paragraph'' and italicization of
``(\emph{l}),'' for example. As a result, a program such as this package must
parse and interpret pin cites, and it thus must provide writers with a syntax
for entering them.

This section describes the data model for pin cites, the input syntax that this
system accepts for them, and the rules for formatting.

\subsection{Overall Structure}

Because of the diversity of types of legal document numbering systems, the data
model and syntax for pin cites are fairly complex. For testing purposes, a
writer may access the pin cite formatting algorithm using the command
\DescribeMacro\PageNumber
\cmd\PageNumber\marg{number}.


\paragraph{Segments}\label{s:pages-segments}
A pin cite is made up of several ``segments'': a default segment and one or more
named segments. The named segments are used for parallel citations; their use is
defined by specific reference types. For example, session laws use the default
segment to hold the subsection number of the statute being cited, and then
require a segment named |stat| that identifies the page of the \emph{Statutes at
Large} on which the subsection appears. The input syntax and an example are as
follows:
\begin{grammar}
\meta{pin-cite} := \meta{segment} \\
\qquad( \littext{ ::} \meta{segment-name} \littext{: } \meta{segment} )* \\
\Example \texttt{S 12 ::stat: 783}
\end{grammar}
The example would cite \textsection~12 of a statute, at page 783.


\paragraph{Lists of Items}
A pin cite segment can consist either of a comma-separated list of items, or two
comma-separated lists of items delimited by the word |to| (surrounded by
spaces). The latter form is used for pin cites to ranges where each side of the
range contains multiple items.
\begin{grammar}
\meta{segment} := \meta{list} [ \littext{ to } \meta{list} ] \\
\meta{list} := \meta{item} ( \littext{, } \meta{item} )* \\
\Example \texttt{column 5, line 8 to column 6, line 5}
\end{grammar}
Here, the word ``to'' must be used to separate the ranges to avoid ambiguity.


\subsection{Pages and Divisions}

\label{s:pages-forms}

Many forms of pin cite items are permitted, and how an item is interpreted
may depend on what item preceded it. In general, there are two types of items in
pin cites: page numbers and named divisions (like ``table 5'' or
``\textsection\textsection~15-20''). The number type is important for
formatting: Ranges in page numbers are truncated, and named
divisions need to be singular or plural and can accept subdivisions.

Generally, page numbers are written as bare numbers, and named divisions are
written as the division name, a space, and one or more division numbers.
A division number can follow a page number with or without a comma, or with an
ampersand (indicating a citation to the page and the division). After a named
division is used, any subsequent bare numbers will be interpreted as part of the
division. To return to citing page numbers, insert the word |at| (e.g.,
\texttt{section 5, at 143}). This can be useful for helping readers find the
location of text divisions. Thus:
\begin{demo}
\begin{tabular}{lll}
\textbf{Input} & \textbf{Output} & \textbf{Explanation} \\
\hline
|157, 160-163| & 157, 150--63 & Page numbers \\
|line 403, 450-463| & ll.~403, 450--463 & All are line numbers \\
|line 403, at 450-463| & l.~403, at 450--63 & 450--463 are pages \\
|157-158 table 1-2| & 157--58 tbls.1--2 & Citing just tables \\
|157-158 & table 1-2| & 157--58 \& tbls.1--2 & Citing pages and tables \\
\end{tabular}
\end{demo}
As seen in the above examples, the number part of either a page number or a
named division can be a hyphenated range, and the hyphen is converted to a
proper dash. To include an actual hyphen, use |\-| instead.


Further fine-tuning of the pin cite parsing algorithm can be done by placing
special codes or punctuation at the beginning of pin cite items:
\begin{demo}
\begin{tabular}{llp{0.6\textwidth}}
\textbf{Input} & \textbf{Type} & \textbf{Explanation} \\
\hline
\texttt{S 3} & Division & Produces \textsection~3 \\
\texttt{P 3} & Division & Produces \textparagraph~3 \\
\texttt{-34/a} & Division & Interpreted as a division with no name: 34(a) \\
\texttt{!A5} & Number & Uses text after the exclamation point as a bare number,
and does not format at all. Useful for newspaper articles \\
\texttt{*16} & Number & Treats whatever follows the star as a page number.
Useful for star-paginated works \\
\texttt{?} & Missing & Issues a warning to remind the writer to fill in a pin
cite \\
\texttt{/a3} & Division & Interpreted as a subdivision: (a)(3). Must follow a
named division \\
\end{tabular}
\end{demo}


\subsection{Subdivisions}

Named divisions of text are sometimes organized into top-level divisions and
subdivisions. For example, ``\textsection~5(a)'' refers to subsection (a) of the
fifth section of a reference. Distinguishing between top-level divisions and
subdivisions is necessary because it affects pluralization of the division name
(``\textsection\textsection~5--6,'' but ``\textsection~5(a)--(b)'').
Additionally, writing all the parentheses in conventional subdivision numbers is
somewhat cumbersome.

For input to this package, subdivisions are separated from top-level divisions
with a slash. Bare subdivisions (without a top-level subdivision) may be used as
pin cite items to cite multiple non-contiguous subdivisions, and ranges may
include bare subdivisions. Single characters in a subdivision will be
automatically parenthesized. The following are examples:
\begin{demo}
\begin{tabular}{ll}
\textbf{Input} & \textbf{Output} \\
\hline
|S 5/a| & \textsection~5(a) \\
|S 5/a-6/b| & \textsection\textsection~5(a)--6(b) \\
|S 5/a-/b| & \textsection~5(a)--(b) \\
|S 5/a, /c| & \textsection~5(a), (c) \\
|S 5/a1A| & \textsection~5(a)(1)(A) \\
|S 5/a1A(iii)| & \textsection~5(a)(1)(A)(iii) \\
|S 5/a1A{note}| & \textsection~5(a)(1)(A)note \\
\end{tabular}
\end{demo}


\section{Pin Cite Subdivision Joining}

\label{s:pages-join}

For \rtype{alias} and some statute citations, it is possible to give an overall
division or page number for the reference and then refer to a specific part of
it. For example, one might define the statute 35 U.S.C. \textsection~112 as a
reference |sec-112|, and then wish to refer to subsection (b) of that statute.
To do so, one may write:
\begin{demo}
|\sentence{sec-112 at /b}|\\
Equivalent to: |\sentence{sec-112 at S 112/b}|\\
\Produces 35 U.S.C. \textsection~112(b)
\end{demo}
In other words, the pin cite given as part of the citation item is joined to the
pin cite given in the reference definition. The following rules define how a
reference pin cite is joined with a citation item pin cite:
\begin{itemize}
\item If the citation item pin cite does not start with a slash indicating a
subdivision, then the reference pin cite is discarded and only the citation
item's is used.
\item If the citation item pin cite starts with a slash and the reference pin
cite has no slash, then the two are concatenated.
\item If the citation item pin cite starts with a slash and the reference pin
cite has a slash, then the slash is removed from the citation item pin cite and
the two are concatenated.
\end{itemize}
Thus, the following examples:
\begin{demo}
\begin{tabular}{lll}
\textbf{Reference} & \textbf{Citation Item} & \textbf{Result} \\
\hline
|S 112| & |S 102/a| & \textsection~102(a) \\
|S 112| & |/b| & \textsection~112(b) \\
|S 505/j| & |/2A| & \textsection~505(j)(2)(A) \\
|S 505/j| & |/2A-/3| & \textsection~505(j)(2)(A)--(3) \\
\end{tabular}
\end{demo}
The range joins correctly not because of these rules but because of the ordinary
parsing rules for subdivision ranges, given above.

Note that the joining algorithm performs no error checking, and will join
subdivisions to page numbers even though subdivisions make no sense in that
context. Additionally, this feature is only supported by certain reference types
that enable it.


\subsection{Formatting Around Pin Cites}

Pin cites can affect the text that precedes the pin cite number. In many
situations, standard page numbers are often preceded by the word ``at'' whereas
named subdivisions are not. The macro
\DescribeMacro\hi@atorsect
|\hi@atorsect|\marg{pincite} is provided to insert ``at'' depending on the
nature of \meta{pincite}, and
\DescribeMacro\hi@page@atorsect
|\hi@page@atorsect| performs that function on the currently active pin cite in a
citation item.


For other citation types such as books, the pin cite is separated from text in
the citation with just a space. However, there are exceptions:
\begin{itemize}
\item If the preceding text ends with a digit, then a comma is placed, and
``at'' is placed if the pin cite is a page number as described above.
\item If the preceding text is ``R.'' (for ``Record''), then ``at'' is placed
regardless of the type of pin cite. \unskip\footnote{For Record cites to named
subdivisions (e.g., ``R.~at para.~5''), it is unclear whether ``at'' should be
included. It seems preferable to do so to ensure that ``R.'' is not interpreted
as ``Rule.''}
\end{itemize}
Thus, the following examples:
\begin{demo}
\begin{tabular}{lll}
\textbf{Preceding Text} & \textbf{Pin Cite} & \textbf{Output} \\
\hline
|Book| & |15| & \textsc{Book} 15 \\
|Treatise| & |S 5| & \textsc{Treatise} \textsection~5 \\
|Annual Report 2015| & |35| & \textsc{Annual Report 2015}, at 35 \\
|Agency Report 2006| & |S 12| & \textsc{Agency Report 2006}, \textsection~12 \\
|R.| & |102| & R. at 102 \\
|R.| & |paragraph 36| & R. at para. 36 \\
\end{tabular}
\end{demo}

Finally, it is sometimes useful to expand initial |\textsection| and
|\textparagraph| symbols to words. This is useful for statute citations. The
command
\DescribeMacro\hi@expand@symbols
|\hi@expand@symbols|\marg{pincite}\marg{callback} will do this.

%%
%% \iffalse filename: parens.dtx \fi
%%
\input driver
\thisis{parens}{Parentheticals}

Parentheticals are information appended to the text of citation items, and are
used to convey additional information about the reference being cited. The
following example includes two classic examples of parentheticals, one for court
and date information and the other for characterizing the holding of a case:
\begin{demo}
\emph{See} Plaintiff v.~Defendant, 123 F.4th 567 (1st Cir. 2000) (holding that
the sky is blue).
\end{demo}
Legal citation uses parentheticals extensively, both in highly structured ways
to include required bibliographic data about references and more freeform ways
that allow authors an additional avenue to converse with readers.

This section describes the nature of parentheticals as understood by this
package, how parentheticals are entered for citation items, and how
parentheticals are formatted.

\subsection{Data Model}

\paragraph{Types}
At the time that a citation item is being formatted, the package begins building
up a list of parentheticals. The parentheticals can originate from two places.
First, they may be associated with the reference itself, providing bibliographic
information or commentary to be generally associated with the reference (e.g.,
publication dates, judicial opinion types, or alternate sources for finding
references). These parentheticals are typically displayed only with the full
citation of the reference.

Parentheticals may be provided as part of the citation item input, as described
in \sec{parse}. These ``citation-level'' parentheticals are generally meant to
explain the writer's use of the reference in a particular
citation---characterizing the holding of a case to demonstrate its relevance to
the writer's argument, quoting the relevant portion of a reference, or
identifying sources that the reference itself quotes or cites.

``Parentheticals'' as used in this package are not merely text set inside
parentheses. They also include items such as URLs, prior and subsequent case
history, and other material typically set off with a comma after the main text
of a citation item. Thus, there are three parentheticals in the following
example for the date, the website, and a characterization:
\begin{demo}
\textsc{John Doe}, \textsc{A Book Online} (2018), http://www.johndoe.xyz/book
(providing information).
\end{demo}
As this example shows, it is best to treat comma-offset text as parentheticals
just like parentheses-enclosed text, because the two are intermingled in
presentation. URLs, for example, appear after the date parenthetical to a
citation but before parenthetical commentary text.

\paragraph{Content and Ordering}
Every parenthetical is associated with two items: (1) the text of the
parenthetical, and (2) a priority number. The priority number serves two
purposes. First, it establishes an ordering of parentheticals. For example, the
date parenthetical for a citation always should precede other parentheticals, so
it has the lowest priority number. Second, the priority number determines the
appearance of the parenthetical. Other than hereinafter parentheticals (which
unusually are set inside square brackets), parentheticals with even priority
numbers are set inside parentheses while those with odd numbers are set off with
a comma. As a result, there is consistency among even citations with many
parentheticals.

The priority number for any parenthetical is set automatically based on the
context in which the package receives the parenthetical. Generally writers
should not need to deal with them, but the mechanism may be useful to know for
authors who wish to change the default ordering or appearances.


\subsection{Input Syntax}

For parentheticals entered as parameters to references, the syntaxes are
explained in \pt{allparams}. This section describes the syntax for
parentheticals entered as components of citation items, expanding on
\sec{parse}. These are called ``citation-level'' parentheticals.

Generally parentheticals are entered in citation items as plain text. Citation
commands may be used inside parentheticals to produce nested citations, as
described in \sec{iface}. In addition, several special syntaxes are provided to
allow for different types of common parentheticals.

The following input will convert \meta{cite} to
|\clause|\marg{cite} and remove the colon. This is a convenient shortcut for the
common types of parentheticals that start with ``quoting,'' ``cited by,'' or
``discussed in'' followed by a citation.
\begin{demo}
\begin{tabular}{l}
|(|\meta{verb}|ing: |\meta{cite}|)| \\
|(|\meta{verb}| in: |\meta{cite}|)| \\
|(|\meta{verb}| by: |\meta{cite}|)| \\
|(|\meta{verb}| at: |\meta{cite}|)| \\
|(codified at: |\meta{cite}|)| \\
|(codified as amended at: |\meta{cite}|)| \\
\end{tabular}
\end{demo}
For example, the following are largely equivalent:
\begin{demo}
|\sentence{ref at 3 (quoting: source at 15)}| \\
|\sentence{ref at 3 (quoting \clause{source at 15})}|
\end{demo}
In both cases, the citation to |ref| will include a parenthetical with the word
``quoting'' followed by a formatted citation to |source|.

The main difference between the colon forms and using |\clause| directly is that
the package can set priorities of the parentheticals correctly.
As currently defined, the codification parentheticals will come first and
subsequent commentary (using |in|, |by|, and |at|) comes last, with \meta{verb}|ing|-type parentheticals and other citation-level parentheticals in the middle.


\paragraph{Deferred Footnotes}

A parenthetical starting with |footnote:| creates a ``deferred footnote'' inside
a citation item. As its name suggests, the footnote is deferred for placement
until after the citation item has been formatted and emitted to the document. If
the citation item appears in body text, then the deferred footnote is placed
after the separating punctuation at the end of the citation item. If the
citation item is already in a footnote, though, the deferred footnote text is
appended to the end of the footnote. This mechanism is useful primarily for
legal memoranda if there is some material that should be connected to a citation
in the middle of a citation string, where that material would be too unwieldy to
include in a body-text parenthetical. \unskip\footnote{The deferred footnote
mechanism is also used to deliver a footnote about URLs being in the Table of
Authorities when that option is requested, as described in \sec{urls}.}


\subsection{Formatting}

The main task in formatting parentheticals is distinguishing among the different
types. As discussed above, there are three parenthetical forms:
\begin{itemize}
\item Parentheticals surrounded by parentheses. Emitting these is
straightforward.

\item Parentheticals offset by a comma. The primary additional consideration
here is that punctuation at the end of the parenthetical will be the last
punctuation in the citation, so if the parenthetical ends with a dot then it is
necessary to remove duplicative periods at the ends of sentences and such.

\item Hereinafter parentheticals. In addition to using square brackets, we
record use of the hereinafter form as described in \sec{short} and possibly
suppress the parenthetical if the hereinafter form was never otherwise used.
\end{itemize}

\part{Additional Features}
\label{p:features}
%%
%% \iffalse filename: toa.dtx \fi
%%
\input driver
\thisis{toa}{Table of Authorities}

Legal briefs and other documents often include a Table of Authorities, listing
all of the references cited and the pages where those citations occur. One of
the motivations for creating this package was the automatic generation of
complete, correct, and properly formatted Tables of Authorities.

The table is generated using \LaTeX's auxiliary file feature. Citations generate
index lines that are written to a |\jobname.toa| file, and those lines are read,
sorted, and formatted to produce the table. Indexing can be disabled with
\DescribeMacro\enabletoa
\DescribeMacro\disabletoa
|\disabletoa| and enabled with |\enabletoa|.

A Table of Authorities is a complex structure, because it is typically sorted
into sections based on reference types. This section describes how references
are sorted into lists, how those lists get their headings, how page numbers in
the tables are displayed, and finally how the table is formatted.


\subsection{Indexing References}

References are indexed for the Table of Authorities upon every citation. The
command |\addtotoa| described in \sec{iface} can also add an entry manually.

An interesting challenge for indexing is that, especially for briefs, references
may be cited in parts of a document that use different pagination systems. As a
result, it is necessary to store detailed information about where a reference is
cited in a document in order to produce a correct listing of pages in the table.


\subsection{Lists}

A Table of Authorities is made up of one or more reference lists, which are
alphabetized. References can be added to multiple lists but can only be added to
any list once. By default, reference types choose a list based on the type.


\paragraph{Sublists}
Each item is associated with a Table of Authorities list and optionally a
sublist. The sublist is used to construct a heading for the relevant list, such
that if items in one table list are associated with several sublists, then the
heading will name all the sublists. This is useful, for example, if a Table of
Authorities section ought to contain both statutes and regulations: The table
can automatically compute whether the heading of that section should read
``Statutes,'' ``Statutes and Regulations,'' ``Statute and Regulations,'' or the
like, depending on how many statutes and regulations are in the section.


Sublist names must be given in both singular and plural forms, the right one of
which will be selected. The names should be delimited with two to three slashes,
such that the first part is the common prefix, the last part is the plural
suffix, and the middle part if any is the singular suffix. For example,
``Regulation/s'' and ``Treat/y/ies.''


\paragraph{Location-Based Lists}
It may be desirable to prepare a chapter-by-chapter bibliography, such that
references are tagged not by type but by location in the document. The macro
\DescribeMacro\AuthorityTag
|\AuthorityTag|\marg{tag} will tag all subsequent references cited with the
given \meta{tag}, which can then be used as a list of the Table of Authorities.


\subsection{Composing Page Number Lists}

If a reference is cited on pages 3, 4, 5, 7, 8, and 10, it is desirable to group
these numbers into compact range forms for presentation in the Table of
Authorities: ``3--5, 7--8, 10.'' The package does so by reading the page numbers
in order, keeping a running compilation of the properly formatted aggregate
number listing and revising the last element of that listing as necessary.


\paragraph{Starred References}\label{s:toa-star}
Some courts ask litigants to insert asterisks in the Table of Authorities before
references that they rely most heavily on. This can be done automatically by
counting the number of times each reference has been used.

\DescribeMacro\StarCount
The macro |\StarCount|\marg{num} sets the minimum number of uses of a reference
before that reference receives a star. The package option \opt{toastar} sets the
value to 4. By default it is zero, in which case no stars are displayed.

\DescribeMacro\StarText
The macro |\StarText| can be defined as text to place at the beginning of the
Table of Authorities explaining the stars.

\DescribeMacro\StarMark
The macro |\StarMark| is the actual text of the star; it will be added before
the relevant TOA entries via |\everypar|.


\subsection{Showing the Table}

\DescribeMacro\tableofauthorities
The Table of Authorities is produced by calling |\tableofauthorities|. This will
create one section for each reference category as described in \sec{refs}. Each
heading will be created using whatever
\DescribeMacro\toaheading
|\toaheading| is defined as.


\DescribeMacro\AuthorityTable
Alternately, the macro
|\AuthorityTable|\oarg{heading-text}\marg{list-name} will produce a single Table
of Authorities list. This can be used for more fine-grained control over what
tables are displayed.


The following affect the appearance of the Table of Authorities:
\begin{itemize}
\item \DescribeMacro\toaskip |\toaskip| is a glue specification for how much
space to put between entries.
\item \DescribeMacro{passimnum} |passimnum| is a counter for how many items an
aggregate page listing must have before it is replaced with \emph{passim}.
\item \DescribeMacro{\PassimText} |\PassimText| is the text to be used if
|passimnum| is met or exceeded.
\item \DescribeMacro\toaditto |\toaditto| is the text that
replaces repeated authors, statutory titles, and other information that can be
omitted from the table listings.
\item\DescribeMacro\toahangindentlen |\toahangindentlen| is defined as a length
for the hanging indent. (It is specified in |em| units so it is defined as macro
text.)
\end{itemize}

%%
%% \iffalse filename: endnotes.dtx \fi
%%
\input driver
\thisis{endnotes}{Endnotes}

The usual \LaTeX\ endnote option stores the unexecuted text of notes and
then executes them all at the end of the document. This does not work for legal
citations because the content of the body text interacts with the content of the
endnotes: An inline citation in body text can change the appearance of citations
in the notes, and vice versa.

Instead, it is necessary to typeset endnotes as they are encountered and store
them to a vertical box that can be displayed upon request.


\DescribeMacro\EndnoteText

|\EndnoteText|\marg{text} adds arbitrary text to the endnote list. The text is
set in vertical mode.


\DescribeMacro\EndnoteTextDelayed
|\EndnoteTextDelayed| reserves a certain text for future adding to the endnote
list. The text is actually added only if other endnote text is added before
|\EndnoteTextDelayed| is invoked a second time.

This is useful for adding chapter or section heading markers to and endnote list
conditionally. If the chapter contains no endnotes, then the chapter heading
will never be inserted into the endnote list.

Again, the text is set in vertical mode.


\DescribeMacro\SectionNote
|\SectionNote| inserts text into the endnote list indicating where a section
heading occurred. The section number is inserted automatically, preceded by
|\SectionName| from \sec{xref}.


\DescribeMacro\EndnoteFont
|\EndnoteFont| can be defined to set the font for endnotes. It must be defined
before endnotes are added, since once they are added the notes have been
typeset and cannot be changed.


\DescribeMacro\theendnotes
|\theendnotes| emits the list of endnotes. If the macro is not called, it will
be automatically executed at the end of the document with a warning.

%%
%% \iffalse filename: short.dtx \fi
%%
\input driver
\thisis{short}{Short Names}

Many types of reference use a short name to identify the reference after the
first citation. \unskip\footnote{Short \emph{names} are to be distinguished from
short \emph{citations}, which are described in \sec{state}. A short name is text
used to identify a reference the second and subsequent times, and that name may
be used as part of short citations, but most short (non-inline) citations
include further information, such as a \emph{supra} note number or locator
information.} Cases use a distinctive party name, and books and articles use the
authors' last names, for example. Writers can also choose their own short names
for references using the |short| and |hereinafter| parameters.

Two problems can arise with these short names. First, two references may use the
same text for a short name. In this case, the short name is ambiguous, so one or
the other reference should use a different short name. Second, a writer may
define a short name for a reference, say using |hereinafter|, but cite that
reference only once in the document. A hereinafter parenthetical added to that
first full citation is thus extraneous and unnecessary, and ought to be removed.

This package deals with both of these problems, by issuing warnings about
ambiguous short names and automatically deleting unnecessary short name
parentheticals. No user intervention is required other than to respond to
warnings by adding distinctive short names. \unskip\footnote{A possible future
improvement would be to generate such short names automatically. To do so,
though, it would be necessary to build into the package knowledge of
conventional ways of disambiguating short names: Cases traditionally have roman
numerals appended to them, while authored works typically have a distinctive
word from the title added.}

It is worth briefly noting that this short name management feature exemplifies
the benefit of software-automated legal citations. A human cite-checker wanting
to solve these two short name problems must keep a table of citations, to be
searched and cross-referenced for every short name used. In a law review article
citing hundreds or thousands of references, this task is tedious and
error-prone, especially since the tabulation must be redone if the document is
revised. For a computer, though, this task takes a matter of seconds.

\part{Formatting Algorithms}
\label{p:formatting}
%%
%% \iffalse filename: draw.dtx \fi
%%
\input driver
\thisis{draw}{General Formatting}

After parsing a citation string, the package must produce formatted text for
each of the citation items in the string. This section describes the overall
process of joining together citations, choosing among several possible citation
forms for a given reference, and setting up any other requisite information for
proper citation display.

An important element of citation formatting is keeping track of ``state,''
namely information about references cited so far that is needed for proper
formatting of later citations in the document. As a simple example, it is
necessary to keep track of the previously cited reference so that if the next
reference is the same, text such as \emph{id.}\ can be written. This feature of
legal citation is discussed in \sec{state}.


\subsection{Drawing a Citation Item}

The following tasks must be performed when drawing each citation item within a
citation string. While this list of tasks is largely of importance only to
software implementers, it may be of interest to some cite-checkers to see the
full list of considerations that go into formatting a single citation item.

\begin{enumerate}
\item Citation state must be updated; see \sec{state}.
\item Each citation item maintains a list of parentheticals, which come from
either the reference definition or the user's citation string content.
\item The citation item's components must be collected. Some references are able
to modify the components afterwards.
\item The punctuation that precedes the citation item must be determined,
according to the previous and current signals.
\item The short, long, or \emph{id.}\ form of the citation must be chosen. That
choice must be accounted for in computations for future citations.
\item If the citation is in a footnote, then how the citation affects this and
other footnotes must be considered. See the discussion in \sec{state}.
\item The citation must be recorded for indexing in a Table of Authorities.
\item If the citation text ends with a period, then any period following the
item must be suppressed. This is obvious to human editors but surprisingly
difficult for computers.
\item For a sentence-style citation, the first letter of each sentence must be
capitalized. That could be the signal or a part of the citation text itself.
\end{enumerate}


\subsection{Citation Forms}

\label{s:draw-form}

When formatting a citation item, each reference can generate a variety of
citation texts. The types are given and explained here, along with their
internal macro prefixes:
\begin{description}
\item[Full] (|fc|) The full citation form.
\item[Short] (|sc|) The non-\emph{id.}\ short form. Defaults to the full form.
\item[List] (|lc|) The form used in the Table of Authorities. Defaults to the
full form.
\item[Pin cite] (|pc|) Some references have special ways of treating pin cite
numbers. This citation form is used in the pin cite formatting routine (see
\sec{pages}).
\item[\emph{Id.}] (|idc|) The form to be used for immediately successive
citations, if not the standard \emph{id.}~form.
\item[Inline full] (|ifc|) The inline citation form to be used upon the first
inline usage.
\item[Inline short] (|isc|) The inline citation form to be used on subsequent
inline usages.
\end{description}

For each reference \meta{ref-name}, a macro of the form
|\|\meta{prefix}|@|\meta{ref-name} may be defined containing the relevant text
for the citation form. For example, |\fc@brown| would be the definition of the
full citation for a reference named |brown|. It may be helpful for debugging to
see these macros. To do so, include the following in your document:
\begin{demo}
|\expandafter\show\csname |\meta{prefix}|@|\meta{ref-name}|\endcsname|
\end{demo}

\subsection{Choosing the Citation Form}

Upon each citation to the reference, it is necessary to
choose among these forms. The following rules inform that choice.

\begin{itemize}
\item An \emph{id.}\ citation is appropriate only when the reference being cited
matches the last reference, recorded as described in \sec{state}.
In any event, it is never appropriate in an inline citation.

\item The table of authorities form is chosen for non-nested citations inside a
table of authorities. If no table of authorities form is present for a given
reference, the full citation form is used instead. For nested citations inside a
table of authorities, the full citation is always used.

\item In other cases, a complex algorithm must be applied to choose between the
short and full citation forms. \unskip\footnote{As described in \sec{short},
the algorithm is complex because it depends on where previous citations were
used: A full citation in a footnote, for example, does not justify a short form
in main body text.} This algorithm is described in \sec{short}.
In any event, if no short citation form is defined for a reference, the full
citation form is used.

\item In an inline context, the same algorithm described in \sec{short} is used,
except the inline full/short citation forms are preferred if they are defined.
\end{itemize}

In addition to choosing a citation form, the package sometimes allows a
``nameless'' variant of a citation form. For example, a citation to a case may
omit the name of the case if the name was previously used in the text. In
general, a nameless citation to a reference is permitted if the previous inline
citation was to the same reference. There are some nuances to what constitutes
the ``previous'' citation, as described in \sec{state}.


\subsection{Missing References}

Sometimes it is desirable to cite to a reference that has not yet been defined.
This allows authors familiar with a reference to cite it without having to stop
immediately to enter the reference definition and parameters. The package
formats the undefined references in bold and also compiles a list of undefined
references, which is displayed at the end of document compilation.

As a convenience, the package also keeps track of defined references that are
missing page numbers. The user enters the unknown page number as a question
mark, and the package displays a list of all unentered page numbers at the end
of compilation. This tracking is turned on by default; if the
\DescribeMacro{nomissing} |nomissing| option is given to the package then an
error will be raised for missing reference definitions.

%%
%% \iffalse filename: abbrevs.dtx \fi
%%
\input driver
\thisis{abbrevs}{Abbreviations}

Legal citations use a variety of abbreviation schemes for different types of
texts. Case party names, court documents, and journal titles are not only
abbreviated using different word lists, but with different abbreviation
algorithms. Knowledge of these will generally not be important to writers, but
they are discussed briefly below.

\DescribeMacro\AbbreviateFor
|\AbbreviateFor|\marg{scheme}\marg{text} abbreviates a text based on a given
scheme. The schemes available are described below.


\subsection{Standard Abbreviation Algorithm}

The standard abbreviation algorithm is described in the package |abbrev.sty|,
which is of general applicability. The rules applied there are as follows:
\begin{itemize}
\item There exist different classes of abbreviations, each of which contains a
map associating full words with their abbreviated forms.
\item To abbreviate a text against a class, each word in the text is considered
in sequence to find the longest matches. This avoids ambiguity when there are
overlapping potential matches (a classic example being for law review articles,
where ``Lawyer'' abbreviated to ``Law.,'' which then theoretically abbreviated
to ``L..'').
\item Duplicative spaces are removed, to deal with situations where a word
abbreviates to nothing (i.e., it should not be included).
\item Two forms of dot management are performed. First, a space between two
single-letter initials, or between a single-letter initial and a number, is
removed. Thus, ``West Virginia Railroad'' would become ``W.V.R.R.'' with no
spaces. Second, two dots are collapsed into one, dealing with situations where
an abbreviated word is followed by a dot in the original text (e.g., in a URL).
\end{itemize}

\subsection{Cases and Other Names}
\label{abbscheme:name}
\label{abbscheme:inlcase}

\DescribeAbb{name}
\DescribeAbb{inlcase}
Case names must be abbreviated in two ways: for inline citations (with only a
few words abbreviated), and for non-inline citations. In addition to the
standard abbreviation rules, there is a set of words that are unabbreviatable
and also disfavored as short names (primarily country names and identifiers of
the state in criminal cases).

The case name abbreviation rule is also applied to other names, such as
institutional authors and agencies.

The case abbreviation scheme is called \abbscheme{name}, and the inline case
abbreviation
scheme is \abbscheme{inlcase}.


\subsection{Legislative Materials}
\label{abbscheme:leg}

\DescribeAbb{leg}
Legislative materials use the standard abbreviation rule, with just a different
table. However, ``Senate,'' ``House,'' and ``House of
Representatives'' alone are not abbreviated. The scheme is called
\abbscheme{leg}.


\subsection{Court Documents}
\label{abbscheme:cdoc}

\DescribeAbb{cdoc}
Court documents use the standard abbreviation rule, with just a different
table. The scheme is called \abbscheme{cdoc}.


\subsection{Journals}
\label{abbscheme:journal}

\DescribeAbb{journal}
Journal titles require the most complex scheme for abbreviation, because they do
not follow the usual abbreviation rules in several ways. The scheme for these
abbreviations is \abbscheme{journal}.

Initially, some reference types perform a check on journal names to see if they
were entered already abbreviated (based on the presence of any dots in the
name). If so, then a warning is issued and the journal name is not further
abbreviated. (The parameter \param{noabbrevjrn} will suppress this.) If not,
then abbreviation proceeds.


Next, there is the special case of single-word journal titles or journal titles
of ``The \meta{word}.'' These titles are never abbreviated and the word ``The''
is retained to prevent titles from becoming incomprehensible (\emph{The
Register} would become merely ``\emph{Reg.}'').


Finally, there is an exception for the deletion of spaces between single-letter
initials: The space cannot be removed when the one of the letters is geographic
or institutional, and the other letter is for subject matter. For example,
``North Carolina Law Journal'' would be abbreviated ``N.C.~L.J.,'' deleting all
spaces except that between ``C.'' and ``L\@.'' To implement this, the tables
effectively use two types of dots, normal periods for geographic/institutional
words and a special dot macro for subject matter words, and the dot management
algorithm is executed twice.


In terms of abbreviation of words, there are three sources: the table of
geographic locations, the table of institution names, and the table of common
words in journal titles. These tables implement the differentation between
institutional and subject-matter word dots.


\subsection{Procedural Phrases}
\label{abbscheme:expl}

\DescribeAbb{expl}
Procedural phrases use a unique set of word-based abbreviations, but there is
also a defined list of standard procedural phrases. Additionally, there is a
rule about use of commas at the end of phrases. Thus, the abbreviation algorithm
must consider a few additional rules. If a phrase to be abbreviated is a
predefined one, then the predefined abbreviated phrase is returned, with comma
usage established. If it is not, then the phrase is abbreviated, but a warning
is issued because the correctness of any trailing comma cannot be established.

The abbreviation scheme is called \abbscheme{expl}.

\DescribeMacro\ExplanatoryPhrase
The macro |\ExplanatoryPhrase|\marg{phrase} defines a new explanatory phrase.
The unabbreviated phrase should be given, including any trailing comma if
needed.


\subsection{Publishing Terms}
\label{abbscheme:pub}

\DescribeAbb{pub}
Abbreviations for publishing terms are used in the book publication
parenthetical, described in \sec{bookrefs-pubparen}. The scheme is called |pub|.

%%
%% \iffalse filename: fonts.dtx \fi
%%
\input driver
\thisis{fonts}{Fonts}

Legal citations use a variety of fonts in formatting citations. Complicating
matters, there is not consistency in which fonts are used in any given context.
Case names are italicized in legal memoranda but not in law review articles;
journal titles are set in small caps in some law review articles but in roman in
legal memoranda and some journals. Yet despite this variance across dialects of
legal citation, there tends to be much consistency within a single dialect:
Article titles tend to be formatted identically across a variety of article-like
references, as are book authors, signals, and so on.

To deal with this variance, the package introduces a layer of abstraction for
fonts. It first defines a set of font contexts: case names, article titles, book
authors, and so on. It then introduces a concept of ``font packs,'' namely
mappings between the font contexts and the actual fonts to be used. Reference
type definition macros do not invoke fonts directly, but rather specify font
contexts, which are then translated into actual fonts based on the font packs
the user chooses. This way, a variety of font conventions can be supported
without the need to revise reference definitions.


\subsection{Font Contexts}

The following is a table of all font contexts supported.

\begin{demo}
\def\hi@font@context@add#1#2{#1&#2\\}
\begin{tabular}{ll}
\textbf{Name} & \textbf{Description} \\
\hline
\hi@font@context@add{bookauthor}{Author of a book}
\hi@font@context@add{booktitle}{Title of a book}
\hi@font@context@add{congdoc}{Congressional document number}
\hi@font@context@add{hearing}{Hearing title}
\hi@font@context@add{arttitle}{Journal article title}
\hi@font@context@add{webtitle}{Website page title}
\hi@font@context@add{jrntitle}{Journal title}
\hi@font@context@add{caseproc}{Procedural phrase in a case}
\hi@font@context@add{casefc}{Case full name}
\hi@font@context@add{casesc}{Case short name}
\hi@font@context@add{const}{Constitution name}
\hi@font@context@add{statute}{Codified statute}
\hi@font@context@add{sig}{Signal}
\hi@font@context@add{comment}{Signal before commentary}
\hi@font@context@add{ell}{The letter (l) in subsections}
\hi@font@context@add{dateprefix}{The qualifier words before a date}
\hi@font@context@add{latin}{Latin words that are typically italicized}
\end{tabular}
\end{demo}


\subsection{Fonts}

Next, the available font commands that will be linked with font
contexts are defined. Standard \LaTeX\ font commands are not used. This is to
help with keeping track of which font is being used, to manage
capitalization, and to provide a few special features.

The fonts provided are emph, empht, rm, and sc. All have meanings identical
to typical \LaTeX, except for empht which is like emph except that it does not
turn internal emph into roman.


\subsection{Font Packs}

\DescribeMacro\MakeFontPack
A font pack associates font contexts with font commands. Each context receives
two font commands: one for use in non-inline citations, and one for use with
inline texts. The syntax for defining a font pack is as follows:
\begin{grammar}
|\MakeFontPack|\marg{name}\marg{font-specs} \\
\meta{font-specs} := \meta{font-spec} ( \littext{, } \meta{font-spec} )* \\
\meta{font-spec} := \meta{context} \littext{: } \meta{font} \littext{/}
\meta{font} \\
\meta{font} := \littext{emph} \| \littext{empht} \| \littext{rm} \| \littext{sc}
\\
\Example |\MakeFontPack{new}{booktitle: sc/empht, bookauthor: sc/rm}|
\end{grammar}
A font pack need not define every font context, since a user can select multiple
font packs. In the case of two font packs containing the same font context, the
last selected pack overrides earlier ones.

\DescribeMacro\UseFontPack
To invoke a font pack, call |\UseFontPack|\marg{name}.


The following font packs are predefined:
\begin{itemize}
\item \textbf{review}: Law review fonts.
\item \textbf{memo}: Legal memorandum fonts.
\item \textbf{italcase}: Full case names are always italicized. Select this
after review or memo.
\end{itemize}


\subsection{Shortcut Commands for Fonts}

\DescribeMacro\UseFontFor
Occasionally, the user needs to select a font manually, for example when
defining a hereinafter form that includes a part of a journal article's title.
The command |\UseFontFor|\marg{context}\marg{text} selects the font for
\meta{context} and sets \meta{text} in that font.

%%
%% \iffalse filename: state.dtx \fi
%%
\input driver
\thisis{state}{Full, Short, and \emph{Id.}\ Citations}

Except in limited circumstances, \unskip\footnote{These are namely internal
cross-references and Table of Authorities generation, described in \sec{xref}
and \sec{toa} respectively, both of which use \LaTeX's aux file system.} this
package processes citations linearly starting from the beginning of the document
and never looking backwards or forwards. As a result, it must constantly store
``state'' information about citations previously seen, in order to generate
contextually correct citations.

Two types of state information are discussed here: information about where
references were first or previously cited, and information about the last
citation shown.

\subsection{Short Forms}

For most references, there is a full citation form and a short one. The full
form is used first, and the short one used subsequently according to one of two
rules: Some references use a \emph{supra} short form that may be used
subsequently throughout, while for others the short form may only be used if a
full-form citation appeared in close proximity. The purpose of the previous
citation state memory, described below, is to determine which of these two forms
to use.

Complicating matters, citations can appear in footnotes and in body text, in
both law review articles and legal memoranda, and both in inline and non-inline
forms. All of these factors interact to affect whether a full or short form
citation should be used.

This package follows the following rules to determine long and short forms:
\begin{enumerate}
\item An inline short form may be used in text after the full form is used in
   text, either inline or in a citation.
\item An inline short form may be used in a footnote (a) if an inline short form
   may be used in text, (b) after a full citation in this or any previous
   footnote, or (c) after a full inline form in this footnote.
\item A short cite may be used in text after the full citation is used in text.
\item A short cite may be used in a footnote (a) after the full citation has
   been used in text, (b) after the full citation has been used in a footnote if
   this is a supra-type short cite, or (c) if the full citation has been used
   in the last five footnotes.
\end{enumerate}

\DescribeMacro\resetcitationforms
The command |\resetcitationforms| resets the aforementioned citation state,
forcing all citations to be the full form.


\DescribeMacro\ShowCitationState
The macro |\ShowCitationState|\marg{ref} gives a textual account of the state of
a reference at the point that the macro is called.


\paragraph{First Full Citation}\label{s:state-ffc}
For references that follow the five-footnote rule, formatting sometimes will
depend on whether a full citation is the first full citation in the document or
a later repeated one. For example, consider a case citation where several cases
with the same parties are being cited. Consider the following footnote
citations:
\begin{quotation}
1. Plaintiff v. Defendant  (\emph{Plaintiff I}), 123 F. Supp.\ 456 (S.D.N.Y.
1980).

10. Plaintiff v. Defendant  (\emph{Plaintiff II}), 234 F.2d 567 (2d Cir.\ 1981).

25. \emph{Plaintiff I}, 123 F. Supp.\ 456 (S.D.N.Y. 1980).

27. \emph{Plaintiff I}, 123 F. Supp.\ at 460.
\end{quotation}
The citation in footnote 25, despite being a full citation, ought to use the
short-form case name established earlier. It would be odd to repeat the citation
in footnote 1 entirely, because that would duplicatively include the short-form
parenthetical. But omitting the parenthetical renders footnote 27 ambiguous. As
a result, the best presentation for footnote 25 is to use just the established
short-form name with the rest of the case fully cited.

This package accounts for this problem by recording whether a reference
following the five-footnote rule has been cited previously, enabling citation
macros to adjust the contents of full citations accordingly.


\subsection{\emph{Id.} Forms}

In addition to long and short citation forms, a citation to a reference may be
replaced with \emph{id.}\ or otherwise altered if the immediately preceding
citation contains duplicative information. Another set of citation state
information must be maintained for this.

Generally, \emph{id.}\ may be used and citation information may be omitted when
it is the same as the previous citation. Assuming that |2 ref at 46| was
previously cited, then:
\begin{demo}
\begin{tabular}{llp{0.47\textwidth}}
\textbf{Next input} & \textbf{Produces} & \textbf{Explanation} \\
\hline
|2 ref at 46| & \emph{Id.} & Volume and page omitted \\
|2 ref at 48| & \emph{Id.}\ at 48 & Volume omitted \\
|3 ref at 50| & 3 \emph{id.}\ at 50 & Both numbers included \\
|3 ref at 46| & 3 \emph{id.}\ at 46 & Page cannot be omitted, as volume
differs \\
\end{tabular}
\end{demo}

However, there are two main exceptions to this information omission process.
First, not every duplicative element can be omitted, if a ``higher level''
element differs. In the last example above, the page number 46 is duplicative,
but it cannot be omitted because the volume number differs. Second, the presence
of multiple citation items in a context can prevent the use of \emph{id.} In
this example:
\begin{demo}
\ttfamily
|\sentence|\{see ref1 at 5; ref2 at 7\}. Further text. |\sentence|\{see ref2 at
7\}.
\end{demo}
No \emph{id.}\ may be used in the final citation, even though the reference and
page are identical to the immediately preceding one, because the first citation
string included two distinct references so \emph{id.} would be ambiguous.
However:
\begin{demo}
\ttfamily
|\sentence|\{see ref1 at 5; but see ref1 at 7\}. Further text. |\sentence|\{see
ref1 at 7\}.
\end{demo}
Here, the last citation should be formatted ``\emph{See} \emph{id.}~at 7.'' The
\emph{id.}\ is permissible because only |ref1| was cited in the first citation
string, but the page number cannot be omitted. Furthermore, a footnote can use
\emph{id.}\ in its first citation only if the previous footnote cited only one
reference.

To implement all of this, the package defines several state variables, generally
reflecting elements of citation items. Each state variable maintains four
pieces of information:
\begin{itemize}
\item A current value, set while the citation item is being processed and
formatted
\item A last value, reflecting the previous citation item's elements to
current citation item is allowed to use those previous values
\item A flag indicating whether the state variable has received too many values
within a citation string such that it cannot be used for element omission in a
subsequent string. This ``state of the state variable'' flag can take on one of
three conditions:
    \begin{itemize}
    \item Unset: The value at the start of the citation string.
    \item Set: A citation item has set the value of the state variable, and it
    may be used in a future citation string.
    \item Invalid: The state variable has been set two or more times to
    different values. It cannot be used in future citation strings, and it
    invalidates ``lower-level'' state variables as well.
    \end{itemize}
\item An ``invalidation list,'' namely the list of lower-level state variables
that become invalid if this state variable is invalid.
\end{itemize}


\subsubsection{List of State Variables}

\begin{demo}
\def\thelist{}
\def\hi@state@var#1{%
    \appto\thelist{#1&\csname invlist@#1\endcsname\\}%
}
\def\hi@state@setinv#1#2{%
    \@ifundefined{invlist@#1}{%
        \@namedef{invlist@#1}{#2}%
    }{%
        \csappto{invlist@#1}{, #2}%
    }%
}
\hi@state@var{case}
\hi@state@var{orig@page}
\hi@state@var{page}
\hi@state@var{inline}
\hi@state@var{opt}
\hi@state@var{vol}
\hi@state@var{title}
\hi@state@setinv{page}{orig@page}
\hi@state@setinv{case}{page}
\hi@state@setinv{case}{orig@page}
\hi@state@setinv{case}{inline}
\hi@state@setinv{case}{opt}
\hi@state@setinv{case}{vol}
\hi@state@setinv{case}{title}
\hi@state@setinv{title}{vol}
\hi@state@setinv{title}{page}
\hi@state@setinv{title}{orig@page}
\hi@state@setinv{title}{opt}
\hi@state@setinv{vol}{title}
\hi@state@setinv{vol}{page}
\hi@state@setinv{vol}{orig@page}
\hi@state@setinv{vol}{opt}
\begin{tabular}{ll}
\textbf{Variable} & \textbf{Invalidates} \\
\hline
\thelist
\end{tabular}
\end{demo}

\subsubsection{Updating Citation State}

The citation state needs to be updated for each citation string, citation item,
and footnote. The hook macros defined below are used throughout \sec{draw}.

At the beginning of a citation string, all the variables' last values are based
on the state of the system prior to the citation, and they all have a condition
of Unset.


At the beginning of each citation element, all current values are set to
|\relax|. Each element in a citation string can rely on the last values
in displaying itself, and can set the current variables as desired. Some
current variables may be set prior to the citation-specific macros (e.g.,
|\@this@case|).


At the end of each element in the citation string, all the current values
are checked against their last values.
\begin{itemize}
 \item If the condition is Unset then the condition becomes Set.
 \item If the condition is Set and the last value equals the current value, do
 nothing.
 \item Otherwise, the condition becomes Invalid, and the condition for any
   dependent state variables become Invalid.
\end{itemize}
In all cases, the last value becomes the current value, because within a
single citation string the invalidity state is irrelevant.


At the end of a citation string, all Invalid variables have their last value
set to |\relax|, and all Set variables retain their last value. (There should
be no Unset variables since every variable has its state reviewed for each
citation element, and there must be at least one citation element.)


At the end of a footnote, the last values of the state variables are either
globalized or relaxed, depending on whether there was one or more references
cited.


For inline citations, special handling of citation state is required as
described in \sec{iface}. Thus, several macros are provided for saving all the
state variables to a macro so that they can be restored or reset later.


\subsection{Footnote State Management}

Footnotes interact closely with both short and \emph{id.}\ citations: Whether a
short citation can be used depends in part on whether the full citation was in
text or a footnote, and \emph{id.}\ citations can be used at the start of a
footnote depending on the content of the previous footnote. How footnotes
interact with citation forms also depends in part on whether a document is a law
review or legal memorandum document.

As a result, several accounting tasks must be performed at the beginning and
ending of footnotes. For all types of articles, a flag is set indicating that
text is in a footnote, and at the end of footnotes any deferred note text that
has not been emitted (as described in \sec{parens}) is put at the end of the
note.

For law review articles, a counter is kept of how many unique citations have
appeared in the footnote. Each reference cited advances the counter by one,
except \emph{id.}\ citations advance the counter only from zero to one. The
\emph{id.}\ system above uses this counter to determine state after the
footnote. Legal memoranda, on the other hand, prohibit \emph{id.}\ cites at the
beginnings of footnotes, to avoid ambiguity as to whether \emph{id.}\ refers to
the last footnote or the last in-text citation.

%%
%% \iffalse filename: supra.dtx \fi
%%
\input driver
\thisis{supra}{\emph{Supra} Short Forms}

Some citations use a short form that reads ``\meta{desc}, \emph{supra} note
\meta{num}.'' Additionally, a writer may specify the |hereinafter| reference
parameter for a reference, which applies a \emph{supra} short form to that
reference. This section describes how such citations are produced and managed.

\DescribeMacro\hi@supra@form
A reference type that uses a \emph{supra} citation should execute:
\begin{demo}
|\hi@supra@form|\marg{ref}\marg{desc}
\end{demo}
in constructing citation macros. The
argument \meta{ref} is the reference name, and \meta{desc} is the description
to precede the word ``\emph{supra}.'' The description is usually the reference
author's last name, and it may use font shortcut commands as described in
\sec{fonts}.

Setting up a \emph{supra} form requires performing the following tasks:
\begin{itemize}
\item Registering the description as a short citation name for duplicate
checking, as described in \sec{short}.
\item Creating both a short citation form and an inline form, where the inline
form displays the description text.
\item Records that \meta{ref} is a \emph{supra}-type reference that does not
follow the five-footnote rule, to conform with the expectations of short
citation state described in \sec{state}.
\end{itemize}


%%
%% \iffalse filename: format.dtx \fi
%%
\input driver
\thisis{format}{Miscellaneous Formatting}

This section describes various formatting utility macros that are used when
defining citation formats.

\subsection{Ordinal Numbers}

In several situations it is useful to convert numbers to text. Several macros do
this, and can add ordinal number suffixes as well.


\subsection{Trailing Dot Management}

When the text of a formatted citation item ends with a dot but the citation
string is followed by a period, the extraneous dot needs to be removed. To do
so, this package provides an infrastructure for tracking whether a citation item
ends with a dot. Reference definer macros must use this infrastructure to
indicate when the last item they emit to the document is a dot.


\subsection{Capitalization}

At the beginnings of sentence citations, the first letter needs to be
capitalized. \unskip\footnote{Capitalization also occurs inside sentence
citations between signal classes, as explained in \sec{signals}.} The first
letter could be part of a signal or text within the citation text itself, and
the citation text might contain prefatory font or other macros. Thus, this
package provides an infrastructure for citation macros to capitalize the first
letter of displayed text when necessary, but not to further capitalize
subsequent text.

The font macros in \sec{fonts} use the capitalization system extensively.


\subsection{``The''}

Statutes and other reference names may start with the word ``The.'' When those
are used inline as adjectives, the word ``The'' generally ought to be removed.
This is done by replacing the leading definite article with a special macro that
displays as text in non-inline citations but may be suppressed in adjective
inline citations.


\subsection{Other Macros}

A variety of other macros deal with using citation parameters, differentiating
between citation contexts (inline, nameless, optional arguments), and spacing.


\clearpage
\part{Reference Types}
\label{p:alltypes}

This Part is a comprehensive list of every reference type that \hia* supports.
Reference types are organized topically into chapters which contain both
introductory material describing overall characteristics of reference types and
then specific definitions. The chapters contain three types of subheadings
indicating the material contained:
\begin{itemize}
\item Numbered headings in serif type are general descriptions of reference type
features.
\item Unnumbered headings in \textbf{\textsf{sans serif type}} describe specific
reference types, which may be invoked using |\def|\meta{reference type} commands
as described in \sec{refs-syntax}.
\item Headings in \textbf{\textit{\textsf{italic sans serif type}}} describe
reference types that are aliases for other types.
\end{itemize}

\section{What If the Type I Need Isn't Listed?}

The available
reference types reflect the package author's own
citation needs over the years. Having used this package many times to write a
diverse range of works involving technical, historical, judicial, political, and
media references, he has covered nearly every type of conventionally cited work.
Nevertheless, in the event that a writer needs to cite a reference type not
specifically defined here, the package makes several affordances.

First, several reference types are designed to be catch-all types. For
government documents, \rtype{govdoc} provides a generic format for references
cited in the \emph{Federal Register} and other reporters, and for miscellaneous
agency promulgations that are essentially unpublished. For non-governmental
works published in some periodical format, \rtype{website} works as a generic
format, especially since it accepts any publication parameters that can be
attached to a book (\param{editor}, \param{publisher}, etc.; see
\sec{bookrefs-pubparen}). Works that are part of a published book or volume can
generally be defined using the highly flexible \rtype{citecontainer} type.

If truly nothing works, then the reference \rtype{verbatim} can be used to
inject arbitrary text into a citation. Even when that is used, the writer still
enjoys most of the structural capabilities of this package: signals management,
string citations, and so on.

Finally, writers faced with a class of unexpected reference types are encouraged
to develop new citation macros. The syntax and programming conventions for
reference type definer macros are not simple, so it may be easiest to make small
tweaks to the existing reference definitions. In doing so, the package author
recommends using more specific, uncommon reference types as a starting point,
such as those in \sec{specrefs}. The widely used reference types such as
\rtype{case} and \rtype{book} require a great deal of code to deal with many
different inputs and the idiosyncractic historical rules of legal citation for
those types, and would be difficult for would-be package improvers to understand
at first. Reference types such as \rtype{procart}, designed to cover a narrower
class of references and that include fewer features, would be easier to revise
to one's tastes.

%%
%% \iffalse filename: caseref.dtx \fi
%%
\input driver
\thisis{caseref}{Cases}


\subsection{Parties and Case Titles}

\label{s:caseref-parties}

There are three ways a case can be named, which dictate the parameters that must
be given for a case reference definition:
\begin{itemize}
\item With adversarial parties, such as \emph{Brown v.~Board of Education}. The
parameters \param{p} and \param{d} set each party name, and the \param{parties}
parameter can be used to set both at once.

\item With a single name, such as \emph{In re Alappat}. The \param{name}
parameter accepts this type of case name.

\item With both adversarial parties and a common name. This occurs with older,
well-known Supreme Court cases, such as \emph{Consolidated Electric Light Co.\
v.\ McKeesport Light Co.}\ (The Incandescent Lamp Patent Case), and with modern
class-action litigation. All of the aforementioned parameters should be used for
these cases.
\end{itemize}

These input parameters are used to produce five formatted names for the case:
\begin{itemize}
\item The full title, used in full inline citations. This is abbreviated
according to the \abbscheme{inlcase} scheme.
\item The abbreviated full title, used in full non-inline citations. This is
abbreviated according to the \abbscheme{name} scheme.
\item The abbreviated full title to be used in the Table of Authorities. This
differs in spacing (an optional line break is placed before the versus) and in
text order (phrases like \emph{In re} are placed at the end rather than the
beginning). It is abbreviated according to the \abbscheme{inlcase} scheme.
\item The short form for inline citations, abbreviated with the
\abbscheme{inlcase} scheme.
\item The abbreviated short form for non-inline citations, using the
\abbscheme{name} scheme.
\end{itemize}


\paragraph{Party Name Syntax}

Party names for \param{p} and \param{d} have the form:
\begin{grammar}
\meta{party} := \meta{text} [ \littext{ex rel.} \meta{text} ] \\
\Examples |Doe|\\|State ex rel. Adams|
\end{grammar}
The ``base'' name and the name after ``ex rel.''\ are treated as two separate
names, each a candidate for being the case's short name.


For common case names with the \param{name} parameter, there are more
possibilities because prefixes \emph{In re} and \emph{Ex parte} can be used:
\begin{grammar}
\meta{name} := [ \littext{In re} \| \littext{Ex parte} ] \meta{text} [
\littext{ex rel.} \meta{text} ]\\
\Examples |In re Comiskey|\\|Ex parte New York ex rel. Jones|
\end{grammar}
The latter example is procedurally implausible but nevertheless syntactially
acceptable.


\paragraph{Full Name Formatting}

There are three full names required, for inline, non-inline, and Table of
Authorities citations. How each appears depends on which parameters are given:
\begin{itemize}
\item If party names are given alone, then the full names are ``\meta{p}
v.~\meta{d}'' appropriately abbreviated.
\item If party names and a common name are given, then the full names are
``\meta{p} v.~\meta{d} (\meta{name})'' appropriately abbreviated.
\item If only the name is given, this is the most complex case. If the name
begins with ``The,'' then the inline form uses |\hi@inline@the|, and the word
``The'' is placed at the end of the Table of Authorities form. If the name
begins with a prefix like \emph{In re}, then the prefix is placed at the end of
the Table of Authorities form. Otherwise, the name is assembled with ``The'' and
the prefix attached, appropriately abbreviated.
\end{itemize}
Additionally, the fonts need to be set up in assembling the full name forms.
This is because the name can use multiple fonts internally, for different parts.


\paragraph{Selecting the Short Name}

In theory, there are up to six possible candidates for the short name of a case
citation: the two parties, the common name, and the \emph{ex rel.}\ components
of each of those. To decide which of them is the best, this package employs a
scoring system applied to each candidate name. The following factors are
considered:
\begin{itemize}
\item Names that are impermissible party names receive the lowest scores; they
will be used only if there is no other option.
\item Names with capitalized first words or the word ``of'' are less likely to
be good short names so they receive lower scores.
\item \emph{Ex rel.}\ names are disfavored over base party names to the extent
that none of the above factors apply.
\item Common names are preferred over topside parties, which are preferred over
bottomside parties, to the extent that none of the above factors apply.
\end{itemize}


\paragraph{Formatting the Short Name}
Short names may be user-provided or automatically determined based on the
selection algorithm above. To format the short name, several tasks must be
performed:
\begin{itemize}
\item For user-given short names, the word ``the'' at the beginning needs to be
processed for |\hi@inline@the|.
\item For automatically determined short names, some conventional words are
removed from the name as described below.
\item The short name must have appropriate fonts set.
\item If the short name is not obviously connected to the full name, then the
full name inline name requires a parenthetical, and the full citation name (a)
requires a parenthetical the first time it is ever used and (2) should actually
use the short name on subsequent uses, as described in \sec{state-ffc}.
\end{itemize}


Regarding the removal of conventional words, these are typically business
or geographical designations that are uninformative for the short name. A list
of ignored words follows:
\begin{demo}
\def\hi@case@shortfmt@add#1{\hb@xt@ 7em{\chop@space{#1}\hss} }%
\leavevmode
\hi@case@shortfmt@add{,}
\hi@case@shortfmt@add{ Inc.}
\hi@case@shortfmt@add{ Co.}
\hi@case@shortfmt@add{ Corp.}
\hi@case@shortfmt@add{ LP}
\hi@case@shortfmt@add{ LLP}
\hi@case@shortfmt@add{ LLLP}
\hi@case@shortfmt@add{ P'ship}
\hi@case@shortfmt@add{ Partnership}
\hi@case@shortfmt@add{ LLC}
\hi@case@shortfmt@add{ Ltd.}
\hi@case@shortfmt@add{ America}
\hi@case@shortfmt@add{ Am.}
\hi@case@shortfmt@add{ USA}
\hi@case@shortfmt@add{ International}
\hi@case@shortfmt@add{ Int'l}
\hi@case@shortfmt@add{ of}
\end{demo}

\subsection{Nominative Reporters}

Generally, reporter names are not abbreviated or changed from what is given as
input to the parameter \param{rep}. This is because reporters are conventionally
known by their abbreviations, and there is no consistency in reporter
abbreviations. However, some common reporters have both an official series name
and nominative reporter names. Volume 21 of the \emph{United States Reports},
for example, is also volume 8 of Wheaton's reports, and typically both are
cited:
\begin{demo}
|21 U.S. (8 Wheat.) 1|
\end{demo}
In most cases, the pagination of the series reporter and the nominative reporter
is the same, and adding the nominative reporter is a simple matter of looking up
the corresponding name in a table. As a result, this package handles these
nominative reports automatically. For nominative reporters with different
pagination, use the \param{parallel} parameter.


\subsection{Date Parenthetical}

\label{s:caseref-date}

Ordinarily the date parenthetical for cases contains the \param{court} and
\param{year} parameters. A complication arises when the case is being cited as
part of a \rtype{casedoc} reference. In that case two things need to happen:
\begin{itemize}
\item If this case has a reporter listed (\param{rep} is set), then a
parenthetical for the docket number must be added.
\item If the case document has its own date set, then that date overrides the
date given for the case. \unskip\footnote{This does not conform to some legal
citation practices, which attach the date of the case decision rather than the
date of the document. That practice seems questionable since the date of
interest to the reader is more likely the case document's date. Nevertheless, it
is simple enough to assign the case decision's date to the case document when
defining the case document reference.}
\end{itemize}


\subsection{Procedural History}

\label{s:caseref-history}

Procedural history for a case is given in the \param{prior} and
\param{subsequent} parameters, which are used to construct parentheticals. The
syntax for those parameters is:
\begin{grammar}
\meta{history} := \meta{phrase} \littext{: } \meta{ref} \\
\Example |reversed: prior-case|
\end{grammar}
The \meta{phrase} is an explanatory phrase that will be abbreviated and also
checked against a table of valid explanatory phrases. If a desired phrase is not
already listed, the macro
\DescribeMacro\ExplanatoryPhrase
|\ExplanatoryPhrase|\marg{phrase[,]} is used. Note that the comma at the end of
the argument is significant, as some explanatory phrases use a comma and others
do not.

The main task to be accomplished in producing case history is reconciliation of
names. If the case being defined and the case in its history parenthetical have
the same-named parties, then the name can be omitted from the case in the
history parenthetical. If they have different names, then the phrase ``sub
nom.''\ must be added to explanatory phrases that end with a comma.


\input docparams

\hi@newcite\defcase{A case citation}{%
    \hi@citetype{#1}\hi@type@case
    \hi@case@def{#1}%
}
\keyparameters{%
    {p, d}{Parties named in the case.}
    {name}{A common or single name for the case. Required unless parties are
    given.}
    {vol, rep, page, cite}{Citation to the reporter containing the case.}
    {docket}{The docket number of the case. Required if \param{cite} parameters
    are not given, or may optionally be given if \rtype{casedoc} references will
    use this case.}
    {court}{The court deciding the case, which may be omitted if the reporter
    uniquely identifies the court.}
    {year}{The date of decision. For citing cases not yet decided, a qualifier
    word should be included to explain the procedural posture.}
    {inline}{A user-defined short name for this case.}
}
\optparameters{
    {inlinedefendant}{Don't use the first party as the short name.}
    {dbid}{A database identifier for unreported cases. This is optional since
    the docket number and court are sufficient to identify an unreported case.}
    {slip}{Whether this is a slip opinion; this adds a note to the page
    numbers.}
    {prior, subsequent}{Procedural history of the case, see
    \sec{caseref-history}.}
    {enbanc, mem, percuriam}{Parentheticals denoting the nature of the
    opinion.}
}
\begin{demo}
\Example
\begin{verbatim}
\defcase{goodyear-dunlop}{
    parties={Goodyear Dunlop Tires Operations, SA v. Brown},
    cite=564 U.S. 915,
    year=2011,
}
\end{verbatim}
\Produces \emph{Goodyear Dunlop Tires Operations, SA v.~Brown}, 564 U.S. 915
(2011).
\end{demo}
In this example, note the use of the \param{parties} and \param{cite}
parameters, as shortcuts to entering \param{p}, \param{d}, \param{vol},
\param{rep}, and \param{page}. Also observe that the party names are entered
unabbreviated, but reporters and court names are entered abbreviated (because
those are never used unabbreviated, and the abbreviations are too inconsistent).

\begin{demo}
\Example
\begin{verbatim}
\defcase{nimitz}{
    name=In re Nimitz Technologies LLC,
    court=Fed. Cir.,
    percuriam,
    date=dec 8 2022,
    docket=2023-103,
}
\end{verbatim}
\Produces \emph{In re Nimitz Techs.\ LLC, No.\ 2023-103 (Fed.\ Cir.\ Dec.\ 8,
2022)}.
\end{demo}
This demonstrates a case with a single name rather than adversarial parties, and
with a docket number rather than a reporter citation.

\hi@newcite\defadmincase{An administrative decision}{%
    \hi@citetype{#1}\hi@type@admin
    \hi@case@def{#1}%
}
This is the same as a case with \param{citetype} set to |admin|. Parameters are
identical to \rtype{case} with the following addition:

\keyparameters{{agency}{Same as \param{court} but abbreviates the name.}}

\begin{demo}
\Example
\begin{verbatim}
\ExplanatoryPhrase{affirmed without opinion,}
\defadmincase{biodelivery}{
    parties={BioDelivery Sciences International, Inc. v. RB
        Pharmaceuticals Ltd.},
    docket=No. IPR2014-00325,
    court=P.T.A.B.,
    date=jun 30 2015,
    slip,
    paren=final written decision,
    subsequent=affirmed without opinion: biodelivery-cafc
}
\end{verbatim}
\Produces \emph{BioDelivery Scis.\ Int'l, Inc.\ v.\ RB
        Pharms.\ Ltd.}, No.\ IPR2014-00325 (P.T.A.B. June 30, 2015) (final
        written decision), \emph{aff'd without opinion}, \ldots
\end{demo}
This shows an administrative decision citation with subsequent history. The
reference |biodelivery-cafc| would be defined elsewhere.

\hi@newcite\defcasedoc{Document used in a case}{%
    \hi@citetype{#1}\hi@type@other
    \hi@ifset\hi@kv@citation{}{%
        \PackageError\hi@pkgname{%
            Missing citation for casedoc #1
        }{%
            A reference to a case is required for \string\defcasedoc
        }%
    }%
    \hi@newcite@form{fc}{#1}{%
        \hi@citeguts{%
            \noexpand\@capnext
            \hi@kv@name
            \hi@maybepage{ at }%
            ,
            \def\noexpand\hi@casedoc@docket{\hi@kv@docket}%
            \def\noexpand\hi@casedoc@date{\hi@kv@year}%
            \noexpand\hi@noid
            \let\noexpand\@last@inline\relax
            \noexpand\clause{\hi@kv@citation}\noexpand\hi@clause@endflag
        }%
        \hi@inline@never{%
            \hi@record@cite{\hi@kv@citation}%
            \hi@ifset\hi@kv@number{%
                \hi@parens@add\hi@paren@docno{Doc.\ No.\ \hi@kv@number}%
            }{}%
            \the\hi@param@parens
        }%
    }%
    \hi@newcite@form{sc}{#1}{%
        \hi@citeguts{%
            \hi@kv@name
            \hi@maybepage{ at }%
            ,
            \def\noexpand\hi@casedoc@docket{\hi@kv@docket}%
            \noexpand\hi@noid
            \noexpand\clause{\hi@kv@citation}\noexpand\hi@clause@endflag
        }%
    }%
}

\keyparameters{
    {name}{The name of the document.}
    {citation}{The reference name of the case in which this document was
    filed.}
    {docket}{The docket number of the case, if it was not already given in the
    case.}
    {year}{The date of the document itself.}
    {number}{The document number or docket list entry. This is added as a
    parenthetical, preceded by ``Doc.~No.''}
}

\begin{demo}
\Example
\begin{verbatim}
\defcasedoc{wyze}{
    citation=case: {
        parties={Wyze Labs, Inc. v. Beijing Rockrobo
            Technology Co.},
        docket=2:21-cv-941,
        court=W.D. Wash.,
        date=dismissed jan 3 2022,
    },
    name=Complaint for Declaratory Judgment,
    date=july 15 2021,
}
\end{verbatim}
\Produces Complaint for Declaratory Judgment, \emph{Wyze Labs, Inc.\ v.\ Beijing
Rockrobo Tech.\ Co.}, No.\ 2:21-cv-941 (W.D. Wash.\ July 15, 2021).
\end{demo}
Here, the underlying case is defined using an anonymous reference definition
(see \sec{anonymous}).

\hi@newcite\defcourtdoc{A document in the docket of current litigation}{
    \@expand\hi@abbrev@cdoc\hi@kv@name i{\def\hi@kv@name}%
    \hi@ifset\hi@kv@inline{%
        \@expand\hi@abbrev@cdoc\hi@kv@inline i{\def\hi@kv@inline}%
    }{%
        \hi@ifset\hi@kv@number{%
            \protected@edef\hi@kv@inline{Doc.\ No.\ \hi@kv@number}%
        }{%
            \let\hi@kv@inline\hi@kv@name
        }%
    }%
    \hi@newcite@form{fc}{#1}{%
        \hi@citeguts{%
            \hi@kv@name
            \hi@testfordot\hi@kv@name
            \hi@maybepage{\hi@page@space\hi@kv@name}%
            \hi@ifset\hi@kv@year{, \hi@kv@year\noexpand\@hi@dotfalse}{}%
        }%
        \hi@ifset\hi@kv@number{%
            \hi@parens@add\hi@paren@docno{Doc.\ No.\ \hi@kv@number}%
        }{}%
        \the\hi@param@parens
    }%
    \hi@newcite@form{sc}{#1}{%
        \hi@citeguts{%
            \hi@kv@inline
            \hi@testfordot\hi@kv@inline
            \hi@maybepage{\hi@page@space\hi@kv@inline}%
        }%
    }%
}
It is intended for use in a legal brief or filing, to cite to other documents in
the docket of the same case in which the document is being filed. For example,
a brief in opposition to a motion may use this reference type to cite arguments
in the motion papers. To cite briefs or documents filed in another case, use
\rtype{casedoc}.

This package does not use parentheses around citations to court documents. This
is because it makes the citation form incompatible with other citations (e.g.,
if one cites a court document and a statute in one string cite). Furthermore,
most court documents filed today do not appear to use parentheses, and courts do
not appear to require them. If they are desired, commands such as |\sentence| or
|\clause| can be surrounded with parentheses.

In most appellate work and particularly before the Supreme Court, this reference
type is rarely used. The more common practice now is to name the document to be
cited in text and then include ``(at \meta{page})'' within the sentence:
\begin{demo}
Petitioner's brief argues (at 8) that the sky is red, but that is wrong.
\end{demo}
There is not really a need for automation of these kinds of citations.

\keyparameters{
    {name, inline}{Full and short names for the document. They will be
    abbreviated according to the \abbscheme{cdoc} scheme.}
    {number}{The document number of the document being cited, if one is present.
    The phrase ``Doc.~No.''\ will be prepended to it, and the number will be
    made a parenthetical to the citation. If \param{inline} is not given, then
    the document number will be used as the short name. (Otherwise the short
    form will be the same as the full name.)}
    {year}{The date the document was filed.}
}
%%
%% \iffalse filename: constrefs.dtx \fi
%%
\input driver
\thisis{constrefs}{U.S. Constitutions and Founding Documents}

These references cover the U.S. Constitution, state constitutions, and other
founding documents such as the \emph{Federalist} papers and the Declaration of
Independence.

\input docparams

\hi@newcite\defconst{Citation to a constitution}{%
    \hi@citetype{#1}\hi@type@const
    \hi@ifset\hi@kv@name\relax{%
        \PackageWarning\hi@pkgname{%
            Constitution citation requires "name" argument
        }%
        \let\hi@kv@name\@empty
    }%
    \hi@replacethe\hi@kv@name{\hi@const@part{#1}}{%
        \hi@const@part{#1}{\@capnext\hi@kv@name}%
    }%
}
Because of the intensive way in which parts of constitutions are analyzed, this
package provides that each \emph{part} of a constitution to be cited should be
defined as a separate reference.

\keyparameters{
    {name}{The textual name of the constitution part being cited. This can be a
    textual representation of the pin cite (e.g., ``Article II'') or a common
    name (e.g., ``the Equal Protection Clause'').}
    {page}{The pin cite specification for the constitution part for this
    reference. Typically this will be a listing of named divisions:
    \texttt{article 1, S 8, clause 8}, for example.}
}
\optparameters{
    {place, state}{The state from which this constitution originates, if not
    ``U.S\@.'' The place will be abbreviated using the \abbscheme{name} scheme.}
    {year}{The year of adoption, for superseded constitutions. To enter years
    for adoption of specific amendments or provisions, use \param{paren}.}
}

\pagejoining

\begin{demo}
\Example
\begin{verbatim}
\defconst{a2s3}{
    name=the Take Care Clause,
    page={Article II, S 3}
}
\end{verbatim}
\end{demo}

\hi@newcite\defconstamend{A Constitutional amendment}{%
    \hi@citetype{#1}\hi@type@const
    \edef\hi@kv@page{amendment \expandafter\@Roman\hi@kv@number}%
    \hi@const@part{#1}{%
        \hi@inline@the
        \@expandarg\hi@numtotxt{\hi@kv@number}
        Amendment%
    }%
}
This is just a shortcut for \rtype{const} when defining whole amendments. The
parameters and usage are identical to \rtype{const} except the \param{name} and
\param{page} parameters are automatically set to ``the \meta{ordinal-number}
Amendment\\ and ``amendment \meta{number}'' respectively.

\keyparameters{
    {number}{The number of the amendment. This should be a regular Arabic
    number; it will be converted to Roman numerals for the citation form and
    ordinal number text for the inline form.}
}

\begin{demo}
\Example
\begin{verbatim}
\defconstamend{1a}{
    number=1,
}
\end{verbatim}
\end{demo}

\hi@newcite\deffounding{A national founding document}{%
    \hi@citetype{#1}\hi@type@found
    \hi@statcode@setup@idpc{#1}% Set up id. and page numbering
    \hi@include@page@in@toa{#1}
    \hi@newcite@form{fc}{#1}{%
        \hi@citeguts{%
            \noexpand\hi@fn@const{\hi@kv@name}%
            \hi@pageordefault{ }{%
                \hi@ifset\hi@kv@page{ \@format@page@macro\hi@kv@page}{}%
            }%
        }%
        \the\hi@param@parens
        \hi@ifset\hi@kv@year{%
            \hi@parens@add{\hi@paren@date}{\hi@kv@year}%
        }{}%
    }%
    \hi@newcite@form{lc}{#1}{%
        \noexpand\hi@toa@duptitle{}{\hi@fn@const{\hi@kv@name}}{%
            \hi@pageordefault{ }{%
                \hi@ifset\hi@kv@page{ \@format@page@macro\hi@kv@page}{}%
            }%
            \the\hi@param@parens
            \hi@ifset\hi@kv@year{%
                \hi@parens@add{\hi@paren@date}{\hi@kv@year}%
            }{}%
        }{%
            \hi@pageordefault{ }{%
                \hi@ifset\hi@kv@page{ \@format@page@macro\hi@kv@page}{}%
            }%
        }%
        \the\hi@param@parens
        \hi@ifset\hi@kv@year{%
            \hi@parens@add{\hi@paren@date}{\hi@kv@year}%
        }{}%
    }%
}
This generalizes the form for citing the Declaration of Independence, for
which the reference type is otherwise unclear. \unskip\footnote{The
\emph{Bluebook} does not define a type for the Declaration of
Independence but gives it as an example of how to cite subdivisions.
Nevertheless, the chosen format is puzzling. It puts ``The'' in front of the
name, even though ``The'' is typically omitted from titles of statutes. (``The''
is not omitted from book titles that actually start with ``The,'' but the
Declaration does not have an official title on its face.)

It then puts ``U.S.'' in the date parenthetical. Putting aside the question of
whether the United States existed at the time the Declaration was signed, it is
unclear why the country is included in the parenthetical rather than as part of
the title. Typically, that placement of a jurisdiction would identify a court or
similar tribunal issuing a decision, but it is a stretch to say that the
Declaration is an adjudicated result. If it is to identify the country issuing
the Declaration to distinguish from other nations' declarations of independence,
then ``U.S.'' ought to be added in a separate parenthetical based on the usual
rule for foreign materials. The best interpretation perhaps is that the
Declaration is being cited as a book, explaining the superfluous ``The,'' and
that the United States is being identified as the publisher of a pre-1900
work---a strange approach for many reasons.}
Mainly, this form provides a flexible citation container that sets the given
title in the same font as that for constitutions.

\keyparameters{
    {name}{The name of the document.}
}
\optparameters{
    {year}{The relevant year of the document.}
}

\pagejoining

\hi@newcite\deffederalist{A Federalist paper}{%
    \hi@citetype{#1}\hi@type@other
    % TODO: add editor info
    \hi@newcite@form{fc}{#1}{%
        \hi@citeguts{%
            \hi@fn@booktitle{\hi@book@the Federalist No.~\hi@kv@number}%
            \space(\hi@kv@author)%
        }%
    }
    \protected@edef\reserved@a{%
        {\noexpand\hi@fn@booktitle{The Federalist No.~\hi@kv@number}}%
    }
    \@expand{\hi@supra@form{#1}}\reserved@a i%
}

\keyparameters{
    {number}{The number of the paper.}
}
\optparameters{
    {author}{The author of the paper.}
}
%%
%% \iffalse filename: statrefs.dtx \fi
%%
\input driver
\thisis{statrefs}{Statutes}

\subsection{Short Statute Names}

\label{s:statrefs-short}

Many types of references will use the following convention for statute names.
The following inputs are relevant, with syntax as follows:

\keyparameters{
    {name}{The full, unabbreviated name of the statute or document. The word
    ``The'' should not be included at the beginning; it is assumed that the full
    name would be recited with ``The'' in ordinary speech.}
    {inline}{The short, abbreviated name of the statute or document. Because
    some abbreviated names include ``the'' at the beginning and others do not
    (compare ``the FFDCA'' with ``HIPAA''), it is necessary to specify the form.
    For references that use ``the'' before the short name, include it in this
    parameter.}
}

For both the full and short forms, the package will automatically prepend
``the'' or ``The'' at the beginning of the name depending on citation context,
particularly when |\Inline| or |\adjective| are used (see \sec{iface}).

If no short name is given, then one is automatically constructed that is
identical to the full name, except any year specification will be removed (e.g.,
``Communications Act of 1930'' would be shortened to ``Communications Act'').
The word ``the'' is implicitly added to the start of the constructed short name
as well.


\input docparams

\hi@newcite\defstatcode{A statute in a code}{%
    \hi@citetype{#1}\hi@type@statute
    \hi@statcode@setup{#1}%
}
\keyparameters{
    {vol, rep}{The volume number and title of the statutory code.}
    {page}{The section or other subdivision number of the statute in the code.}
}
\optparameters{
    {name, inline}{\statuteparamdesc}
    {origsect}{If the statute has a section number different from its
    codification section number, that original section number may be included
    here.}
    {year}{The year of publication of the code containing the statute.}
}
\bookparenparameters

\pagejoining

\begin{demo}
\Example
\begin{verbatim}
\defstatcode{15-usc-1}{
    cite=15 U.S.C. S 1,
}
\end{verbatim}
\Produces 15 U.S.C. \textsection~1.
\end{demo}

The \cmd\defcitegroup command is especially useful in
combination with |\defstatcode|; see \sec{refs-citegroups} for examples.

\begin{demo}
\Example
\begin{verbatim}
\defstatcode{337}{
    name=Tariff Act of 1930,
    origsect=S 337,
    cite=19 U.S.C. S 1337,
    paren=as amended,
}
\end{verbatim}
\Produces Tariff Act of 1930 \textsection~337, 19 U.S.C. \textsection~1337 (as
amended).
\end{demo}
This demonstrates a statute that has been codified with a section number
different from its session law section, where the session law section number is
still commonly used.

\hi@newcite\defregcode{A regulation in a code}{%
    \hi@citetype{#1}\hi@type@regulation
    \hi@statcode@setup{#1}%
}
This only differs from \rtype{statcode} in the \param{citetype} being
|regulation| rather than |statute|. The parameters and features are the same as
those for \rtype{statcode}.
\hi@newcite\defstatsess{A statute in session laws}{%
    \hi@citetype{#1}\hi@type@statute
    \hi@statsess@name
    \hi@inlinestatname{#1}%
    \hi@ifset\hi@kv@type{}{\def\hi@kv@type{Pub. L. No.}}%
    \hi@ifset\hi@kv@rep{\hi@ifset\hi@kv@vol\relax{\let\hi@kv@vol\hi@kv@year}}{}%
    \hi@ifset\hi@kv@year{%
        \def\reserved@a{}%
        \hi@ifset\hi@kv@name{\add@macro@to@macro\reserved@a{\hi@kv@name,}}{}%
        \hi@ifset\hi@kv@vol{\add@macro@to@macro\reserved@a{\hi@kv@vol,}}{}%
        \hi@ifset\hi@kv@rep{\add@macro@to@macro\reserved@a{\hi@kv@rep,}}{}%
        \@expand{\expandafter\in@\expandafter{\hi@kv@year}}\reserved@a i%
        \ifin@ \hi@undefine\hi@kv@year \fi
    }{}%
    \hi@ifset\hi@kv@in{%
        \hi@statsess@contained{#1}%
    }{%
        \hi@statsess@normal{#1}%
    }%
    \hi@statsess@shortforms{#1}%
}

\keyparameters{
    {type}{The name to be prefixed to the statute's serial number. By default
    this is ``Pub.~L.~No.''}
    {number}{The serial number of the statute, which should conform to the value
    expected for \param{type}.}
    {vol, rep, page, cite}{Citation locator information for the statute in a
    session law compilation such as the \emph{Statutes at Large}. This will be
    used unaltered and should be entered abbreviated.}
    {year}{The date of enactment of the statute.}
}
\optparameters{
    {name, inline}{\statuteparamdesc\ If no name is given, one will be
    constructed out of the date (which should be a full date as a result).}
    {chapter}{This sets \param{type} to ``ch.''\ and then sets \param{number} to
    the parameter value.}
    {in}{For session laws contained within another larger session law (e.g., a
    part of an omnibus budget act), it may be necessary to cite both session
    laws to identify the contained one. This parameter can be given the
    reference name of the larger session law to effect this citation form.}
    {slip}{For slip laws not yet included in a compilation, use this flag.}
    {place}{The place of publication (e.g., the state).}
    {publisher}{The publisher of the statute, if relevant.}
}

\begin{demo}
\Example
\begin{verbatim}
\defstatsess{nttaa}{
    name=National Technology Transfer and
    Advancement Act of 1995,
    inline=NTTAA,
    publiclaw=104-113,
    cite=110 Stat. 775
}
\sentence{nttaa at S 12/d1 ::stat: 783}.
\end{verbatim}
\Produces National Technology Transfer and Advancement Act of 1995 (NTTAA),
Pub.\ L.\ No.\ 104-113, \textsection~12(d)(1), 110 \textsc{Stat.}\ 775, 783.
\end{demo}
Note how a pin cite to a session law must include not only the section number,
but also the Statutes at Large page number following a |::stat:| segment marker.
See \sec{pages-segments} for more on segments in pin cites.

\hi@newcite\defstattitle{A titled statutory citation}{%
    \hi@citetype{#1}\hi@type@statute
    \hi@include@page@in@toa{#1}%
    \hi@inlinestatname{#1}% Set up \hi@kv@inline based on \hi@kv@name
    \@expand\hi@abbrev@name{\hi@kv@rep}i{\def\hi@kv@rep}%
    \hi@book@pubparen
    \hi@newcite@form{fc}{#1}{%
        \noexpand\hi@stattitle@choppageslash
        \hi@pstruct@initialize\hi@stattitle@choppedpage
        \hi@inline@never{%
            \hi@citeguts{%
                \hi@kv@name
                \hi@maybepage{ },\space
                \hi@pstruct@use{vol}\space
                \hi@pstruct@use@font{rep}\hi@fn@statute\space
                \hi@pstruct@call{page}{\noexpand\@format@page@macro}%
            }%
            \hi@book@paren
            \the\hi@param@parens
        }%
        \hi@inline@only{%
            \hi@citeguts{%
                \hi@ifpage{%
                    \noexpand\expandafter\noexpand\@capnext\noexpand\@this@page
                    \space of the \hi@kv@name
                }{%
                    \hi@inline@the\@capnext\hi@kv@name
                }%
            }%
        }%
    }%
    \hi@newcite@form{sc}{#1}{%
        \noexpand\hi@stattitle@choppageslash
        \hi@pstruct@initialize\hi@stattitle@choppedpage
        \hi@short@use{#1}%
        \hi@citeguts{%
            \hi@inline@never{%
                \noexpand\if@hi@name
                    \hi@kv@inline
                    \hi@maybepage{ },\space
                \noexpand\else
                    \hi@ifpage{\noexpand\@this@page, }{}%
                \noexpand\fi
                \hi@pstruct@use{vol}\space
                \hi@pstruct@use@font{rep}\hi@fn@statute\space
                \hi@pstruct@call{page}{\noexpand\@format@page@macro}%
            }%
            \hi@inline@only{%
                \hi@ifpage{%
                    \noexpand\@hi@adjectivetrue
                    \hi@kv@inline\space
                    \noexpand\@this@page
                }{%
                    \hi@kv@inline
                }%
            }%
        }%
    }%
    \hi@newcite@form{idc}{#1}{%
        \noexpand\hi@stattitle@choppageslash
        \hi@pstruct@initialize\hi@stattitle@choppedpage
        \hi@citeguts{%
            \noexpand\hi@id
            \noexpand\@test
                \noexpand\ifx\noexpand\@this@page\noexpand\@last@page
            \noexpand\fi{}{%
                \noexpand\@hi@dotfalse
                \hi@maybepage{ },\space
                \hi@pstruct@use{vol}\space
                \hi@pstruct@use@font{rep}\hi@fn@statute\space
                \hi@pstruct@call{page}{\noexpand\@format@page@macro}%
            }%
        }%
    }%
}%
This is for statutes that, having been amended many times, are treated like
codifications based on their original section numbers. The Communications Act of
1930, the Public Health Service Act, and the Smoot--Hawley Tariff Act are
examples of statutes with well-known section numbers that do not correspond to
their codifications; a parallel cite to the U.S. Code is required and provided
in a struct that maps original section numbers to U.S.C. citations.

This reference type should supersede \rtype{statcode} with \param{origsect}.

The scope of the reference item here is the whole statute, not just an
individual section therein. To cite to a section of the statute, the section
number is given as the pin cite information. The reference aliasing system
described for \rtype{alias} can assist in simplifying references to these
statutes if a particular section number is repeatedly used.

\keyparameters{
    {name, inline}{\statuteparamdesc\ Here the name is mandatory, since section
    numbers correspond to the statute number with that name.}
    {vol, rep, page, cite}{The citation locator information for the statute in a
    codification. Here, \param{page} should refer to the range of section
    numbers in the codification that the statute covers. Note that the range
    will likely never be displayed, if all citations to the statute are to
    particular sections.}
    {struct}{Following the format described in \sec{struct}, this should
    be a map of section numbers of the statute to \param{vol}, \param{rep}, and
    \param{page} values in the codification. The structure is key to ensuring
    that pin cites display correctly.}
}

\bookparenparameters

\hi@newcite\defrule{A rule of evidence or procedure}{%
    \hi@citetype{#1}\hi@type@rule
    \hi@statcode@setup@idpc{#1}% Set up id. and page numbering
    \hi@include@page@in@toa{#1}%
    \hi@newcite@form{fc}{#1}{%
        \hi@citeguts{%
            \hi@ifset\hi@kv@name{\noexpand\@capnext\hi@kv@name, }%
            \noexpand\hi@fn@statute{\hi@kv@rep}%
            \hi@pageordefault{ }{%
                \hi@ifset\hi@kv@page{ \@format@page@macro\hi@kv@page}{}%
            }%
        }%
        \hi@ifeitherset\hi@kv@year\hi@kv@court{%
            \hi@addparen{\hi@paren@date}{%
                \hi@param@optspc\hi@kv@court\hi@kv@year
            }%
        }{}%
        \the\hi@param@parens
    }%
}
Citations to judicial rules are not especially well-defined, and there are at
least two possible approaches for identifying rules (both of which this package
supports). First, one could characterize the name of the rule set as a book
title and each rule as a named division therein. That would produce output along
the following lines:
\begin{demo}
|\defrule{frcp12}{rep=Fed. R. Civ. P., page=rule 12}| \\
|\sentence{frcp12 at /b6}.| \\
\Produces \textsc{Fed.\ R. Civ.\ P.} R. 12(b)(6).
\end{demo}
The oddity of this form is that ``R.'' appears twice. To avoid that, it is not
enough to remove ``rule'' from the pin cite (|page=12|), because then the number
looks like a page number that will not accept subdivisions like ``(b)(6).'' The
solution is to use the dash character before the pin cite as described in
\sec{pages}:
\begin{demo}
|\defrule{frcp12}{rep=Fed. R. Civ. P., page=-12}| \\
|\sentence{frcp12 at /b6}.| \\
\Produces \textsc{Fed.\ R. Civ.\ P.} 12(b)(6).
\end{demo}
The dash forces the pin cite to be interpreted as a ``named'' division with no
name.

\keyparameters{
    {rep}{The abbreviated name of the rule set being cited.}
    {page}{The rule number, see above.}
}
\optparameters{
    {name}{A name of the rule, if any.}
    {court}{The court issuing the rule, if not apparent from \param{rep}.}
    {year}{The year of promulgation of the rule, if needed.}
}

\pagejoining

%%
%% \iffalse filename: specrefs.dtx \fi
\input driver
\thisis{govrefs}{Government Works}

These references are for legislative and executive materials that do not fall
into the above categories.

\input docparams

\hi@newcite\defbill{An bill or resolution of Congress}{%
    \hi@citetype{#1}\hi@type@other
    \hi@inlinestatname{#1}%
    \hi@ifset\hi@kv@congress{}{%
        \PackageError\hi@pkgname{%
            Definition of #1 is missing the Congress number%
        }{Provide the number in the definition}%
    }%
    \hi@ifset\hi@kv@status{%
        \@expand{\find@in{ by }}\hi@kv@status i{\hi@bill@abbrevstatus}{}%
    }{}%
    \hi@newcite@form{fc}{#1}{%
        \hi@inline@never{%
            \hi@citeguts{%
                \hi@ifset\hi@kv@name{\@capnext\hi@kv@name, }{}%
                \hi@kv@number,
                \expandafter\hi@numtotxt@numeric\expandafter{\hi@kv@congress}~%
                Cong.%
                \hi@maybepage{ }%
            }%
            \hi@parens@add{\hi@paren@date}{%
                \hi@ifset\hi@kv@status{as \hi@kv@status, }{}%
                \hi@kv@year
            }%
            \the\hi@param@parens
        }%
        \hi@inline@only{%
            \hi@citeguts{%
                \hi@ifset\hi@kv@name{\hi@inline@the\hi@kv@name}{\hi@kv@number}%
            }%
        }%
    }%
    \hi@newcite@form{sc}{#1}{%
        \hi@inline@never{%
            \hi@citeguts{%
                \hi@kv@number
                \hi@maybepage{, \hi@page@atorsect}%
            }%
        }%
        \hi@inline@only{%
            \hi@citeguts{%
                \hi@ifset\hi@kv@inline{\hi@kv@inline}{\hi@kv@number}%
            }%
        }%
    }%
}

\keyparameters{
    {number}{The serial number of the bill. This is used as-is, and must include
    any prefix (e.g., ``S. 1234'').}
    {congress}{The term number of the Congress in which the bill was introduced.
    This should just be a number, and an ordinal suffix will be added
    automatically.}
    {year}{The date of the bill. By default, the date should be the date of
    introduction. Otherwise, use a date qualifier or the \param{status}
    parameter as described below.}
}
\optparameters{
    {name, inline}{\statuteparamdesc}
    {status}{The status of the version of the bill being cited, for example
    ``introduced,'' ``reported by \meta{committee},'' or ``passed by Senate.''
    This will be added before the date, so no qualifier should be added before
    the date if this parameter is used. Text after ``by'' will be abbreviated
    according to the \abbscheme{leg} abbreviation scheme.}
}

\begin{demo}
\Example
\begin{verbatim}
\defbill{yoda-2015}{
    bill=H.R. 862,
    congress=114,
    name=You Own Devices Act,
    date=feb 11 2015
}
\end{verbatim}
\Produces You Own Devices Act, H.R. 862, 114th Cong.\ (Feb. 11, 2015).
\end{demo}

\hi@newcite\defcongdoc{A Congressional numbered document}{%
    \hi@citetype{#1}\hi@type@other
    \hi@newcite@form{fc}{#1}{%
        \hi@ifset\hi@kv@author{%
            \noexpand\@gobble{\hi@kv@authln}%
        }{}% For sorting purposes
        \hi@citeguts{%
            \hi@ifset\hi@kv@author{%
                \noexpand\hi@fn@bookauthor{\hi@kv@author},
            }{}%
            \hi@ifset\hi@kv@name{%
                \noexpand\hi@fn@booktitle{\hi@kv@name},
            }{}%
            \noexpand\hi@fn@congdoc{\hi@kv@number}%
            \hi@ifset\hi@kv@page{%
                , \@format@page@macro\hi@kv@page
            }{}%
            \hi@maybepage{, \hi@page@atorsect}%
        }%
        \hi@parens@add{\hi@paren@date}{\hi@kv@year}%
        \the\hi@param@parens
    }%
    \protected@edef\reserved@a{%
        \noexpand\hi@fn@congdoc{\hi@kv@number}%
    }%
    \@expand{\hi@supra@form{#1}}\reserved@a i%
    \expandafter\hi@congdoc@expandnumber\expandafter{\hi@kv@number}%
    \hi@newcite@form{lc}{#1}{%
        \hi@ifset\hi@kv@author{%
            \noexpand\@gobble{\hi@kv@authln}%
        }{}% For sorting purposes
        \hi@citeguts{%
            \hi@ifset\hi@kv@author{%
                \noexpand\hi@fn@bookauthor{\hi@kv@author},
            }{}%
            \hi@ifset\hi@kv@name{%
                \noexpand\hi@fn@booktitle{\hi@kv@name},
            }{}%
            \noexpand\hi@fn@congdoc{\reserved@a}%
            \hi@ifset\hi@kv@page{%
                , \@format@page@macro\hi@kv@page
            }{}%
            \hi@maybepage{, \hi@page@atorsect}%
        }%
        \hi@parens@add{\hi@paren@date}{\hi@kv@year}%
        \the\hi@param@parens
    }%
}
This is for reports, and documents. Unnumbered documents should use
\rtype{congprint}.

\keyparameters{
    {number}{The document number. This should include the abbreviated
    description for the number (e.g., ``H.R. Rep. No.''). The description must
    match a predefined list of permitted descriptions, and those descriptions
    will be de-abbreviated to make inline citation forms.}
    {year}{The date of the report.}
}
\optparameters{
    {author, name}{The author(s) and title of the document.}
    {page}{A pin cite that will be included in the full citation. This might be
    used, for example, for multipart reports (i.e., \texttt{page} could be
    \texttt{part~2}).}
}

\begin{demo}
\Example
\begin{verbatim}
\defcongdoc{aia-report}{
    name=America Invents Act,
    serial=H.R. Rep. No. 112-98,
    year=2011,
}
\end{verbatim}
\Produces \textsc{America Invents Act}, \textsc{H.R. Rep.\ No.}\ 112-98 (2011).
\end{demo}

\hi@newcite\defcongprint{A Congressional unnumbered document}{%
    \hi@citetype{#1}\hi@type@other
    \hi@newcite@form{fc}{#1}{%
        \hi@ifset\hi@kv@author{%
            \noexpand\@gobble{\hi@kv@authln}%
        }{}% For sorting purposes
        \hi@citeguts{%
            \hi@ifset\hi@kv@author{%
                \noexpand\hi@fn@bookauthor{\hi@kv@author},
            }{%
                \hi@ifset\hi@kv@committee{%
                    \hi@noexpand\hi@fn@bookauthor{%
                        Staff of \hi@kv@committee,
                    }%
                }{}%
            }%
            \noexpand\hi@fn@bookauthor{%
                \expandafter\hi@numtotxt@numeric\expandafter{\hi@kv@congress}%
                ~Cong.,
            },
            \noexpand\hi@fn@booktitle{\hi@kv@name}%
            \hi@maybepage{\hi@page@space\hi@kv@name}%
        }%
        \hi@parens@add\hi@paren@date{Comm. Print \hi@kv@year}%
        \the\hi@param@parens
    }%
    \protected@edef\reserved@a{%
        \noexpand\hi@fn@booktitle{\hi@kv@name}%
    }%
    \@expand{\hi@supra@form{#1}}\reserved@a i%
}
This is essentially a more structured citation to a book.

\keyparameters{
    {author}{Author(s) of the report or document.}
    {committee}{If no author is given but this parameter is, then the author
    becomes ``Staff of \meta{committee}.'' The committee name is abbreviated.}
    {name}{The title of the document.}
    {congress}{The term number of the Congress in which the bill was introduced.
    This should just be a number, and an ordinal suffix will be added
    automatically.}
    {year}{The year of publication.}
}
\hi@newcite\defcongrec{A Congressional Record debate}{%
    \expandafter\hi@congrec@testpg\hi@kv@page\@stop
    \hi@book@pubparen
    \hi@ifset\hi@kv@year{}{\PackageError\hi@pkgname{Year is required for #1}}%
    \hi@citetype{#1}\hi@type@other
    \hi@newcite@form{fc}{#1}{%
        \hi@citeguts{%
            \hi@usevol{\hi@ifset\hi@kv@vol{\hi@kv@vol\space}{}}%
            \noexpand\hi@fn@congdoc{\hi@kv@rep}\space
            \hi@ifpage{\hi@maybepage{}}{\@format@page@macro\hi@kv@page}%
        }%
        \hi@book@paren
        \the\hi@param@parens
    }%
    \hi@newcite@form{sc}{#1}{%
        \hi@citeguts{%
            \hi@kv@vol\space
            \hi@kv@rep\space at\space
            \hi@ifpage{\hi@maybepage{}}{\hi@kv@page}%
        }%
    }%
}
This supports both the daily edition and the permanent edition, determined based
on the page number. Note also the \rtype{cr} reference below.

\keyparameters{
    {vol}{The volume number.}
    {rep}{The name of the record, typically ``Cong. Rec.''}
    {page}{The page number where the relevant debate begins. For the daily
    edition, include the letter prefix in the page number (preceded with ``!''
    to ensure it is not treated as a division name, see \sec{pages-forms}). The
    phrase ``daily ed.''\ will automatically be added to the date parenthetical
    in this case.}
    {year}{The date of the debate or of publication of the volume. It typically
    is a full date for the daily edition, and a year for the permanent edition.}
}
\bookparenparameters\ This is primarily useful for volume 1 of the \emph{Annals
of Congress}.

\begin{demo}
\Example
\begin{verbatim}
\defcongrec{kastenmeier-statement}{
cite=126 Cong. Rec. 29895,
year=1980,
paren=statement of Mr.\ Kastenmeier
}
\end{verbatim}
\end{demo}


\subsection{\texttt{cr}: The Congressional Record}

\label{rtype:cr}

As an alternative to \rtype{congrec} above, the predefined reference |cr| can be
used to cite arbitrary pages in the \emph{Congressional Record} permanent
edition. The date should be given as the optional argument:
\begin{demo}
|\sentence{see 123 cr[1977] 17147}.|
\Produces \emph{See} 123 \textsc{Cong.\ Rec.}\ 17147 (1977).
\end{demo}

\hi@newcite\defhearing{A hearing in Congress}{%
    \hi@citetype{#1}\hi@type@other
    \hi@ifset\hi@kv@type{}{\def\hi@kv@type{Hearing}}%
    \hi@newcite@form{fc}{#1}{%
        \hi@citeguts{%
            \noexpand\hi@usevol{}%
            \noexpand\hi@fn@hearing{%
                \hi@ifset\hi@kv@name{\hi@kv@name: }{}%
                \hi@kv@type\space
                \hi@ifset\hi@kv@number{on \hi@kv@number\space}{}%
                Before the \hi@kv@committee
            }\hi@font@comma
            \expandafter\hi@numtotxt@numeric\expandafter{\hi@kv@congress}~Cong.%
            \noexpand\@hi@dottrue
            \hi@maybepage{ }%
        }%
        \hi@parens@add{\hi@paren@date}{\hi@kv@year}%
        \the\hi@param@parens
    }%
    \protected@edef\reserved@a{%
        \noexpand\hi@fn@hearing{%
            \hi@ifset\hi@kv@name{%
                \hi@kv@name
            }{%
                Hearing\space
                \hi@ifset\hi@kv@bill{%
                    on \hi@kv@bill
                }{%
                    Before the \hi@kv@committee
                }%
            }%
        }%
    }%
    \@expand{\hi@supra@form{#1}}\reserved@a i%
}
These should be hearings where the Goverment Printing Office has printed a
transcript of the proceedings. Use \rtype{testimony} to cite separately
published testimony in a hearing.

\keyparameters{
    {committee}{The committee before which the hearing was held.}
    {congress}{The term number of the Congress in which the bill was introduced.
    This should just be a number, and an ordinal suffix will be added
    automatically.}
}
\optparameters{
    {type}{The nature of the proceeding, default ``Hearing.''}
    {name}{A title to the hearing, if given.}
    {number}{A bill number (same as the \rtype{bill} reference type), to be
    given if the hearing deals with a specific bill.}
}

\begin{demo}
\Example
\begin{verbatim}
\defhearing{azar-hearing}{
    name=Nomination of Alex Azar to Serve as Secretary
        of Health and Human Services,
    committee={Senate Committee on Health, Education,
        Labor, and Pensions},
    congress=115,
    date=nov 29 2017,
}
\end{verbatim}
\end{demo}

\hi@newcite\defprespaper{A Presidential Paper}{%
    \hi@citetype{#1}\hi@type@other
    \hi@newcite@form{fc}{#1}{%
        \hi@citeguts{%
            \hi@kv@name, % Title
            \hi@kv@vol\space % Volume
            \hi@kv@rep\space % Title
            \hi@kv@page % Page number
            \hi@maybepage{, }%
        }%
        \hi@parens@add{\hi@paren@date}{\hi@kv@year}%
        \the\hi@param@parens
    }%
}

\keyparameters{
    {name}{The title of the paper.}
    {vol, rep, page, cite}{Citation information for the paper. Typically
    \param{rep} is ``Pub. Papers'' or ``Weekly Comp.~Pres.~Doc.''}
    {year}{The date of the document.}
}
\hi@newcite\defdcpd{Daily Compilation of Presidential Documents}{
    \hi@citetype{#1}\hi@type@other
    \hi@newcite@form{fc}{#1}{%
        \hi@citeguts{%
            \hi@kv@name,
            \hi@fn@jrntitle{Daily Comp. Pres. Doc.} No. \hi@kv@number
            \hi@maybepage{, at }%
        }%
        \hi@parens@add{\hi@paren@date}{\hi@kv@year}%
        \the\hi@param@parens
    }%
    \hi@newcite@form{sc}{#1}{%
        \hi@citeguts{%
            \hi@kv@name,
            \hi@fn@jrntitle{Daily Comp. Pres. Doc.} No. \hi@kv@number
            \hi@maybepage{, at }%
        }%
    }%
}
Because documents in the DCPD are numbered rather than consecutively paginated,
a different reference type is required.

\keyparameters{
    {name}{The name of the document.}
    {number}{The number of the document.}
    {year}{The date of the document.}
}
\hi@newcite\defpatent{A U.S. patent}{%
    \hi@citetype{#1}\hi@type@other
    \let\reserved@a\@empty
    \@expand{\find@start{D}}\hi@kv@number i{%
        \def\reserved@a{D}\def\hi@kv@number
    }{}%
    \ifnum\hi@kv@number<\@m
        \let\hi@kv@inline\hi@kv@number
    \else
        \@tempcnta\hi@kv@number\relax
        \divide\@tempcnta\@m \multiply\@tempcnta-\@m
        \advance\@tempcnta\hi@kv@number\relax
        \def\hi@kv@inline{'\the\@tempcnta}%
    \fi
    \edef\hi@kv@number{%
        \expandafter\hi@numtotxt@comma\expandafter{\hi@kv@number}%
    }%
    %
    % So long as the date contains some prefix, I don't really care if it's
    % ``issued'' or ``filed''.
    %
    \@expand{%
        \find@start@cs{/hi@fn@dateprefix}%
    }{\hi@kv@year}{i}{\@gobble}{%
        \PackageWarning\hi@pkgname{%
            For patent citation #1, the date must include a\MessageBreak
            qualifier such as `filed' or `issued'.\MessageBreak
            This occurred%
        }%
    }%
    \hi@newcite@form{fc}{#1}{%
        \hi@citeguts{%
            \hi@ifset\hi@kv@name{\@capnext\hi@kv@name, }\@empty
            U.S. Patent No. \reserved@a\hi@kv@number
            \hi@maybepage{ }%
        }%
        \hi@inline@never{%
            \hi@parens@add{\hi@paren@date}{\hi@kv@year}%
            \the\hi@param@parens
        }%
    }%
    \hi@newcite@form{sc}{#1}{%
        \hi@citeguts{%
            \noexpand\hi@inline@the
            \hi@kv@inline\space Patent%
            \hi@maybepage{ }%
        }%
    }%
}

\keyparameters{
    {number}{The patent number. It should be entered as an unpunctuated raw
    number, preceded by ``D'' for design patents. Commas will be added to the
    number, and the last three digits will be used for the short form.}
    {year}{The date of the patent. The date \emph{must} contain a qualifier,
    likely ``issued'' or ``filed.''}
    {issueyear}{Equivalent to setting \param{year} to
    \textsc{issued~}\meta{issueyear}.}
}
\optparameters{
    {name}{The title of the patent, if relevant.}
}
\hi@newcite\defgovdoc{A government document}{%
    \hi@ifset\hi@kv@court{}{%
        \hi@ifset\hi@kv@author{\let\hi@kv@court\hi@kv@author}{}%
    }%
    \hi@cite@history
    \hi@citetype{#1}\hi@type@other
    \hi@newcite@form{fc}{#1}{%
        \hi@citeguts{%
            \hi@ifset\hi@kv@number{%
                \@capnext\hi@kv@number,
            }{}%
            \hi@ifset\hi@kv@name{%
                \@capnext\hi@kv@name
            }{}%
            \hi@ifset\hi@kv@rep{%
                ,
                \hi@ifset\hi@kv@vol{\hi@kv@vol\space}{}%
                \hi@kv@rep\space \hi@kv@page
                \hi@maybepage{, }%
            }{%
                \hi@ifset\hi@kv@docket{%
                    , \hi@kv@docket
                    \hi@maybepage{, }%
                }{%
                    \hi@maybepage{ }%
                }%
            }%
        }%
        \hi@case@dateparen{%
            \hi@parens@add\hi@paren@date{%
                \hi@param@optspc\hi@kv@court\hi@kv@year
            }%
        }y%
        \the\hi@param@parens
    }
    % TODO think about the general case for the short form
    \hi@ifset\hi@kv@rep{%
        \hi@newcite@form{sc}{#1}{%
            \hi@citeguts{%
                \hi@ifset\hi@kv@vol{\hi@kv@vol\space}{}%
                \hi@kv@rep
                \hi@pageordefault{ at }{ \hi@kv@page}%
            }%
        }%
    }{%
        \@expand{\hi@supra@form{#1}}\hi@kv@name i%
    }%
}
This is a generic reference type amenable primarily to two types of government
documents. First, it can be used for \emph{Federal Register} notices and other
government documents published in agency reporters or compilations. In this
case, the abbreviated reporter and such information should be included as
parameters. In most cases, this produces output not unlike \rtype{admincase},
the main difference that the document title has no special font applied to it
(\rtype{admincase} would apply whatever font is applied to case names).

Second, this reference type can be used without the reporter parameter, to cite
short government papers or promulgations. The traditional route is to cite such
documents as \rtype{book} references, but for one-page fact sheets or brief
policy statements this gives too much apparent authoritative weight. However,
the agency or institution name is placed in the date parenthetical, consistent
with other government or court documents, thereby emphasizing the governmental
origin of the document.

\keyparameters{
    {name}{The title of the document.}
    {author, instauth, agency, court}{The name of the agency or institution
    issuing the document. It should be abbreviated according to the
    \abbscheme{name} scheme. If \param{instauth} or
    \param{agency} are used, this will be done automatically.}
    {vol, rep, page, cite}{The citation locator information for the document, if
    the document was published in a reporter. The reporter should be abbreviated
    when entered.}
    {docket}{If citation locator information is not entered, a docket number may
    be given to aid in identifying the document.}
    {year}{The date of the reference.}
}
\optparameters{
    {prior, subsequent}{Procedural history associated with the document, as
    described in \sec{caseref-history}.}
    {number}{A serial number for the document, placed before the document
    title.}
}

\begin{demo}
\Example
\begin{verbatim}
\defgovdoc{des}{
    name=Encryption Algorithm for Computer Data Protection,
    cite=40 Fed. Reg. 12134,
    date=mar 17 1975,
}
\end{verbatim}
\Produces Encryption Algorithm for Computer Data Protection, 40 Fed.\ Reg.\
12134 (Mar.\ 17, 1975).
\end{demo}

\hi@alias@cite\deffedreg\defgovdoc
\hi@newcite\deftestimony{Testimony in a congressional hearing}{%
    \hi@citetype{#1}\hi@type@other
    \hi@ifset\hi@kv@type{}{\def\hi@kv@type{Testimony}}%
    \hi@ifset\hi@kv@citation{}{%
        \hi@ifset\hi@kv@in{\let\hi@kv@citation\hi@kv@in}{%
            \PackageError\hi@pkgname{%
                \string\deftestimony\space requires parameter `citation'%
            }{Add the parameter}%
        }%
    }%
    \hi@newcite@form{fc}{#1}{%
        \hi@citeguts{%
            \hi@kv@type\space of
            \hi@ifset\hi@kv@author{\hi@kv@author@sortable}{}%
            \hi@maybepage{ \hi@page@atorsect}%
            ,\space
            \noexpand\clause{\hi@kv@citation}\noexpand\hi@clause@endflag
        }
        \the\hi@param@parens
    }%
    \@expand{\hi@supra@form{#1}}\hi@kv@author i%
}
Many congressional hearings are not published today, given the availability of
video recordings. As a result, to cite a witness's testimony at a hearing, it is
often necessary to use the witness's own copy, usually made available online.
There is no well-defined way to cite this testimony. One option, commonly used,
is to cite the privately published testimony as a \rtype{hearing} reference.
This is plainly wrong and confusing, especially if multiple witnesses'
testimonies are to be cited. Another way would be as a \rtype{book} reference,
but that obscures the testimony's legislative involvement. It is also not clear
what the title should be or where the congressional subcommittee should be
identified when taking this approach.

This package defines a new reference type for these privately published
testimony documents. It uses a \rtype{citecontainer}-like approach, with the
hearing in which the testimony was delivered being defined separately as a
reference to be used as part of the \rtype{testimony} definition. This has the
benefit that, when two different witnesses' testimonies are cited, the hearing
is cited with the short form for the second witness cited.

\keyparameters{
    {citation, in}{The \rtype{hearing} reference name or anonymous reference
    definition.}
    {author}{The witness testifying.}
}
\optparameters{
    {type}{The nature of the testimony, by default ``Testimony.''}
}
\hi@newcite\defcomments{Comments on an agency proceeding}{%
    \hi@citetype{#1}\hi@type@other
    \hi@ifset\hi@kv@type{}{\def\hi@kv@type{Comments}}%
    \hi@newcite@form{fc}{#1}{%
        \hi@citeguts{%
            \hi@ifset\hi@kv@author{\hi@kv@author@sortable, }{}%
            \hi@kv@type\space of
            \hi@kv@commenter
            \hi@maybepage{ }%
            ,\space
            \noexpand\hi@fn@arttitle{%
                \hi@kv@name
            }%
            \hi@ifset\hi@kv@rep{%
                , \hi@kv@vol\space \hi@kv@rep\space \hi@kv@page
            }{}%`
        }%
        \hi@parens@add{\hi@paren@date}{\hi@kv@court\space\hi@kv@year}%
        \the\hi@param@parens
    }%
    \protected@edef\reserved@a{%
        \noexpand\hi@fn@arttitle{Comments on \hi@kv@name}%
    }%
    \@expand{\hi@supra@form{#1}}\reserved@a i%
}
This is a mildly deprecated reference type for comments filed in an agency
proceeding. (It remains here because it is used in the package author's CV\@.)
The better option is actually to use \rtype{casedoc}, defining the agency
proceeding in which the comments were filed as a separate reference
(good choices would be \rtype{admincase} and \rtype{govdoc}). In that case, the
title of the document would be given as ``Comments of \meta{party}.''

\keyparameters{
    {commenter}{Name of the entity filing the comments.}
    {name}{The title of the proceeding in which the comments were filed.}
    {vol, rep, page, cite}{Identifier information for the proceeding (typically
    a \emph{Federal Register} citation if the comments were filed pursuant to
    such a notice).}
    {year}{The date of the comments.}
}
\optparameters{
    {author}{The author of the comment, usually the signatory attorney. This
    probably should not be included in most cases, in the same way that the
    signing attorney is not identified for legal briefs in \rtype{casedoc}.}
}
\hi@newcite\defsecfiling{An SEC filing}{%
    \hi@citetype{#1}\hi@type@other
    \hi@newcite@form{fc}{#1}{%
        \hi@citeguts{%
            \hi@ifset\hi@kv@author{\hi@kv@author@sortable, }{}%
            \hi@kv@name\space
            (Form \hi@kv@number)%
            \hi@maybepage{, at }%
        }%
        \hi@parens@add{\hi@paren@date}{\hi@kv@year}%
        \the\hi@param@parens
    }%
}

\keyparameters{
    {instauth}{The company filing the report.}
    {name}{The name of the report, typically along the lines of ``Annual
    Report.''}
    {number}{The number of the form filed (e.g., ``10-K'').}
    {year}{The date of filing.}
}
%%
%% \iffalse filename: bookrefs.dtx \fi
%%
\input driver
\thisis{bookrefs}{Books and Containers}

This section describes two reference types for larger book-like works, and also
a common parenthetical used across many citation types.

\subsection{Publication Parentheticals}

\label{s:bookrefs-pubparen}

Many citation types accept a common parenthetical that contains a date of
publication and other publication information, such as editions, editors, and
publishers. This standard parenthetical accepts the following parameters, all of
which are optional (although some reference types will require \param{year}):

\optparameters{
    {editor}{Names of one or more editors of the book.}
    {edtype}{The abbreviation to follow the editor names, by default ``ed.''\ or
    ``eds.''}
    {number}{A serial number for the book. This parameter is used only if
    \param{publisher} is also given. (For \rtype{book} references, a serial
    number with no publisher will be used differently.)}
    {edition}{The edition number of the book. An ordinal suffix will be added.}
    {publisher}{The name of the publisher.}
    {forthcoming}{If set, the word ``forthcoming'' will be added to the
    parenthetical.}
    {year}{The year of publication.}
}


\input docparams

\hi@newcite\defbook{A book or non-periodic material}{%
    \hi@citetype{#1}\hi@type@other
    \hi@book@pubparen
    \expandafter\hi@book@titlethe\expandafter{\hi@kv@name}%
    \hi@newcite@form{fc}{#1}{%
        \hi@pstruct@initialize\@this@vol
        \hi@ifset\hi@kv@author{%
            \noexpand\@gobble{\hi@kv@authln}%
        }{}% For sorting purposes
        \hi@citeguts{%
            \noexpand\hi@citecontainer@suppress{%
                \noexpand\hi@usevol{%
                    \hi@ifset\hi@kv@vol{\hi@kv@vol\space}{}%
                }%
                \hi@ifset\hi@kv@author{%
                    \hi@pstruct@use@font{author}\hi@fn@bookauthor, % space
                }{}%
            }%
            \hi@ifset\hi@kv@number{%
                \hi@ifset\hi@kv@publisher{}{%
                    \noexpand\hi@fn@booktitle{%
                        \hi@abbrev@pub{\hi@kv@number}{\@iden}%
                    }, % space
                }%
            }{}%
            \hi@pstruct@use@font{name}\hi@fn@booktitle
            \hi@maybepage{\hi@page@space\hi@kv@name}%
        }%
        \hi@book@paren
        \the\hi@param@parens
    }%
    \hi@ifset\hi@kv@toapage{%
        \hi@include@page@in@toa{#1}%
        \hi@newcite@form{lc}{#1}{%
            \noexpand\hi@toa@duptitle{}{%
                \noexpand\hi@fn@bookauthor{\relax\hi@kv@author@sortable},\space
                \noexpand\hi@usevol{\hi@ifset\hi@kv@vol{\hi@kv@vol\space}{}}%
                \hi@ifset\hi@kv@number{%
                    \noexpand\hi@fn@booktitle{\hi@kv@number}, % space
                }{}%
                \hi@fn@booktitle{\hi@kv@name}%
            }{%
                \hi@maybepage{\hi@page@space\hi@kv@name}%
                % The \reserved@a is to get the parens outside of \hi@citeguts
                % which is added kn \hi@toa@duptitle
                \gdef\noexpand\reserved@a{%
                    \hi@book@paren
                    \the\hi@param@parens
                }%
                \noexpand\aftergroup\noexpand\reserved@a
            }{%
                \hi@maybepage{ }%
            }%
        }%
    }{%
        \hi@newcite@form{lc}{#1}{%
            \hi@citeguts{%
                \hi@ifset\hi@kv@author{%
                    \hi@toa@dupauthor{\hi@fn@bookauthor}{%
                        \hi@kv@author@sortable
                    }%
                }{\hi@toa@dupnone}%
                \noexpand\hi@usevol{\hi@ifset\hi@kv@vol{\hi@kv@vol\space}{}}%
                \hi@ifset\hi@kv@number{%
                    \noexpand\hi@fn@booktitle{\hi@kv@number}, % space
                }{}%
                \hi@fn@booktitle{\hi@kv@name}%
            }%
            \hi@parens@add\hi@paren@date{%
                \hi@book@paren
                \hi@pstruct@use{year}%
            }%
            \the\hi@param@parens
        }%
    }%
    \hi@ifset\hi@kv@authln{}{\let\hi@kv@usetitle\relax}%
    \protected@edef\reserved@a{%
        \hi@ifset\hi@kv@usetitle
            {\noexpand\hi@fn@booktitle{\hi@kv@name}}%
            {\noexpand\hi@fn@bookauthor{\hi@kv@authln}}%
    }%
    \@expand{\hi@supra@form{#1}}\reserved@a i%
}

\keyparameters{
    {author, name}{The author(s) and title of the work.}
    {vol}{A specific volume number being cited. Preferably, though, the volume
    number would be included as part of the citation item information.}
    {number}{A serial number for the book. If the serial number is attached to
    the work's author (i.e., it's an institutional series), then enter the
    serial number alone, protecting any commas with braces. If the serial number
    is attached to a publisher's series, then use a comma as described with
    regard to the publication parenthetical.}
}
\optparameters{
    {struct}{If volumes of the work have different authors, titles, or other
    information, provide the differing values in a struct as described in
    \sec{struct}.}
}
\bookparenparameters

\begin{demo}
\Example
\begin{verbatim}
\defbook{nimmer}{
    author=Melville B. Nimmer,
    author=David Nimmer,
    title=Nimmer on Copyright,
    year=2014,
    hereinafter=\UseFontFor{booktitle}{Nimmer},
}
\end{verbatim}
\Produces \textsc{Melville B. Nimmer \& David Nimmer}, \textsc{Nimmer on
Copyright} (2014) [hereinafter \textsc{Nimmer}].
\end{demo}

\hi@newcite\defcitecontainer{A citation in another citation}{%
    %
    % Set the joining phrase.
    %
    \hi@citecontainer@settype
    %
    % Perform initial matters to set up the citecontainer; see the comment
    % before \hi@citecontainer@init.
    \edef\reserved@a{%
        {#1}%
        \expandafter\noexpand\csname tc@#1\endcsname
        \hi@ifset\hi@kv@citation{%
            \expandafter\noexpand\csname tc@\hi@kv@citation\endcsname
            \expandafter\noexpand\csname fc@\hi@kv@citation\endcsname
        }{\relax\relax}%
    }%
    \expandafter\hi@citecontainer@init\reserved@a
    %
    % Prepare the full citation form.
    \edef\reserved@a{%
        {#1}%
        \expandafter\noexpand\csname fc@#1\endcsname
        \expandafter\noexpand\csname tcpg@\hi@kv@in\endcsname
    }%
    \expandafter\hi@citecontainer@fc\reserved@a
    %
    % Prepare the short citation form.
    \edef\reserved@a{%
        {#1}%
        \expandafter\noexpand\csname sc@#1\endcsname
        \hi@ifset\hi@kv@citation{%
            \expandafter\noexpand\csname sc@\hi@kv@citation\endcsname
        }{\relax}%
    }%
    \expandafter\hi@citecontainer@sc\reserved@a
    %
    % Cite container TOA form.
    %
    \edef\reserved@a{%
        {#1}%
        \expandafter\noexpand\csname lc@#1\endcsname
        \hi@ifset\hi@kv@citation{%
            \expandafter\noexpand\csname
                \@ifundefined{lc@\hi@kv@citation}{fc}{lc}@\hi@kv@citation
            \endcsname
        }{\relax}%
        %
        % We always use the fullcite form for the container, not the TOA form.
        % This is because the TOA form is sometimes special in ways that are not
        % appropriate to being the second citation in a string cite, and also
        % because the TOA forms sometimes don't account for things like page
        % numbers.
        \expandafter\noexpand\csname fc@\hi@kv@in\endcsname
        %
        % This macro enables storing the volume/page number for the container
        % citation.
        \expandafter\noexpand\csname hi@citecontainer@data@#1\endcsname
    }
    \expandafter\hi@citecontainer@lc\reserved@a
}
A cite container is a highly flexible vehicle for citing works that are
contained inside other larger works: chapters in edited volumes, introductions
to books, letters reprinted in compilations, and documents in appendices to
judicial opinions. The defining feature of the cite container is that the
pagination of the contained work follows the pagination of the container, such
that any pin cite needs to be attached to the container's locator information.

There are two flavors of cite containers. First, the contained item may be a
standalone reference with a type, such as a letter or case. If so, then the
contained item is defined as a reference and passed to the citation container's
\param{citation} parameter. \unskip\footnote{This may be done through anonymous
references as described in \sec{anonymous}.}

Second, the contained item may not require a standalone definition, as would be
the case for a book chapter. In that case, the cite container takes parameters
\param{author}, \param{name}, and \param{year} to specify the contained work's
information, instead of the \param{citation} parameter.

\keyparameters{
    {citation}{The reference name or anonymous reference definition for the
    contained work.}
    {author, name, year}{Information for the contained work, used in lieu of
    \param{citation}.}
    {in}{The reference name or anonymous reference definition for the container
    work.}
    {vol, page}{The pin cite information for the contained work inside the
    container (e.g., for a chapter in an edited volume, the volume and page
    number where the chapter begins).}
}
\optparameters{
    {type}{The preposition that should join the contained work and the
    container; default is ``in.'' If the word is ``to'' or ``of,'' then no comma
    is prepended and the word is set in roman type, as is useful for
    introductions or forewords.}
    {singleauthor}{Indicates that all works in the contained volume are by the
    same author, such that the author name should be set in the font used for
    book authors.}
    {inline}{A short form name for the citation. The \param{hereinafter}
    parameter is probably better in most situations.}
}

\begin{demo}
\Example
\begin{verbatim}
\defcitecontainer{pantzer}{
    author=Katharine F. Pantzer,
    title={Printing the English Statutes, 1484--1640:
        Some Historical Implications},
    in=book: {
        title=Books and Society in History,
        editor=Kenneth E. Carpenter,
        year=1983
    },
    page=69,
}
\end{verbatim}
\Produces Katharine F. Pantzer, \emph{Printing the English Statutes, 1484--1640:
Some Historical Implications}, \emph{in} \textsc{Books and Society in History}
69 (Kenneth E. Carpenter ed., 1983).
\end{demo}
This is the book-chapter type of cite container, where the contained item has a
title and author but is not of its own reference type.

\begin{demo}
\Example
\begin{verbatim}
\defcitecontainer{adams-lee}{
    citation=letter: {
        author=Samuel Adams,
        to=Arthur Lee,
        date=july 31 1771,
    },
    vol=2,
    page=173,
    in=book: {
        title={Life of Arthur Lee, LL. D.},
        author=Richard Henry Lee,
        year=1829,
        publisher={Boston, Wells and Lilly},
    },
}
\end{verbatim}
\Produces
Letter from Samuel Adams to Arthur Lee (July 31, 1771), \emph{in} 2
\textsc{Richard Henry Lee}, \textsc{Life of Arthur Lee, LL. D.} 173 (Boston,
Wells \& Lilly, 1829).
\end{demo}
This exemplifies the first type of cite container, where a standalone reference
(here, a letter) is republished inside another reference (here, a book). The
contained and container references are both defined anonymously (see
\sec{anonymous}).

\begin{demo}
\Example
\begin{verbatim}
\defcitecontainer{rastell}{
    citation=citecontainer: {
        author=John Rastell,
        title=Prohemium,
        type=to,
        in=book: {
            title=The Abbreviation of the Statutes,
            year=1519,
        },
    },
    vol=1,
    page=327,
    in=book: {
        title=Typographical Antiquities,
        year=1785,
        editor=Joseph Ames,
        editor=William Herbert,
        publisher={London, Society of Antiquaries},
    },
    type=reprinted in,
}
\end{verbatim}
\Produces
John Rastell, \emph{Prohemium} to \textsc{The Abbreviation of the Statutes}
(1519), \emph{reprinted in} 1 \textsc{Typographical Antiquities} 327
(Joseph Ames \& William Herbert eds., London, Soc'y of Antiquaries 1785).
\end{demo}
This defines an introduction (Prohemium) to a publication of statutes (the
\emph{Abbreviation}), where no copies of the publication itself are known to
remain but the introduction alone was reprinted in another compilation called
\emph{Typographical Antiquities}. The Prohemium is thus properly defined as a
cite container (of the second type) where the container is the
\emph{Abbreviation}, but then that whole thing is wrapped inside another cite
container for \emph{Typographical Antiquities}. This is probably the most
complex reference definition that I have constructed.

%%
%% \iffalse filename: artrefs.dtx \fi
%%
\input driver
\thisis{artrefs}{Articles and Manuscripts}

\input docparams
\hi@newcite\defjrnart{A consecutively paginated journal article}{%
    \hi@citetype{#1}\hi@type@other
    \hi@abbrev@journal@check
    \@expand{\find@eq{forthcoming}}{\hi@kv@page}{i}{%
        \hi@undefine\hi@kv@page
        \KV@hi@forthcoming\relax
    }{}%
    \hi@ifset\hi@kv@vol{}{\let\hi@kv@vol\hi@kv@year}%
    \hi@ifset\hi@kv@page{}{\def\hi@kv@page{?}}%
    \hi@newcite@form{fc}{#1}{%
        \hi@citeguts{%
            \hi@ifset\hi@kv@author{%
                \hi@toa@dupauthor{\noexpand\@iden}{\hi@kv@author@sortable}%
            }{}%
            \hi@ifset\hi@kv@type{\@capnext\hi@kv@type, }{}%
            \hi@ifset\hi@kv@name{% Title
                \noexpand\hi@fn@arttitle{\hi@kv@name}\hi@font@comma
            }{%
                % If no title set, if there's a citation, use that as the
                % title
                \hi@ifset\hi@kv@citation{%
                    \noexpand\hi@fn@arttitle{%
                        \protect\inline{\hi@kv@citation}%
                    },
                }{}%
            }%
            \hi@ifset\hi@kv@vol{\hi@kv@vol\space}{%
                % Prompt error unless forthcoming
                \hi@ifset\hi@kv@forthcoming{}{\hi@kv@vol\space}%
            }% Volume
            \noexpand\hi@fn@jrntitle{\hi@kv@rep}% Magazine title
            \hi@ifset\hi@kv@forthcoming{}{%
                \space
                \hi@ifset\hi@kv@useissue{%
                    No.~\hi@kv@issue, at\space
                }{}%
                \@format@page@macro\hi@kv@page % First page
                \hi@maybepage{, }% Pin cite page
            }%
        }%
        \the\hi@param@parens
        \hi@ifset\hi@kv@forthcoming{%
            \hi@parens@add\hi@paren@date{%
                forthcoming%
                \hi@ifset\hi@kv@year{ \hi@kv@year}{}%
            }%
            \noexpand\ifx\noexpand\@this@page\relax\noexpand\else
                \hi@parens@add\hi@paren@forthcomingms{%
                    manuscript at \noexpand\@this@page
                }%
            \noexpand\fi
        }{%
            \hi@ifset\hi@kv@vol{%
                \ifx\hi@kv@vol\hi@kv@year\else
                    \hi@parens@add\hi@paren@date{\hi@kv@year}%
                \fi
            }{}%
        }%
    }%
    \protected@edef\reserved@a{%
        \hi@ifset\hi@kv@authln{\@capnext\hi@kv@authln}{%
            \hi@ifset\hi@kv@type{\@capnext\hi@kv@type}{%
                \noexpand\hi@fn@arttitle{\hi@kv@name}%
            }%
        }%
    }%
    \@expand{\hi@supra@form{#1}}\reserved@a i%
}
This reference type is used for articles published in consecutively paginated
journals.

\keyparameters{
    {author, name}{The author(s) and title of the article.}
    {vol, rep, page, cite}{The citation information for locating the article.
    The journal title is given in \param{rep}, and should be unabbreviated as it
    will be abbreviated according to the \abbscheme{journal} scheme. If
    the page is ``forthcoming,'' then it is treated as if the
    \param{forthcoming} parameter were set.}
    {forthcoming}{Indicates that the article is not yet published. The date
    should match the date of an available draft if one exists, or the expected
    date of publication.}
    {year}{The year of publication. If this is identical to the volume number,
    then it is omitted.}
}
\optparameters{
    {type}{The type of article (Note, Essay, Comment, etc.).}
    {citation}{Instead of an actual title, an article can use a case citation as
    a name. In this case, \param{citation} is the reference name of the case to
    be used as a title.}
    {issue}{The issue number of the journal in which the article appeared.}
    {useissue}{Include the issue number, which by default is omitted.}
}

\begin{demo}
\Example
\begin{verbatim}
\defjrnart{griswold}{
    author=Erwin N. Griswold,
    title=Government in Ignorance of the Law---A Plea
    for Better Publication of Executive Legislation,
    cite=48 Harvard Law Review 198,
    year=1934,
}
\end{verbatim}
\Produces
    Erwin N. Griswold, \emph{Government in Ignorance of the
    Law---A Plea for Better Publication of Executive
    Legislation}, 48 \textsc{Harv.\ L. Rev.}\ 198 (1934).
\end{demo}
Note the unabbreviated journal name in the input.

\hi@newcite\defprocart{A non-consecutively paginated proceedings article}{%
    \hi@citetype{#1}\hi@type@other
    \hi@abbrev@journal@check
    \hi@ifset\hi@kv@vol{}{\let\hi@kv@vol\hi@kv@year}%
    \hi@ifset\hi@kv@page{}{%
        \hi@ifset\hi@kv@issue{%
            \edef\hi@kv@page{No. \expandonce\hi@kv@issue}%
        }{}%
    }%
    \hi@newcite@form{fc}{#1}{%
        \hi@citeguts{%
            \hi@ifset\hi@kv@author{%
                \hi@toa@dupauthor{\noexpand\@iden}{\hi@kv@author@sortable}%
            }{}%
            \hi@ifset\hi@kv@type{\@capnext\hi@kv@type, }{}%
            \noexpand\hi@fn@arttitle{\hi@kv@name}%
            \hi@maybepage{ }\hi@font@comma
            \noexpand\hi@fn@sig{in}\space
            \hi@ifset\hi@kv@vol{\hi@kv@vol}{\hi@kv@year} % Volume
            \noexpand\hi@fn@jrntitle{\hi@kv@rep}%
            \hi@ifset\hi@kv@page{\space \@format@page@macro\hi@kv@page}{}%
        }%
        \hi@ifset\hi@kv@vol{%
            \hi@parens@add\hi@paren@date{\hi@kv@year}%
        }{}%
        \the\hi@param@parens
    }%
    \protected@edef\reserved@a{%
        \hi@ifset\hi@kv@authln{\@capnext\hi@kv@authln}{%
            \hi@ifset\hi@kv@type{\@capnext\hi@kv@type}{%
                \noexpand\hi@fn@arttitle{\hi@kv@name}%
            }%
        }%
    }%
    \@expand{\hi@supra@form{#1}}\reserved@a i%
}%
An oddity of traditional legal citations is that scholarly works published in
journals that do not use consecutive pagination are cited as if they were
magazine articles, suggesting that they are of lower prestige. This citation
format uses a more journal-like citation format, making articles appear in
citation form more like traditional journal articles.

The parameters are largely the same as those for \rtype{jrnart}, with the
following exceptions.

\keyparameters{
    {page}{This should be an identifier of the article being cited, probably
    along the lines of \texttt{No.~12}. The pin cite will be placed after the
    article title rather than after the journal name, following the usual
    convention that the page number follows the item that is sequentially
    paginated.}
    {issue}{If given, it is equivalent to setting \param{page} to
    \texttt{No.~}\meta{issue}.}
}
\hi@newcite\defmagart{A magazine article}{%
    \hi@citetype{#1}\hi@type@other
    \hi@abbrev@journal@check
    \hi@ifset\hi@kv@page{%
        \protected@edef\hi@kv@page{\@format@page@macro\hi@kv@page}%
    }{}%
    \hi@newcite@form{fc}{#1}{%
        \hi@citeguts{%
            \hi@ifset\hi@kv@author{\hi@kv@author@sortable, }{}%
            \noexpand\hi@fn@arttitle{\hi@kv@name}\hi@font@comma % Title
            \noexpand\hi@fn@jrntitle{\hi@kv@rep}% Magazine title
            \hi@ifset\hi@kv@publisher{ (\hi@kv@publisher)}{}%
            \hi@font@comma
            \hi@kv@year
            \hi@ifset\hi@kv@page{%
                ,
                \expandafter\hi@atorsect\expandafter{\hi@kv@page}%
                \hi@kv@page % First page number; already formatted above
                \hi@maybepage{, }%
            }{%
                \hi@maybepage{, \hi@page@atorsect}%
            }%
        }%
        \the\hi@param@parens
    }%
    \protected@edef\reserved@a{%
        \hi@ifset\hi@kv@authln{\@capnext\hi@kv@authln}{%
            \noexpand\hi@fn@arttitle{\hi@kv@name}%
        }%
    }%
    \@expand{\hi@supra@form{#1}}\reserved@a i%
}
This should be used for non-consecutively paginated journals that do not carry
scholarly weight.

\keyparameters{
    {author, name}{The author(s) and title of the article.}
    {rep, page}{The citation information for locating the article.
    The journal title is given in \param{rep}, and will be abbreviated according
    to the \abbscheme{journal} scheme.}
    {year}{The issue date of the magazine.}
}
\optparameters{
    {publisher}{The magazine publisher, if relevant.}
}

\begin{demo}
\Example
\begin{verbatim}
\defmagart{duhigg}{
    author=Charles Duhigg,
    title=How Companies Learn Your Secrets,
    journal=New York Times Magazine,
    page=!MM30,
    date=Jan 1 2016,
}
\end{verbatim}
\Produces Charles Duhigg, \emph{How Companies Learn Your Secrets}, \textsc{N.Y.
Times Mag.}\ MM30 (Jan.~1, 2016).
\end{demo}
Note the exclamation mark in front of the page number, which must be included
because the page number does not start with a digit (see \sec{pages}).

\hi@alias@cite\defnewsart\defmagart
\hi@newcite\defwebsite{A web site or generic citation}{%
    \hi@citetype{#1}\hi@type@other
    \hi@book@pubparen
    \hi@ifset\hi@kv@year{}{%
        \PackageError\hi@pkgname{Year is required for #1}{%
            Enter a date for the reference%
        }%
    }%
    \hi@ifset\hi@kv@rep{\hi@abbrev@journal@check}{}%
    \hi@newcite@form{fc}{#1}{%
        \hi@citeguts{%
            \hi@ifset\hi@kv@author{%
                \hi@toa@dupauthor{\noexpand\@iden}{\hi@kv@author@sortable}%
            }{}%
            \hi@ifset\hi@kv@name{\noexpand\hi@fn@webtitle{\hi@kv@name}}{}%
            \hi@ifset\hi@kv@rep{%
                \hi@ifset\hi@kv@name{\hi@font@comma}{}%
                \noexpand\hi@fn@jrntitle{\hi@kv@rep}%
            }{}%
            \hi@maybepage{ }%
        }%
        \hi@book@paren
        \the\hi@param@parens
    }%
    \protected@edef\reserved@a{%
        \hi@ifset\hi@kv@authln{\hi@kv@authln}{%
            \noexpand\hi@fn@webtitle{\hi@kv@name}%
        }%
    }%
    \@expand{\hi@supra@form{#1}}\reserved@a i%
}
This reference type is useful as a catch-all for published works that do not fit
cleanly in any other category. The ``website'' denotation is somewhat
irrelevant, as the \param{url} parameter is usable independent of reference
type.

The parameters are the same as those for \rtype{magart}. However, \param{rep} is
optional, which can be occasionally useful for web pages that don't have a site
title separate from a particular page title. If given, \param{rep} will be
abbreviated according to the \abbscheme{journal} scheme.
\bookparenparameters

\begin{demo}
\Example
\begin{verbatim}
\defwebsite{mitzman}{
    author=Dany Mitzman,
    title=Nutella: How the World Went Nuts for a Hazelnut
        Spread,
    date=may 18 2014,
    journal=BBC News,
    url=http://www.bbc.com/news/magazine-27438001
}
\end{verbatim}
\Produces Dany Mitzman, \emph{Nutella: How the World Went Nuts for a Hazelnut
Spread}, \textsc{BBC News} (May 18, 2014), http://\ldots
\end{demo}

\hi@newcite\defmanuscript{An unpublished manuscript}{%
    \hi@citetype{#1}\hi@type@other
    \hi@book@pubparen % Why not
    \hi@ifset\hi@kv@type{}{\def\hi@kv@type{manuscript}}
    \hi@newcite@form{fc}{#1}{%
        \hi@citeguts{%
            \hi@ifset\hi@kv@author{\hi@kv@author@sortable, }{}%
            \hi@kv@name
            \hi@maybepage{\hi@page@space\hi@kv@name}%
        }%
        \hi@book@paren
        \the\hi@param@parens
        \hi@parens@add\hi@paren@manuscript{%
            unpublished \hi@kv@type
            \hi@ifset\hi@kv@onfile{, on file with \hi@kv@onfile}{}%
        }%
    }%
    \protected@edef\reserved@a{%
        \hi@ifset\hi@kv@authln{\@capnext\hi@kv@authln}{\hi@kv@name}%
    }%
    \@expand{\hi@supra@form{#1}}\reserved@a i%
}
This reference type is usable for any unpublished written work, including Ph.D
dissertations, manuscripts, and reports.

\keyparameters{
    {author, name}{The author(s) and title of the manuscript.}
    {type}{The type of work, by default ``manuscript.''}
    {onfile}{Where a copy of the work can be found; ``author'' is a good
    choice.}
    {year}{The date of the manuscript.}
}

\begin{demo}
\Example
\begin{verbatim}
\defmanuscript{princess-bride}{
    title=The Princess Bride,
    author=William Goldman,
    type=draft screenplay,
    date=may 3 1986,
}
\end{verbatim}
\Produces William Goldman, The Princess Bride (May 3, 1986) (unpublished
draft screenplay).
\end{demo}

\hi@newcite\defworkingpaper{A working paper}{%
    \hi@citetype{#1}\hi@type@other
    \hi@newcite@form{fc}{#1}{%
        \hi@citeguts{%
            \hi@ifset\hi@kv@author{\hi@kv@author@sortable, }{}%
            \noexpand\hi@fn@arttitle{\hi@kv@name}%
            \hi@maybepage{ }%
        }%
        \hi@parens@add{\hi@paren@date}{%
            \hi@kv@publisher,
            \hi@abbrev@pub{\hi@kv@number}{\@iden},
            \hi@kv@year
        }%
        \the\hi@param@parens
    }%
    \protected@edef\reserved@a{%
        \hi@ifset\hi@kv@authln{\@capnext\hi@kv@authln}{%
            \hi@ifset\hi@kv@type{\@capnext\hi@kv@type}{%
                \noexpand\hi@fn@arttitle{\hi@kv@name}%
            }%
        }%
    }%
    \@expand{\hi@supra@form{#1}}\reserved@a i%
}
This is for working papers with a serial number issued by an institution.

\keyparameters{
    {author, name}{The author(s) and title of the paper.}
    {publisher}{The name of the institution publishing the working paper.}
    {number}{The serial number, with series name (e.g., ``Economics Working
    Paper No. X''). See the \param{serial} param to set this and the publisher
    simultaneously.}
    {year}{The date of the paper.}
}

\begin{demo}
\Example
\begin{verbatim}
\defworkingpaper{cockburn}{
    author=Iain M. Cockburn,
    author=Megan MacGarvie,
    title={Patents, Thickets, and the Financing of Early-Stage
        Firms: Evidence From the Software Industry},
    sponsor=National Bureau of Economic Research,
    serial=Working Paper No. 13644,
    year=2007,
    url=http://www.nber.org/papers/w13644.pdf
}
\end{verbatim}
\Produces
Iain M. Cockburn \& Megan MacGarvie, \emph{Patents, Thickets, and the Financing
of Early-Stage Firms: Evidence from the Software Industry} (Nat'l Bureau of
Econ.\ Res., Working Paper No. 13644, 2007).
\end{demo}

%%
%% \iffalse filename: foreignrefs.dtx \fi
%%
\input driver
\thisis{foreignrefs}{Foreign and International Materials}

The selection of reference types defined here is very much incomplete. To the
extent it is necessary, use \rtype{verbatim}.

\input docparams
\hi@newcite\defengdebate{An English parliamentary debate}{%
    \hi@citetype{#1}\hi@type@other
    \hi@newcite@form{sc}{#1}{%
        \hi@citeguts{%
            \hi@usevol{\hi@ifset\hi@kv@vol{\hi@kv@vol\space}{}}%
            \noexpand\hi@fn@statute{\hi@kv@rep}\space
            \hi@ifset\hi@kv@number{%
                (\hi@kv@number
                \expandafter\hi@numtoord\expandafter{\hi@kv@number} ser.)\space
            }{}%
            (\hi@kv@year)\space
            \hi@pageordefault{}{%
                \@format@page@macro\hi@kv@page
            }%
        }%
    }%
    \hi@newcite@form{fc}{#1}{%
        \hi@citeguts{%
            \hi@usevol{\hi@ifset\hi@kv@vol{\hi@kv@vol\space}{}}%
            \noexpand\hi@fn@statute{\hi@kv@rep}\space
            \hi@ifset\hi@kv@number{%
                (\hi@kv@number
                \expandafter\hi@numtoord\expandafter{\hi@kv@number} ser.)\space
            }{}%
            (\hi@kv@year)\space
            \hi@pageordefault{}{%
                \@format@page@macro\hi@kv@page
            }%
        }%
        \the\hi@param@parens
    }%
}

\keyparameters{
    {vol, rep, page, cite}{The locator information for the debate. The reporter
    should include the House of Parliament abbreviated.}
}

\hi@newcite\defengstat{An English statute}{%
    \hi@citetype{#1}\hi@type@statute
    \hi@statcode@setup@idpc{#1}% Set up id. and page numbering
    %\hi@include@page@in@toa{#1}
    \hi@newcite@form{ic}{#1}{%
        \hi@ifset\hi@kv@name{\hi@inline@the\@capnext\hi@kv@name}{}%
    }%
    \hi@newcite@form{fc}{#1}{%
        \hi@inline@only{\hi@citeguts{\noexpand\@nameuse{ic@#1}}}%
        \hi@inline@never{%
            \hi@citeguts{%
                \hi@name@only{%
                    \hi@ifset\hi@kv@name{\@capnext\hi@kv@name, \hi@kv@year, }{}%
                }%
                \hi@ifset\hi@kv@regnal{\@capnext\hi@kv@regnal, }{}%
                \@capnext c. \hi@kv@number
                \hi@pageordefault{, }{%
                    % Don't put the page here if \hi@kv@rep is set because the
                    % page is assumed to refer to the code book, not a statutory
                    % section.
                    \hi@ifset\hi@kv@rep{}{%
                        \hi@ifset\hi@kv@page{%
                            , \@format@page@macro\hi@kv@page
                        }{}%
                    }%
                }%
                \hi@ifset\hi@kv@rep{%
                    ,\space
                    \hi@ifset\hi@kv@vol{\hi@kv@vol\space}{}%
                    \noexpand\hi@fn@statute{\hi@kv@rep}\space
                    \@format@page@macro\hi@kv@page
                }{}%
            }%
            \hi@ifset\hi@kv@name{%
                \noexpand\if@hi@name\noexpand\else
                    \hi@ifset\hi@kv@year{%
                        \hi@parens@add\hi@paren@date{\hi@kv@year}%
                    }{}%
                \noexpand\fi
            }{%
                \hi@ifset\hi@kv@year{\hi@addparen\hi@paren@date{\hi@kv@year}}{}%
            }%
            \the\hi@param@parens
        }%
    }%
    \hi@newcite@form{sc}{#1}{%
        \hi@inline@only{\hi@citeguts{\noexpand\@nameuse{ic@#1}}}%
        \hi@inline@never{%
            \hi@citeguts{%
                \hi@name@only{%
                    \hi@ifset\hi@kv@name{\@capnext\hi@kv@name}{}%
                }%
                \hi@pageordefault{\hi@name@only{ \hi@page@atorsect}}{}%
            }%
        }%
    }%
}
This supports both modern statutes that are arranged by section numbers, and
historical statutes that are reported in \emph{Statutes of the Realm}. Note the
difference in \param{page} for each.

\keyparameters{
    {name}{The name of the statute.}
    {year}{The year of enactment. The year is assumed to be part of the name,
    appended to the name after a comma as is conventional for U.K. statutes.}
    {regnal}{The regnal year specification.}
    {chapter, number}{The chapter number of the statute.}
    {vol, rep}{The volume and code name for codified statute publications
    (primarily ``Stat.~Realm'').}
    {page}{If \param{rep} is given, then this parameter should receive the page
    number in the reporter for the statute. Otherwise, it should receive a
    section number of the statute if any.}
}

\pagejoining

\hi@newcite\defengcommand{A command paper in England}{%
    \hi@citetype{#1}\hi@type@other
    \hi@newcite@form{fc}{#1}{%
        \hi@ifset\hi@kv@author{%
            \noexpand\@gobble{\hi@kv@authln}%
        }{}% For sorting purposes
        \hi@citeguts{%
            \noexpand\hi@fn@bookauthor{\hi@kv@author},
            \noexpand\hi@fn@booktitle{\hi@kv@name},
            \hi@kv@year,
            \hi@kv@number
            \hi@maybepage{, \hi@page@atorsect}%
        }%
        \the\hi@param@parens
    }%
}

\keyparameters{
    {instauth}{The government department issuing the paper.}
    {name}{Title of the paper.}
    {year}{Year the paper was issued.}
    {number}{The command paper number. This must be prefixed with the
    appropriate ``Command'' abbreviation that identifies the series, as is
    conventional in U.K. practice.}
}

\hi@newcite\defforeignconst{A foreign constitution}{%
    \hi@citetype{#1}\hi@type@const
    \hi@newcite@form{fc}{#1}{%
        \hi@citeguts{%
            \noexpand\hi@fn@const{\hi@kv@name}%
            \hi@ifset\hi@kv@page{ \hi@kv@page}{}%
            \hi@maybepage{ }%
        }%
        \hi@invis@inline
        \the\hi@param@parens
    }%
}

\keyparameters{
    {name}{The name of the constitution. A translation may be given in square
    brackets.}
    {page}{A pin cite for the part of the constitution being cited.}
}

\hi@newcite\deftreaty{A treaty or international agreement}{%
    \hi@citetype{#1}\hi@type@treaty
    \hi@ifset\hi@kv@inline{%
        \hi@replacethe\hi@kv@inline{\def\hi@kv@inline}{}%
        \expandafter\KV@hi@hereinafter\expandafter{\hi@kv@inline}%
    }{%
        \@expand{\hi@supra@form{#1}}{\expandafter\hi@inline@the\hi@kv@name}i%
    }%
    \hi@newcite@form{fc}{#1}{%
        \hi@inline@only{%
            \hi@citeguts{%
                \hi@inline@the\hi@kv@name
            }%
        }%
        \hi@inline@never{%
            \hi@citeguts{%
                % The treaty name can only be suppressed in a star citation if a
                % country is given.
                \hi@ifset\hi@kv@countries{%
                    \hi@name@only{\hi@kv@name, }\hi@kv@countries
                }{\hi@kv@name}%
                \hi@maybepage{, },\space
                \hi@italdateprefix{\hi@kv@year}%
                \hi@ifset\hi@kv@rep{%
                    ,\space
                    \hi@ifset\hi@kv@vol{\hi@kv@vol\space}{}%
                    \noexpand\hi@fn@statute{\hi@kv@rep}%
                    \hi@ifset\hi@kv@page{%
                        \space\@format@page@macro\hi@kv@page
                    }{}%
                }{}%
            }%
            \the\hi@param@parens
        }%
    }%
}

\keyparameters{
    {name, inline}{\statuteparamdesc}
    {countries}{Countries that are parties to the treaty. They will be
    abbreviated. The names should be separated with en dashes. Countries need
    not be named for large multilateral treaties.}
    {year}{Date the treaty was signed. Use qualifiers ``done'' or ``opened for
    signature'' if there is no single signing date.}
    {vol, rep, page, cite}{Locator information for the treaty, if available.}
}

\hi@newcite\defeucase{A European Union case}{%
    \hi@citetype{#1}\hi@type@case
    \hi@case@setparties{#1}%
    \hi@ifset\hi@kv@inline{%
        \@expand{\hi@short@register{#1}}\hi@kv@inline i{y}%
    }{}%
    \hi@case@proc
    \@expand{\hi@short@register{#1}}\hi@kv@inline i{n}%
    \hi@newcite@form{fc}{#1}{%
        \hi@inline@only{\hi@citeguts{\hi@kv@name}}%
        \hi@inline@never{%
            \hi@citeguts{%
                Case \hi@kv@docket
                \hi@name@only{\hi@font@comma \hi@kv@aname}%
                \hi@ifset\hi@kv@rep{%
                    \hi@name@comma
                    \hi@kv@vol\space \hi@kv@rep\space \hi@kv@page
                    \hi@maybepage{, }%
                }{\hi@maybepage{\hi@name@comma}}%
            }%
            \the\hi@param@parens
            \hi@case@dateparen{%
                \hi@parens@add{\hi@paren@date}{%
                    \hi@param@optspc\hi@kv@court\hi@kv@year
                }%
            }y%
        }%
    }
    \hi@newcite@form{lc}{#1}{%
        \hi@citeguts{%
            \hi@name@only{\@capnext\hi@kv@lname\unkern,\hfill\break}%
            Case \hi@kv@docket
            \hi@ifset\hi@kv@rep{%
                , \hi@kv@vol\space\hi@kv@rep\space\hi@kv@page% Reporter and page
            }{}%
        }%
        \hi@case@dateparen{%
            \hi@parens@add{\hi@paren@date}{%
                \hi@param@optspc\hi@kv@court\hi@kv@year
            }%
        }y%
        \the\hi@param@parens
    }%
    \hi@newcite@form{sc}{#1}{%
        \hi@short@use{#1}%
        \hi@citeguts{%
            \hi@inline@only{\hi@citeguts{\hi@kv@inline}}%
            \hi@inline@never{%
                \hi@name@only{%
                    \hi@kv@ainline
                    \hi@font@comma
                }%
                \hi@ifset\hi@kv@rep{%
                    \hi@kv@vol\space\hi@kv@rep\space %
                    \hi@ifpage{\hi@maybepage{\hi@page@atorsect}}{\hi@kv@page}%
                }{%
                    \hi@ifset{\hi@kv@dbid}{\hi@kv@dbid}{\hi@kv@docket}%
                    \hi@maybepage{, \hi@kv@slip\hi@page@atorsect}%
                }%
            }%
        }%
        \hi@case@dateparen{}n%
    }%
}

\keyparameters{
    {name, inline}{The full and short names of the case.}
    {docket}{The number of the case.}
    {vol, rep, page, cite}{Locator information for the case.}
    {court}{The court issuing the decision.}
    {year}{The year of decision.}
}

\hi@newcite\defunresolution{A U.N. resolution}{%
    \hi@citetype{#1}\hi@type@other
    \hi@ifset\hi@kv@type{}{\def\hi@kv@type{U.N.}}%
    \hi@newcite@form{fc}{#1}{%
        \hi@citeguts{%
            \hi@ifset\hi@kv@name{%
                \hi@inline@the\@capnext\hi@kv@name\hi@font@comma
            }{}%
            \hi@kv@number
            \hi@maybepage{, \hi@page@atorsect}%
            , \hi@kv@type\space Doc. \hi@kv@intdoc
        }%
        \the\hi@param@parens
        \hi@parens@add{\hi@paren@date}{\hi@kv@year}%
    }%
    \@expand{\hi@supra@form{#1}}\hi@kv@number i%
}

\keyparameters{
    {name}{The name of the resolution.}
    {number}{The serial number of the resolution, with the body and abbreviation
    for the resolution (e.g., ``G.A. Res. 123'').}
    {type}{The institution issuing the document control number, default
    ``U.N.''}
    {intdoc}{The international institution control number, typically containing
    slashes.}
    {year}{The date of the document.}
}

\hi@newcite\defintdoc{A U.N. or international document}{%
    \hi@citetype{#1}\hi@type@other
    \hi@ifset\hi@kv@type{}{\def\hi@kv@type{U.N.}}%
    \hi@newcite@form{fc}{#1}{%
        \hi@citeguts{%
            \hi@ifset\hi@kv@author{%
                \hi@namelist@instpart\hi@kv@author{\@iden},\space
            }{}%
            \noexpand\hi@fn@arttitle{\hi@kv@name}%
            \hi@maybepage{\hi@font@comma}%
            \hi@font@comma
            \hi@kv@type\space Doc. \hi@kv@intdoc
        }%
        \the\hi@param@parens
        \hi@parens@add{\hi@paren@date}{\hi@kv@year}%
        \hi@ifset\hi@kv@author{%
            \hi@namelist@personpart\hi@kv@author{\hi@intdoc@personauth}%
        }{}%
    }%
    \protected@edef\reserved@a{\hi@kv@type\space Doc. \hi@kv@intdoc}%
    \@expand{\hi@supra@form{#1}}\reserved@a i%
}
Typically these are reports.

\keyparameters{
    {author, instauth}{The author of the document. The institutional author will
    be separated from the human author, with the latter placed in a
    parenthetical.}
    {name}{Title of the document.}
    {type}{The institution issuing the document control number, default
    ``U.N.''}
    {intdoc}{The international institution control number, typically containing
    slashes.}
    {year}{The date of the document.}
}

\hi@newcite\deffrcase{A French case}{%
    \hi@citetype{#1}\hi@type@case
    \hi@newcite@form{fc}{#1}{%
        \hi@citeguts{%
            \hi@kv@court\space
            decision no.\ \hi@kv@number,
            \hi@kv@year,
            \hi@kv@rep\space\hi@kv@page
            \hi@maybepage{, }%
        }%
        \the\hi@param@parens
    }%
    \protected@edef\reserved@a{\hi@kv@court\space decision no.\ \hi@kv@number}%
    \@expand{\hi@supra@form{#1}}\reserved@a i%
}

\keyparameters{
    {court}{The name of the court.}
    {number}{The decision number.}
    {year}{The year of decision.}
    {rep, page}{The locator information for the decision.}
}

\hi@newcite\deffrstat{A French statute}{%
    \hi@citetype{#1}\hi@type@statute
    \hi@newcite@form{fc}{#1}{%
        \hi@citeguts{%
            Law No. \hi@kv@number\space
            of \hi@kv@year,
            \hi@kv@rep,
            \hi@kv@pubyear, % This parameter does not exist; needs to be defined
            p. \hi@kv@page
            \hi@maybepage{, }%
        }%
        \the\hi@param@parens
    }%
}

\keyparameters{
    {number}{The law number.}
    {year}{The year of enactment.}
    {rep}{The statutory compilation.}
    {pubyear}{The year of publication of the statutory compilation.}
    {page}{The page in the compilation.}
}
%%
%% \iffalse filename: specrefs.dtx \fi
\input driver
\thisis{specrefs}{Specific Reference Types}

These reference types could fall under the umbrella \rtype{book} reference type,
but it is helpful to include them to provide unique formatting and/or to save on
data entry.

\input docparams
\hi@newcite\defcjs{Corpus Juris Secondum}{%
    \hi@citetype{#1}\hi@type@other
    \hi@newcite@form{fc}{#1}{%
        \hi@citeguts{%
            \hi@kv@vol\space
            C.J.S.
            \hi@fn@arttitle{\hi@kv@name}%
            \hi@maybepage{ }%
        }%
        \hi@parens@add{\hi@paren@date}{\hi@kv@year}%
        \the\hi@param@parens
    }
    \protected@edef\reserved@a{%
        \hi@kv@vol\space C.J.S. \hi@fn@arttitle{\hi@kv@name}%
    }%
    \@expand{\hi@supra@form{#1}}\reserved@a i%
}
\keyparameters{
    {vol}{The volume number.}
    {name}{The entry name.}
    {year}{The year of publication.}
}
\hi@newcite\defrfc{An IETF Request for Comments}{%
    \hi@citetype{#1}\hi@type@other
    \expandafter\hi@book@titlethe\expandafter{\hi@kv@name}%
    \hi@abbrev@name{Internet Engineering Task Force}{\def\hi@kv@publisher}%
    \protected@edef\reserved@a{%
        https://www.rfc-editor.org/rfc\hi@kv@number.txt%
    }
    \protected@edef\hi@kv@number{RFC \hi@kv@number}%
    \@expand{\hi@defkey@url{}}\reserved@a i\@empty
    \hi@newcite@form{ic}{#1}{%
        \hi@kv@number
    }%
    \@expand{\hi@supra@form{#1}}\hi@kv@number i%
    \hi@book@pubparen
    \hi@ifset\hi@kv@year{}{\PackageError\hi@pkgname{Year is required for #1}}%
    \hi@newcite@form{fc}{#1}{%
        \hi@ifset\hi@kv@author{%
            \noexpand\@gobble{\hi@kv@authln}%
        }{}% For sorting purposes
        \noexpand\if@hi@inline
            \expandafter\noexpand\csname ic@#1\endcsname
        \noexpand\else
            \hi@citeguts{%
                \hi@ifset\hi@kv@author{%
                    \hi@fn@bookauthor{\hi@kv@author}, % space
                }{}%
                \hi@fn@booktitle{\hi@kv@name}%
                \hi@maybepage{\hi@page@space\hi@kv@name}%
            }%
            \hi@book@paren
            \the\hi@param@parens
        \noexpand\fi
    }%
}
This reference type automatically adds the serial number, inline citation
format, and URL based just on the RFC number.

\keyparameters{
    {author, name, year}{Bibliographic information for the RFC.}
    {number}{The RFC number.}
}
\bookparenparameters
%%
%% \iffalse filename: otherrefs.dtx \fi
%%
\input driver
\thisis{otherrefs}{Other Reference Types}

\input docparams
\hi@newcite\defletter{A letter or memorandum}{%
    \hi@citetype{#1}\hi@type@other
    \hi@ifset\hi@kv@type{}{\def\hi@kv@type{Letter}}
    \@expand{\find@in{, }}{\hi@kv@author}i{%
        \def\reserved@a{, }\@gobbletwo
    }{\def\reserved@a{ }}%
    \hi@newcite@form{fc}{#1}{%
        \hi@citeguts{%
            \@capnext\hi@kv@type
            \hi@ifset\hi@kv@author{ from \hi@kv@author}{}%
            \hi@ifset\hi@kv@to{\reserved@a to \hi@kv@to}{}%
            \hi@ifset\hi@kv@name{, \noexpand\hi@fn@arttitle{\hi@kv@name}}{}%
            \hi@maybepage{ }%
        }%
        \hi@parens@add{\hi@paren@date}{\hi@kv@year}%
        \the\hi@param@parens
    }%
    \hi@newcite@form{lc}{#1}{%
        \hi@citeguts{%
            \hi@ifset\hi@kv@author{%
                \hi@toa@dupauthor{}{\hi@kv@author@sortable}\hi@kv@type
            }{%
                \@capnext\hi@kv@type
            }%
            \hi@ifset\hi@kv@to{ to \hi@kv@to}{}%
            \hi@ifset\hi@kv@name{, \noexpand\hi@fn@arttitle{\hi@kv@name}}{}%
        }%
        \hi@parens@add{\hi@paren@date}{\hi@kv@year}%
        \the\hi@param@parens
    }%
    \@expand{\hi@supra@form{#1}}\hi@kv@authln i%
}
The defining characteristic of this reference type is that it is a communication
sent from one party to another. Nevertheless, the recipient is optional and can
be omitted, useful perhaps for open letters or memoranda not directed to any
particular person.

Letters between institutions are typically still signed by and addressed to
individuals. As a result, the ability to attach institutional affiliations to
human authors (see \sec{names}) is especially useful for these references, to
identify the companies, agencies, or institutions that are the actual
communicants.

\keyparameters{
    {author}{The sender of the letter.}
    {to}{The recipient of the letter.}
    {date}{The date the letter was sent.}
}
\optparameters{
    {type}{The type of document, default ``Letter.''}
    {name}{A subject line or title of the letter (more common for memoranda).}
}

\begin{demo}
\Example
\begin{verbatim}
\defletter{alice-memo}{
    date=may 13 2013,
    type=Memorandum,
    author={Andrew H. Hirshfeld, United States Patent and Trademark Office},
    instto=Patent Examining Corps,
    title=Federal Circuit Decision in \emph{CLS Bank et al. v. Alice Corp.},
}
\end{verbatim}
\Produces Memorandum from Andrew H. Hirshfeld, U.S. Patent \& Trademark Off., to
Patent Examining Corps, \emph{Federal Circuit Decision in \emph{CLS Bank et al.\
v.\ Alice Corp.}}\ (May 13, 2013).
\end{demo}

\hi@newcite\defpressrelease{A press release}{%
    \hi@citetype{#1}\hi@type@other
    \hi@ifset\hi@kv@type{}{\def\hi@kv@type{Press Release}}%
    \hi@newcite@form{fc}{#1}{%
        \hi@citeguts{%
            \hi@kv@type,
            \hi@ifset\hi@kv@author{\hi@kv@author@sortable, }{}%
            \hi@ifset\hi@kv@name{\noexpand\hi@fn@arttitle{\hi@kv@name}}{}% Title
            \hi@maybepage{ }%
        }%
        \hi@parens@add{\hi@paren@date}{\hi@kv@year}%
        \the\hi@param@parens
    }%
    \protected@edef\reserved@a{%
        \hi@ifset\hi@kv@authln{\@capnext\hi@kv@authln}{%
            \noexpand\hi@fn@arttitle{\hi@kv@name}%
        }%
    }%
    \@expand{\hi@supra@form{#1}}\reserved@a i%
}

\keyparameters{
    {name}{The title of the press release.}
    {year}{The date of the press release.}
}
\optparameters{
    {type}{The type of document, default ``Press Release.''}
    {author, instauth}{The name of the issuer of the press release. This is
    optional and not included in other citation systems, but unless the issuer
    is in the press release title, there may be no other way to identify who
    published the press release.}
}

\begin{demo}
\Example
\begin{verbatim}
\defpressrelease{lockyer-pr}{
title=Attorney General Bill Lockyer Files ``Friend of Court'' Brief over Unocal
Gasoline Patent,
date=Sep 14 2000,
}
\end{verbatim}
\Produces Press Release, \emph{Attorney General Bill Lockyer Files ``Friend of
Court'' Brief over Unocal Gasoline Patent} (Sept.\ 14, 2000).
\end{demo}

\hi@newcite\defspeech{A speech, address, or presentation}{%
    \hi@citetype{#1}\hi@type@other
    \hi@ifset\hi@kv@type{}{\def\hi@kv@type{Address}}
    \hi@newcite@form{fc}{#1}{%
        \hi@citeguts{%
            \hi@ifset\hi@kv@author{\hi@kv@author@sortable, }{}%
            \hi@kv@type
            \hi@ifset\hi@kv@place{\space at the \hi@kv@place}{}%
            \hi@ifset\hi@kv@name{: \hi@kv@name}{}%
            \hi@maybepage{\hi@page@space\hi@kv@name}%
        }%
        \the\hi@param@parens
        \hi@parens@add\hi@paren@date{\hi@kv@year}%
    }%
    \protected@edef\reserved@a{%
        \hi@ifset\hi@kv@authln{\@capnext\hi@kv@authln}{\hi@kv@name}%
    }%
    \@expand{\hi@supra@form{#1}}\reserved@a i%
}
Besides the obvious uses for delivered speeches, this reference form is useful
for citing slide decks made available online. The more conventional practice of
citing slide decks as books is undesirable insofar as it gives more apparent
authoritative weight than is due most slide decks.

\keyparameters{
    {author}{The speaker or presenter.}
    {year}{The date the speech was given.}
}
\optparameters{
    {type}{The type of speech, default ``Address.'' For slide decks,
    ``Presentation'' is a good choice.}
    {place}{The location, event, or institution where the speech was given.}
    {name}{A title of the speech.}
}

\begin{demo}
\Example
\begin{verbatim}
\defspeech{purvis}{
    author={Sue A. Purvis, U.S. Patent and Trademark Office},
    type=Presentation,
    title=The Role of the Patent Examiner,
    date=april 8 2013,
}
\end{verbatim}
\Produces Sue A. Purvis, U.S. Patent \& Trademark Off., Presentation: The Role
of the Patent Examiner (Apr.~8, 2013).
\end{demo}

\hi@newcite\deffilm{A film (movie/motion picture)}{%
    \hi@citetype{#1}\hi@type@other
    \hi@newcite@form{fc}{#1}{%
        \hi@citeguts{%
            \noexpand\hi@fn@booktitle{\hi@kv@name}%
        }%
        \hi@parens@add{\hi@paren@date}{\hi@kv@publisher\space\hi@kv@year}%
        \the\hi@param@parens
    }%
    \protected@edef\reserved@a{%
        \noexpand\hi@fn@booktitle{\hi@kv@name}%
    }%
    \@expand{\hi@supra@form{#1}}\reserved@a i%
}
This format is somewhat deprecated as it can be implemented entirely with
\rtype{website}.

\keyparameters{
    {name}{The name of the film.}
    {publisher}{The studio that published the film. It is unclear which entity
    this is when there are multiple studios involved in the distribution chain.}
    {year}{The year the film was released.}
}

\hi@newcite\deftvshow{A television show}{%
    \hi@citetype{#1}\hi@type@other
    \hi@newcite@form{fc}{#1}{%
        \hi@citeguts{%
            \hi@fn@arttitle{\hi@kv@name}%
        }%
        \the\hi@param@parens
        \hi@parens@add{\hi@paren@date}{%
            \hi@param@optspc\hi@kv@publisher\hi@kv@year
        }%
    }%
    \protected@edef\reserved@a{%
        \noexpand\hi@fn@arttitle{\hi@kv@name}%
    }%
    \@expand{\hi@supra@form{#1}}\reserved@a i%
}
This format is somewhat deprecated as it can be implemented entirely with
\rtype{website}.

\keyparameters{
    {name}{The name of the show.}
    {publisher, broadcaster}{The broadcaster of the show.}
    {year}{The year the show aired.}
}

\hi@newcite\defopinion{An ethics or other opinion}{%
    \hi@citetype{#1}\hi@type@other
    \hi@ifset\hi@kv@type{}{\def\hi@kv@type{Formal Opinion}}%
    \@expand\hi@abbrev@cdoc\hi@kv@type i{\def\hi@kv@type}%
    \hi@newcite@form{fc}{#1}{%
        \hi@citeguts{%
            \hi@kv@author,
            \hi@kv@type\space \hi@kv@number
            \hi@maybepage{, \hi@page@atorsect}%
        }%
        \hi@parens@add{\hi@paren@date}{\hi@kv@year}%
        \the\hi@param@parens
    }%
    \protected@edef\reserved@a{\hi@kv@type\space \hi@kv@number}%
    \@expand{\hi@supra@form{#1}}\reserved@a i%
}
These are issued by the American Bar Association, for example. Opinions issued
by the government should use a different reference type.

\keyparameters{
    {author}{The author of the opinion.}
    {number}{The serial number of the opinion.}
    {year}{The date of the opinion.}
}
\optparameters{
    {type}{The type of document, default ``Formal Opinion.''}
}

%%
%% \iffalse filename: nondocrefs.dtx \fi
%%
\input driver
\thisis{nondocrefs}{Non-Document References}

These references and reference types are not associated with documents or
authorities, but serve other purposes in this package's system.

\input docparams

\hi@newcite\defabbrev{An abbreviation for a name}{%
    \hi@ifset\hi@kv@name{%
        \hi@replacethe\hi@kv@name{\def\hi@kv@name}{}%
        \@expandarg\hi@abbrev@name{\hi@kv@name}{\def\hi@kv@aname}%
    }{%
        \PackageError\hi@pkgname{%
            For abbreviation #1, no name given%
        }{You must provide the name}%
    }%
    \hi@ifset\hi@kv@inline{%
        \hi@replacethe\hi@kv@inline{\def\hi@kv@inline}{}%
        \@expand{\hi@short@register{#1}}\hi@kv@inline i{y}%
        %
        % Unless the user has explicitly rejected it, tack on a parenthetical of
        % the short name to the full citation form.
        %
    }{%
        \PackageError\hi@pkgname{%
            For abbreviation #1, no inline given%
        }{You must provide the inline form}%
    }%
    \hi@newcite@form{fc}{#1}{%
        \hi@citeguts{%
            \noexpand\if@hi@inline
                \noexpand\@capnext\hi@kv@name
            \noexpand\else
                \noexpand\@capnext\hi@kv@aname
            \noexpand\fi
            \hi@ifset\hi@kv@noinlineparen{}{%
                \hi@short@maybeshow{#1}{\space
                    {\noexpand\@hi@adjectivetrue(``\hi@kv@inline'')}%
                    \noexpand\@%
                }%
            }%
        }%
        \hi@invis@inline
    }%
    \hi@newcite@form{sc}{#1}{%
        \hi@citeguts{\noexpand\@capnext\hi@kv@inline}%
        \noexpand\@%
        \hi@short@use{#1}%
        \hi@invis@inline
    }%
}
The full citation form produces the unabbreviated name and a definitional
parenthetical, and the short citation form produces the abbreviated name. This
reference type should only be used in inline citations. \unskip\footnote{In
future versions, it is hoped that named abbreviations can be used as
institutional author titles.} The abbreviation reference type makes use of the
short name management features of this package described in \sec{short}. If an
abbreviation is used only once, the parenthetical is automatically suppressed.
It also manages use of ``The'' at the beginning of names correctly, in
accordance with |\adjective| as described in \sec{iface}. Thus, if the following
is defined:
\begin{demo}
|\defabbrev{fda}{|\\
|    name=the Food and Drug Administration,|\\
|    inline=the FDA|\\
|}|
\end{demo}
then the following will be produced:
\begin{demo}
\begin{tabular}{lp{0.4\textwidth}}
\textbf{Input} & \textbf{Output} \\
\hline
|\inline{fda}| (used only once) & the Food and Drug Administration \\
|\inline{fda}| & the Food and Drug Administration (``FDA'') \\
|\inline{fda}| & the FDA \\
|\adjective{fda} regulations| & FDA regulations \\
\end{tabular}
\end{demo}

This reference type produces invisible inlines (see \sec{iface-invisible}) so
that it does not affect \emph{id.}\ citations surrounding it.

\keyparameters{
    {name}{The unabbreviated name. Include ``The'' at the beginning if that is
    how the full name is used in ordinary speech.}
    {inline}{The short or abbreviated name. Include ``The'' at the beginning if
    that is how the abbreviation is used in ordinary speech.}
}
\hi@newcite\defalias{An alias for a citation reference}{%
    \hi@ifset\hi@kv@citation{}{%
        \hi@ifset\hi@kv@rep{%
            \let\hi@kv@citation\hi@kv@rep
        }{%
            \PackageError\hi@pkgname{%
                In defining alias #1, you must provide citation or rep%
            }{Add the requested parameter}%
        }%
    }%
    %
    % The full citation form should never be used
    %
    \hi@newcite@form{fc}{#1}{%
        \noexpand\PackageError\noexpand\hi@pkgname{%
            Reference #1 is an alias and should never be cited%
        }{Something is wrong with the package}%
    }%
    %
    % The modification macro should set the volume and reference name
    %
    \hi@newcite@form{mc}{#1}{%
        \def\noexpand\@this@case{\hi@kv@citation}%
        \hi@ifset\hi@kv@vol{%
            \noexpand\ifx\noexpand\@this@vol\relax
                \def\noexpand\@this@vol{\hi@kv@vol}%
            \noexpand\fi
        }{}%
        \hi@ifset\hi@kv@page{%
            \noexpand\ifx\noexpand\@this@page\relax
                \def\noexpand\@this@orig@page{\expandonce\hi@kv@page}%
                \def\@this@page{\@format@page@macro\hi@kv@page}%
            \noexpand\fi
        }{}%
    }%
    %
    % The page number macro should combine page numbers and set \@this@orig@page
    % and \@this@page appropriately
    %
    \hi@newcite@form{pc}{#1}##1{%
        \hi@ifset\hi@kv@page{%
            \noexpand\hi@pages@join{\expandonce\hi@kv@page}{##1}%
        }{%
            \noexpand\protected@edef\noexpand\@this@page{%
                \noexpand\@format@pageno{##1}%
            }%
        }%
    }%
}

Aliases a reference name to another. The main advantage is that the alias can
have a default volume and pin cite. For example, consider the alias:
\begin{demo}
|\defalias{sec-5}{|\\
|    name=ftc-act,|\\
|    page=S 5|\\
|}|
\end{demo}
with |ftc-act| defined as the relevant statute. Now, the following two are
equivalent:
\begin{demo}
|\sentence{sec-5}.|\\
|\sentence{ftc-act at S 5}.|
\end{demo}
Moreover, pin cites given for the alias in citations use the pin cite joining
algorithm given in \sec{pages-join}. Thus:
\begin{demo}
|\sentence{sec-5 at /a}.|
\end{demo}
will cite \textsection~5(a) of the statute.

\keyparameters{%
    {citation, rep}{Reference name to be aliased.}
    {page}{Pin cite to be used as the default pin cite for the alias.}
}

\newcount\hi@anonselfcitecount
\hi@newcite\defselfcite{A self-citation}{%
    \global\advance\hi@anonselfcitecount\@ne
    \hi@newcite@form{fc}{#1}{%
        \hi@citeguts{%
            [Self-citation \#\the\hi@anonselfcitecount]%
        }%
    }%
}%
This is useful for quickly replacing self-citations when submitting to journals
that require anonymity. No parameters are required; a unique name is
automatically generated for the citation.

\subsection{\texttt{this}}

\label{rtype:this}

Reference |this| is not a reference type but the name of a single predefined
reference, used for cross-references. See \sec{xref}.

\subsection{\texttt{verbatim}}

\label{rtype:verbatim}

Reference |verbatim| is not a reference type but the name of a single predefined
reference, the purpose of which is to enable arbitrary text in a citation item.
When using |verbatim| in a citation item, the pin cite text is not parsed but is
used verbatim as the formatted citation text:
\begin{demo}
|\sentence{see verbatim at {the \textbf{Moon}} (shining)}.|
\Produces \emph{See} the \textbf{Moon} (shining).
\end{demo}
Note how signals and parentheticals are still parsed and formatted around the
user-defined citation text.

\clearpage
\part{Reference Parameters}
\label{p:allparams}

These are all of the parameters that may be given when defining a reference.
Parameters in \emph{italics} are aliases for others.

The long history of development of this package has meant that some parameter
names do not conform with the naming conventions otherwise followed in this
package. In particular, \param{inline} and related parameters relate not to
inline citations but to short reference names (see \sec{short}), and date
parameters typically end in |year| even though full date specifications are
permitted (see \sec{dates}). Generally, aliases to properly conforming names are
provided.

%%
%% \iffalse filename: genparams.dtx \fi
%%
\input driver
\thisis{genparams}{Generally Applicable Parameters}

These parameters may be used in defining any reference, regardless of type.

\input docparams

\hi@defparam{accessdate}{URL access date}{%
    \hi@date@parse[last visited]{#1}{\def\reserved@a}%
    \expandafter\hi@param@addparen\expandafter\hi@paren@accessdate
        \expandafter{\reserved@a}%
}
This is added as a parenthetical immediately after the \param{url} parameter.
(It can be used without \param{url}, perhaps to indicate the access date of a
non-linked online resource such as a case in a database service.) The date
qualifier ``last visited'' is prepended to the date unless another qualifier is
given.
\hi@defparam@noval{bookreview}{Indicator that an article is a book review}{%
    \ifstrempty{#1}{%
        \hi@param@addparen\hi@paren@bookreview{book review}%
    }{%
        \hi@param@addparen\hi@paren@bookreview{reviewing \clause{#1}}%
    }%
}
This adds a parenthetical. If no value is given, then the parenthetical reads
just ``book review.'' Otherwise, the value should be a reference name for the
book being reviewed, which will be cited in the parenthetical.
\hi@defparam{citetype}{Table of Authorities category for this citation}{%
    \@ifundefined{hi@type@#1}{%
        \PackageError\hi@pkgname{Invalid Table of Authorities section #1}{%
            Please enter a valid section identifier.
        }%
    }{%
        \@expand{\hi@citetype{\@this@case}}{\csname hi@type@#1\endcsname}{i}%
    }%
}
The valid category types are listed in \sec{refs}.
\hi@param@alias{comment}{paren}
This parameter was originally used for commentary, but now the \param{paren}
parameter handles those as well.
\hi@defparam{country}{Country for citation}{%
    \@ifundefined{hi@ctry@#1}{\hi@param@addparen\hi@paren@country{#1}}{%
        \@expand{\hi@param@addparen\hi@paren@country}{%
            \csname hi@ctry@#1\endcsname
        }{ii}%
    }%
}
This should generally be added to any reference with legal authority outside the
United States. The country name is automatically abbreviated.
\hi@newparam{defaultopt}{The default optional parameter}
Some reference types that use the optional argument will use this value if the
optional argument is unset.
\hi@defparam{hereinafter}{Text to use for hereinafter citation form}{%
    \expandafter\hi@short@register\expandafter{\@this@case}{#1}{y}%
    \hi@supra@form\@this@case{#1}%
    \hi@param@addparen\hi@paren@hia{#1}%
}
This parameter will define the short-form citation for the reference.
\hi@defparam{hyphenate}{Set hyphenation for a word}{%
    \hyphenation{#1}%
}
This just calls |\hyphenation| on the word(s) given in the value. It is
convenient if unusual hypheniation is required for a word in the reference
(e.g., a named party to a case), because it keeps the hyphenation as
bibliographic data.
\hi@param@alias{hyphenation}{hyphenate}
\hi@newparam{kind}{Type of reference}
This is automatically set when the |\def|\meta{kind} command is called to define
a reference, and it should not be changed.
\hi@newparam@noval{noetal}{No et al. with 3 or more authors}
This parameter has no display effect, but advises the package not to issue a
warning if it detects an name list of three or more entities.
\hi@defparam@noval{notoa}{Do not include in the table of authorities}{%
    \hi@citetype\@this@case\@empty
}
\hi@newparam{opturl}{Optional URL}
Generally this parameter is ignored. However, if the package option
\opt{useopturl} is set, then this parameter is an alias for \param{url}. This
is useful for references where a URL could be helpful for some publications but
not others, as it enables the writer to quickly switch between presentation
forms.
\hi@defparam{origyear}{Year of original publication of the reference}{%
    \hi@date@parse{#1}{\hi@param@addparen\hi@paren@origdate}%
}
This is typically used when a modern edition of a pre-1900 work is cited, such
that the \param{year} parameter is set to the modern publication year and this
parameter set to give the original publication date of the work.
\hi@param@alias{origdate}{origyear}
\hi@defparam{parallel}{Parallel citation}{%
    \find@in{: }{#1}{\hi@defkey@parallel}{%
        \PackageError\hi@pkgname{%
            Parameter `parallel' must include a page segment\MessageBreak
            key name, followed by a colon%
        }{It should look like `key: 123 Rep. 456'}%
    }%
}
This must be entered in the form \meta{key}|: |\meta{cite}. The \meta{key} is
used as a pin cite segment key, described in \sec{pages}. When the relevant
reference is cited, the parallel cite is added before the date parenthetical,
along with a page number found in the appropriate section of the given pin cite
if present. The \meta{cite} text is used as given and not parsed or abbreviated.

\textbf{Note}: Currently the parallel citation is only displayed in the full
citation. This is because the package has no mechanism for displaying
document-level parentheticals in short citations. Hopefully this will be fixed
in the future.
\hi@defparam{paren}{A parenthetical to be included with citation}{%
    \find@try\find@in{%
        { in: }{\hi@defkey@cmt{ in}}%
        { by: }{\hi@defkey@cmt{ by}}%
        { at: }{\hi@defkey@cmt{ at}}%
    }{#1}{%
        \hi@param@addparen\hi@paren@doc{#1}%
    }%
}
The parenthetical will be included in any full citation. If the parenthetical
contains the words |in:|, |by:|, or |at:|, it is treated as commentary such that
what follows the colon is a citation string to be formatted. Thus,
|quoted in: ref| will produce a parenthetical ``(quoted in |\clause{ref}|).''
\hi@defparam{parse}{Apply automatic citation parser}{\hi@cparse{#1}}
The value is a formatted reference input as described in \sec{cparse}. It is
useful if that input contains an equal sign, which would otherwise cause this
package to mistakenly interpret the formatted input as parameter-value input.
\hi@defparam{reprinted}{Reprinted in parenthetical}{%
    \hi@anonref{#1}{\hi@reprinted}%
}
The value should be a reference identifier or an anonymous reference defintion
as described in \sec{anonymous}.
\hi@defparam{supplement}{Year/date of a supplement to the reference}{%
    \hi@date@parse[Supp.]{#1}{\def\hi@kv@supplement}%
    \hi@param@addhook{%
        \hi@ifset\hi@kv@year{%
            \addto@macro\hi@kv@year{ \& }%
            \expandafter\addto@macro\expandafter\hi@kv@year\expandafter{%
                \hi@kv@supplement
            }%
        }{%
            \let\hi@kv@year\hi@kv@supplement
        }%
    }%
}
The value should be a date (see \sec{dates}), for which the date qualifier
``Supp.''\ will be added if no other qualifier is given. If both this parameter
and \param{year} are set, then the two will be joined with an ampersand (e.g.,
``1995 \& Supp.~1996'').
\hi@defparam@noval{toapage}{Include page numbers in Table of Authorities}{%
    \hi@include@page@in@toa{\@this@case}%
    \def\hi@kv@toapage{}%
}
Generally, Table of Authorities entries are for individual references; this
parameter will cause an entry to be generated for each page of the reference
cited. Some reference types, such as \rtype{statcode}, do this by default.
Additionally, some reference types, such as \rtype{book}, will format Table of
Authorities entries differently when this parameter is given.
\hi@defparam{url}{URL for reference}{%
    \find@try\find@start{%
        {available at }{\hi@urlprefixwarn\KV@hi@url}%
        {at }{\hi@urlprefixwarn\KV@hi@url}%
    }{#1}{%
        \hi@parseurl{#1}\hi@kv@url
        \@expandarg\hi@defkey@url{\hi@kv@url}%
    }%
}
See \sec{urls} for information on how to present the URL and how it is
formatted.
%%
%% \iffalse filename: commparams.dtx \fi
%%
\input driver
\thisis{commparams}{Common Parameters}

These parameters are frequently used across many reference types. A general
description of each is given, but unlike the generally-applicable parameters in
\sec{genparams}, some reference types may use these parameters in special or
idiosyncratic ways, which should be described in the documentation for each
reference type.

\input docparams

\hi@newparam{authln}{Last name of the first author, for short citations}
The \param{author} parameter will set this parameter automatically. This
parameter can be set after giving the authors to customize the last name.
\hi@defparam{author}{Author of the reference}{%
    \hi@defkey@author@addinlines
    \hi@nameproc@person{#1}{\hi@namelist@addtwo\hi@kv@author\hi@kv@authln}%
}
\def\hi@defkey@author@addinlines{%
    \hi@ifset\hi@kv@author{}{%
        \hi@param@addhook{%
            \hi@newcite@form{ifc}{\@this@case}{%
                \hi@citeguts{\hi@kv@author}%
            }%
            \hi@newcite@form{isc}{\@this@case}{%
                \hi@citeguts{\hi@kv@authln}%
            }%
        }%
    }%
}
The value should be a name as described in \sec{names}. If there are multiple
authors, provide this parameter multiple times, but see also parameter
\param{noetal} if entering three or more names. For institutional authors, see
parameter \param{instauth}.

If at least one author is given, then the author names will automatically be
used as the inline citation forms for the reference.
\hi@defparam{cite}{Volume-reporter-page citation}{%
    \hi@cp@cite{#1}\KV@hi@vol\KV@hi@rep\KV@hi@page\KV@hi@year
}
The value for this parameter should follow the syntax:
\begin{grammar}
\meta{vol} \meta{rep} \meta{page} [ \littext{(}\meta{year}\littext{)} ] \\
\Example |123 F.3d 456 (2009)|
\end{grammar}
and this parameter will set the parameters \param{vol}, \param{rep},
\param{page}, and \param{year} accordingly. See the discussion of
volume-reporter-page parsing in \sec{cparse} for more details.
\hi@param@alias{date}{year}
\hi@newparam{inline}{Short name for the reference}
\hi@defparam{instauth}{Institutional author}{%
    \hi@defkey@author@addinlines
    \hi@nameproc@inst{#1}{\hi@namelist@addinst}{\hi@kv@author}%
    \hi@nameproc@inst{#1}{\hi@namelist@addinst@ln}{\hi@kv@authln}%
}
Adds an institutional author to the \param{author} parameter list.
\hi@param@alias{jcite}{cite}
\hi@param@alias{journal}{rep}
\hi@param@alias{journaltitle}{rep}
\hi@param@alias{booktitle}{rep}
\hi@newparam{name}{Name of the reference}
Nearly every reference type accepts this parameter, which generally should be
the title of the reference. See the relevant reference type description for more
information.
\hi@newparam{number}{Number (for constitutional amendments, session laws)}
The |number| parameter generally is used for a serial number associated with the
work, which may or may not contain text prefixes. Examples are patent numbers
(\rtype{patent}), bill numbers (\rtype{bill}), and constitutional amendments
(\rtype{constamend}). For most reference types (patents being an exception), the
number is not analyzed or formatted in any way.

For \rtype{book} and \rtype{workingpaper} references, consider also the
\param{serial} parameter to set the \param{publisher} parameter as well.
\hi@newparam{page}{Page number}
See \sec{pages} for the usual formatting of this parameter's value.
\hi@param@alias{pages}{page}
\hi@newparam{rep}{Reporter or journal name}%
Whether the value of this parameter needs to be abbreviated will depend on the
reference type.
\hi@param@alias{series}{number}
\hi@param@alias{short}{inline}
\hi@param@alias{shorttitle}{inline}
\hi@param@alias{src}{rep}
\hi@param@alias{subdiv}{page}
\hi@param@alias{title}{name}
\hi@newparam{type}{Type of work}
For \rtype{jrnart} references, this would be ``Note'' or ``Comment,'' for
example. Other types of references use this parameter to replace default values
indicating the work type: \rtype{comments} for example will use this value
instead of the word ``Comments.'' The use of this parameter is highly specific
to the reference type.
\hi@defparam{vol}{Volume number}{%
    \find@in{:}{#1}{\@twodef\hi@kv@vol\hi@kv@issue}{\def\hi@kv@vol{#1}}
}
\hi@param@alias{volume}{vol}
\hi@defparam{year}{Year/date of the case, article, regulation}{%
    \hi@date@parse{#1}{\def\hi@kv@year}%
}
%%
%% \iffalse filename: caseparams.dtx \fi
%%
\input driver
\thisis{caseparams}{Parameters for Cases}

These parameters are specifically for \rtype{case} and similar references.

\input docparams

\hi@defparam{agency}{Administrative agency name}{%
    \hi@abbrev@name{#1}{\KV@hi@court}%
}
Essentially the same as \param{court} except the name will be abbreviated.
\hi@newparam{court}{Court deciding the case}
The court name will \emph{not} be abbreviated, at least currently.
\hi@newparam{d}{Second party name in the case}
See \sec{caseref-parties} for the input syntax for this parameter.
\hi@newparam{dbid}{Database identifier for an online case}
\hi@defparam{docket}{Docket number of the case}{%
    \hi@defkey@docket#1\@stop{#1}%
}
If the value starts with a number, the word ``No.\@'' will be automatically
prepended to the docket number.
\hi@defparam@noval{enbanc}{En banc case parenthetical}{%
    \hi@param@addparen\hi@paren@opinion{en banc}%
}
Although intended for cases, this parameter can be attached to any reference.
\hi@newparam@noval{inlinedefendant}{Don't use the first party as main party}
For \rtype{case} citations, the first party named is typically used as the short
name (with some exceptions). This parameter forces the second party to be used.
\hi@defparam@noval{mem}{Memorandum opinion parenthetical}{%
    \hi@param@addparen\hi@paren@opinion{mem.}%
}
Although intended for cases, this parameter can be attached to any reference.
\hi@newparam{p}{First party name in the case}
See \sec{caseref-parties} for the input syntax for this parameter.
\hi@defparam{parties}{Named parties to a case, separated by `` v. ''}{%
    \find@in{ v. }{#1}{\@tworun\KV@hi@p\KV@hi@d}{\KV@hi@name{#1}}%
}
This is a shortcut for setting parameters \param{p} and \param{d}.
\hi@defparam@noval{percuriam}{Per curiam opinion}{%
    \hi@param@addparen\hi@paren@opinion{per curiam}%
}
\hi@newparam{prior}{Prior history for a case}
The syntax for this parameter is described in \sec{caseref-history}.
\hi@defparam@noval{revparties}{Parties to this case are reverse of named case}{%
    \@ifundefined{case@#1@p}{}{%
        \@expand\KV@hi@d{\csname case@#1@p\endcsname}{ii}%
    }%
    \@ifundefined{case@#1@d}{}{%
        \@expand\KV@hi@p{\csname case@#1@d\endcsname}{ii}%
    }%
    \@ifundefined{case@#1@name}{}{%
        \@expand\KV@hi@name{\csname case@#1@name\endcsname}{ii}%
    }%
}
\hi@defparam@noval{sameparties}{Parties to this case are same as named case}{%
    \@ifundefined{case@#1@p}{}{%
        \@expand\KV@hi@p{\csname case@#1@p\endcsname}{ii}%
    }%
    \@ifundefined{case@#1@d}{}{%
        \@expand\KV@hi@d{\csname case@#1@d\endcsname}{ii}%
    }%
    \@ifundefined{case@#1@name}{}{%
        \@expand\KV@hi@name{\csname case@#1@name\endcsname}{ii}%
    }%
}
\hi@newparam@noval{slip}{Slip opinion or law}
\hi@param@alias{slipop}{slip}
\hi@newparam{subsequent}{Subsequent history for a case}
The syntax for this parameter is described in \sec{caseref-history}.
%%
%% \iffalse filename: legparams.dtx \fi
%%
\input driver
\thisis{legparams}{Parameters for Legislative Materials}

These parameters are specific to legislative materials, including statutes and
bills.

\input docparams

\hi@param@alias{bill}{number}
As described for \rtype{bill} references, the \param{bill} (or \param{number})
parameter should be the full identifier of the bill (e.g., |S. 123|).
\hi@defparam{chapter}{Session law chapter}{%
    \KV@hi@sesslawid{ch.}%
    \def\hi@kv@number{#1}%
}
This sets parameter \param{number} to the given value, and changes parameter
\param{sesslawid} to ``ch.'' It is used for older statute references that were
organized by chapters rather than law numbers.
\hi@defparam{codified}{Citation for codification of law or regulation}{%
    \hi@defkey@codified{codified at}{#1}%
}
The value should be a formatted citation (as described for parameter
\param{cite}). Typically this parameter should be given for reference types
like \rtype{statsess} or \rtype{govdoc}, but it can be given for anything.
\hi@defparam{codifiedamended}{Citation for codification of law or regulation}{%
    \hi@defkey@codified{codified as amended at}{#1}%
}
Like \param{codified} except the text before the citation will be ``codified as
amended at.''
\hi@defparam{committee}{House or Senate committee}{%
    \hi@abbrev@leg{#1}{\def\hi@kv@committee}%
}
The name will be abbreviated.
\hi@newparam{congress}{Congressional session number}
This has to be a parameter separate from \param{number} because \rtype{bill}
references already use \param{number} for the bill identifier.
\hi@newparam{origsect}{Original section number of a statute in a code}
This is used, for example, when a U.S. Code section corresponds to a section of
a statute with different numbering (for example, section 337 of the Tariff Act
of 1930 being 19 U.S.C. \textsection~1337). It is specific to \rtype{statcode}
references, and should be obviated with the newer reference type
\rtype{stattitle}.
\hi@param@alias{publiclaw}{number}
\hi@param@alias{publno}{number}
\hi@param@alias{sesslawid}{type}
By default, this is ``Pub.~L.~No.,'' and this parameter enables changing it.
\hi@newparam{regnal}{Regnal citation for English pre-1963 statutes}
\hi@newparam{status}{Status of bill}
%%
%% \iffalse filename: bookparams.dtx \fi
%%
\input driver
\thisis{bookparams}{Parameters for Books and Articles}

This section describes parameters typically specific to books and articles not
otherwise described above. Some of the parameters will be applicable to other
reference types such as statutes, because they use the publication parenthetical
described in \sec{bookrefs-pubparen}. This section also includes parameters for
the
\rtype{citecontainer} reference type, because those are typically books.

\input docparams

\hi@defparam{edition}{Edition number of book}{%
    \protected@edef\reserved@a{\ifnum\m@ne<0#1 \fi}%
    \ifx\reserved@a\@empty
        \edef\hi@kv@edition{#1\hi@numtoord{#1} ed.}%
    \else
        \hi@abbrev@pub{#1}{\def\hi@kv@edition}%
    \fi
}
If the value is a number, then it will be converted to an ordinal number (e.g.,
|3| becomes ``3d'') and the word ``ed.''\ will be appended to it. Otherwise, the
value is abbreviated in accordance with the \abbscheme{pub} abbreviation scheme.
\hi@defparam{editor}{Editor(s) of book}{%
    \hi@nameproc@person{#1}{\hi@namelist@addtwo\hi@kv@editor\relax}%
}
The value should be a name, as described in \sec{names}. For more than one
editor, enter this parameter as many times as needed, but \param{noetal} must be
used if there are three or more editors. The ``\param{editor}'' parameter is
also used for translators or other roles; see \param{edtype}. For institutional
editors, see parameter \param{insted}.
\hi@defparam{edtype}{Editor type (default ed.)}{%
    \hi@abbrev@pub{#1}{\def\hi@kv@edtype}%
}
Changes the abbreviation placed after the editors. For example, use ``trans.''\
for translators, and ``eds.\ \& trans.''\ for editors who also translated. Note
that there is currently no support for works with an editor who is different
from a translator. This will be abbreviated according to the \abbscheme{pub}
abbreviation scheme.
\hi@newparam@noval{forthcoming}{Journal article is forthcoming}
\hi@defparam{in}{Reference name of a citation that the current item is in}{%
    \hi@anonref{#1}{\def\hi@kv@in}%
}
The value may be a reference name or an anonymous reference definition (see
\sec{anonymous}). The primary use of this parameter is to identify the
containing
work in a \rtype{citecontainer}.
\hi@defparam{insted}{Institutional editor}{%
    \hi@nameproc@inst{#1}{\hi@namelist@addinst}{\hi@kv@editor}%
}
Adds an institutional editor to the \param{editor} parameter list.
\hi@newparam{issue}{Issue number of journal}
\hi@param@alias{issuer}{publisher}
\hi@newparam@noval{noabbrevjrn}{Don't abbreviate the journal name}
This is useful if the journal was entered abbreviated already.
\hi@defparam{publisher}{Publisher of book}{%
    \hi@abbrev@name{#1}{\def\hi@kv@publisher}%
}
The publisher name will automatically be abbreviated by the \abbscheme{name}
abbreviation
scheme.
\hi@defparam{serial}{Serial number of a published work}{%
    \find@in{: }{#1}{%
        \@tworun\KV@hi@publisher\KV@hi@number
    }{%
        \find@in{, }{#1}{%
            \@tworun\KV@hi@publisher\KV@hi@number
        }{\KV@hi@number{#1}}%
    }%
}
\make@find@in{: }
\make@find@in{, }
This parameter is essentially an alias for \param{number}, except if it contains
a comma or colon, the prefix is used to set the \param{publisher} parameter.
\hi@newparam@noval{singleauthor}{All works in a collection are by one author}
This is used in \rtype{citecontainer} to change the font used for the author.
\hi@newparam@noval{usetitle}{Use title rather than author in short cites}
\hi@newparam@noval{useissue}{Include issue number in journal citations}
%%
%% \iffalse filename: refparams.dtx \fi
%%
\input driver
\thisis{refparams}{Other Parameters}

These parameters are used by other specific reference types.

\input docparams

\hi@param@alias{broadcaster}{instauth}
\hi@defparam{citation}{Citation to another reference}{%
    \hi@anonref{#1}{\def\hi@kv@citation}%
}
The value may be a reference name or an anonymous reference definition (see
\sec{anonymous}).
Different reference types will use this parameter for different
purposes. For example, \rtype{jrnart} will cite the reference as the article
title (used for notes reviewing cases), \rtype{casedoc} will use it as the case
in which a document was filed, and \rtype{citecontainer} uses it as the
contained work (the container work is given in the parameter \param{in}).
\hi@newparam{commenter}{Names of parties submitting agency comments}
\hi@defparam{countries}{Countries to a treaty}{%
    \hi@abbrev@name{#1}{\def\hi@kv@countries}%
}
The country names will be abbreviated.
\hi@newparam@noval{inlineparen}{Always include a parenthetical for inline form}
\hi@defparam{instto}{Institutional recipient of letter, memorandum, etc.}{%
    \hi@nameproc@inst{#1}{\hi@namelist@addinst}{\hi@kv@to}%
}
Adds an institutional recipient to the \param{to} parameter list.
\hi@newparam{intdoc}{Document number for international documents}
International resolutions and other documents may have two numbers: a serial
number and a document control number issued by the international body. This
parameter is for the second number. It should not include a prefix such as
``U.N. Doc.,'' as that will be added separately.
\hi@param@alias{issuedate}{issueyear}
\hi@defparam{issueyear}{Date a patent was issued}{%
    \hi@date@parse[issued]{#1}{\def\hi@kv@year}%
}
This is equivalent to |date=issued |\meta{date}.
\hi@newparam@noval{noinlineparen}{Never include a parenthetical for inline form}
\hi@newparam@noval{noshorttitle}{Do not include title for short cites}
\hi@newparam{onfile}{Where the document is on file}
\hi@newparam{place}{Place (for speeches, constitutions, statutes)}
\hi@param@alias{producer}{instauth}
\hi@param@alias{sponsor}{publisher}
\hi@param@alias{state}{place}
\hi@defparam{struct}{Structure for data of multivolume works}{%
    \global\@namedef{hi@struct@set@\@this@case}{#1}%
    \expandafter\def\expandafter\hi@kv@struct\expandafter{%
        \csname hi@struct@set@\@this@case\endcsname
    }%
}
See the discussion of parameter structures in \sec{struct}.
\hi@defparam{to}{Recipient of a letter}{%
    \hi@nameproc@person{#1}{\hi@namelist@addtwo\hi@kv@to\relax}%
}
This is primarily used for \rtype{letter} references. The value should be a name
as described in \sec{names}. If there are multiple recipients, provide this
parameter multiple times, but see also parameter \param{noetal} if entering
three or more names. For institutional authors, see parameter \param{instto}.
\clearpage
\part{Supporting Packages}
\label{p:support}

\hia* includes several supporting packages, primarily consisting of lower-level
tools for macro writing. They are distributed in standalone form in case they
are useful for other package authors.

%%
%% \iffalse filename: strings.dtx \fi
%%
\input driver
\thisis{strings}{String Processing Macros}

This package provides a variety of low-level text processing commands and macro
helpers. The section in the main \hia* documentation just provides an overview
of features; the full documentation for this file should be consulted for the
particular macros and their usage.

Initially, the package provides several syntatic sugar macros for conditionals,
definitions, and expansion control. These are similar to the |etoolbox| package.


\subsection{Expansion Control}

Although, there are several useful macros defined in this section, the notable
one is
\DescribeMacro\@expand
|\@expand|, which
expands a token multiple times. It takes three arguments: the callback to be
executed when done expanding, the stuff to expand, and a count of how many
expansions are to be performed, represented by the number of tokens in the
argument. Thus:
\begin{demo}
|\def\macro{Hello World}|\\
|\@expand{\process}{\csname macro\endcsname}{ii}|
\end{demo}
would expand |\csname macro\endcsname| twice (once for each ``i''), obtaining
the meaning of |\macro|, and then run the callback |\process|, to result in:
\begin{demo}
|\process{Hello World}|
\end{demo}


\subsection{Finders}

These macros provide convenient ways of defining text finders that, when
called, are fully expandable. They provide the ability to find text
\meta{needle} at the beginning, middle, or end of text \meta{haystack}.
The pattern is to call:
\begin{demo}
|\make@find@|\meta{type}\marg{needle}
\end{demo}
to initialize the finder, and then:
\begin{demo}
|\find@|\meta{type}\marg{needle}\marg{haystack} \\
|    |\marg{true-callback}\marg{false-callback}
\end{demo}
to execute the finder. \meta{type} is |in|, |start|, |end|, or |eq| depending on
the type of matching desired.

The callbacks for finders are given consistent arguments. The
\meta{false-callback} always receives no arguments. The \meta{true-callback},
however, receives arguments indicating the remaining unmatched text. Thus, for
|\find@in|, the \meta{true-callback} receives two arguments, the prefix and
suffix relative to the matched text. However, the callbacks for |\find@start|
and |\find@end| receive only one argument, and |\find@eq|'s callback receives
none.


\subsection{Cardinal Numbers}

\DescribeMacro\cardinaltext
The |\cardinaltext| macro changes a number into its capitalized, cardinal
textual form. For example, ``123'' becomes ``One Hundred Twenty-Three''.

\subsection{Text Tokenizer}

Often it is useful to tokenize a string of \TeX\ tokens into words, in a way
that properly handles macros and groups, and differentiates the tokens by
type. The following macros help to do that.

\DescribeMacro\find@next
The |\find@next| macro
finds the next single token by type and runs a command on it. This macro can
detect three types of things at the beginning of a string:
\begin{itemize}
\item A space
\item A group
\item A character
\end{itemize}
For each detected item, a callback macro is run with two arguments, the found
item and the remainder of the string (except for the callback when nothing is
left; this receives no arguments).


\DescribeMacro\find@word
Finds the next word in the given string and runs a callback on it. This is
like |\find@next| except (1) it aggregates letters into a single word, and (2)
it differentiates letters from other characters.


\subsection{Searching for Braced Groups}

\DescribeMacro\find@group
The |\find@group| macro
finds a braced group in a string and runs a callback with three arguments: the
pre-group text, the group (without braces), and the post-group text.

\DescribeMacro\find@group@end
The |\find@group@end| macro similarly finds a braced group, but only at the end
of a string. The callback receives only two arguments.

%%
%% \iffalse filename: abbrev.dtx \fi
%%
\input driver
\thisis{abbrev}{Abbreviations}

This package provides for abbreviating texts according to tables of
abbreviations. It also provides functions for removing spaces between dotted
initials. The abbreviation algorithms are fully expandable so that they may be
used within |\edef| definitions.

\subsection{Abbreviation Classes}

There may be multiple abbreviation classes, namely separate schemes of
abbreviations with different words abbreviated in each.

An abbreviation class is defined in the macro |\abb@class@|\meta{name}. Within
that class are a further set of macros of the form
|\abb@class@|\meta{name}|@|\meta{word}, where \meta{word} is the first word of
the text to be abbreviated. The value of the macro is a list of two-item pairs
of the form:

\begin{demo}
  \marg{remaining text}\marg{abbrev.}
\end{demo}

\DescribeMacro\abb@new
|\abb@new|\marg{class} creates a new abbreviation class.


\DescribeMacro\abb@add
|\abb@add|\marg{class}\marg{word}\marg{abbrev}
Adds an item to the abbreviation class. \meta{class} is the class, \meta{word}
the unabbreviated form, and \marg{abbrev} the abbreviated form.

If the unabbreviated form starts with an empty set of braces, then the given
abbreviation pair is treated as an initial-text abbreviation, which will only
abbreviate at the beginning of a text. That is, the abbrevation pairs:
\begin{demo}
\{\}Building $\rightarrow$ Bldg. \\
Building $\rightarrow$ Build.
\end{demo}
would produce abbreviations as follows:
\begin{demo}
The Building and Loan Office $\rightarrow$ The Build. and Loan Office \\
Building and Loan Office $\rightarrow$ Bldg. and Loan Office
\end{demo}


\subsection{Algorithm for Abbreviation}

\DescribeMacro\abb@abbrev
|\abb@abbrev|\marg{class}\marg{text}\marg{callback} is the entrypoint for
abbreviating a text. \meta{class} is the class, \meta{text} is the
text to abbreviate, and \meta{callback} is a callback function for the result.

Text is abbreviated by reading each word in the text, using |\find@word| from
\sec{strings}.

\begin{enumerate}
\item If it is not a word or punctuation, do not process the item and
  continue.

\item Otherwise, retrieve the list of abbreviations starting with this
word. If there are none, then continue.

\item Iterate through each of the abbreviations associated with the word,
and see if the remainder of the text to be abbreviated starts with any of
  the abbreviation texts. If so, then insert the relevant abbreviation
  text, correcting for dots as appropriate.
\end{enumerate}


\subsection{Removal of Spaces Between Dotted Initials}

\DescribeMacro\abb@initialdots
|\abb@initialdots|\marg{text}\marg{dot}\marg{callback} processes a text to
remove dots between single-letter initials. Given a text, it will convert
sequences such as ``A. A. Milne'' to ``A.A. Milne'' and ``F. 4th'' to ``F.4th''.
\meta{text} is the text to process and \meta{callback} is the callback to run on
the resulting output.

\meta{dot} is the dot character to search for. According to some abbreviation
schemes, it is desirable not to collapse spaces between single initials when the
initials refer to different classes of words.
\DescribeMacro\abb@dot
The macro |\abb@dot| can be used in the place of the period character to
indicate this differentiation between classes.

For example, the text ``Northern University Law Journal'' may be abbreviated to
``N.U. L.J.'' with only the first and third spaces collapsed, but not the second
because institution words should not be joined with publication words. This can
be implemented by abbreviating publication words with |\abb@dot| (shown here for
an abbreviation class |journal|):
\begin{demo}
|\abb@new{journal}|\\
|\abb@add{journal}{Northern}{N.}|\\
|\abb@add{journal}{University}{U.}|\\
|\abb@add{journal}{Law}{L\abb@dot}|\\
|\abb@add{journal}{Journal}{J\abb@dot}|
\end{demo}
Now when the text is abbreviated with |\abb@abbrev|, it produces:
\begin{demo}
\verb*|N. U. L\abb@dot J\abb@dot|
\end{demo}
The dot removal algorithm can now be run twice, once with a period as \meta{dot}
and once with |\abb@dot|, thereby producing the desired text.

%%
%% \iffalse filename: sortlist.dtx \fi
%%
\input driver
\thisis{sortlist}{Sorted Lists}

This package provides for insertion sorting of lists.


A list can have a condition for testing whether items ought to be included in
it. That is set with
\DescribeMacro\ListInclusionMacro
|\ListInclusionMacro|\marg{list}. A common test is that list elements must be
unique; that is done with
\DescribeMacro\ListElementsMustBeUnique
|\ListElementsMustBeUnique|\marg{list}.


\DescribeMacro\AddToList
|\AddToList|\marg{list}{element} adds an element to a list.


\DescribeMacro\ShowList
The |\ShowList|\marg{list}\marg{callback} macro executes \meta{callback} on
every item of the list, in order. \meta{callback} should be in the form of a
macro definition that accepts one argument, which will be set to the list item.


\subsection{Sorting Functions}

As explained above, sorted lists require a sorting function that takes two
parameters and sets |\ifCompReverse| if the elements are in the wrong sorting
order.

The following macros provide some standard sorting functions. Each will
take two additional arguments besides the ones described, which will be the list
elements for testing.

\DescribeMacro\ReverseSort
|\ReverseSort|\marg{test} performs \meta{test} on the list elements and gives
the reverse result.


\DescribeMacro\SortNum
|\SortNum| sorts elements numerically; all elements must be numbers.


\DescribeMacro\NoSort
|\NoSort| performs no sorting, meaning that elements are listed in reverse order
of addition. (Consider using |\ReverseSort| to get elements in original order of
addition.)


\DescribeMacro\SortLen
|\SortLen| sorts elements by their length, counted by number of tokens.


\DescribeMacro\SortEasyAlpha
|\SortEasyAlpha| sorts simple text elements alphabetically. Its input ought to
have been converted by |\StripForAlpha| first.


\DescribeMacro\StripForAlpha
|\StripForAlpha|\marg{text}\marg{callback} is a helpful function to precede
alphabetical sorting. It takes \meta{text}, uppercases it, and removes all
non-alphabetical characters from it. It also pads numbers of fewer than four
digits, so that ``Volume 3'' is sorted before ``Volume 14''.


\DescribeMacro\SortAlpha
|\SortAlpha| sorts elements alphabetically, after they have been stripped of
non-alphabetical characters. (This macro is probably outdated in view of
|\SortEasyAlpha| and |\StripForAlpha|.)

%%
%% \iffalse filename: hibib.dtx \fi
%%
\input driver
\thisis{hibib}{Biblatex Compatibility}

Because metadata for legal citations is more structured and complex than for
other citation systems, \hia* does not use Biblatex files as its primary input
format. However, the |hibib| package provides a compatibility layer that
uses Biblatex to process |.bib| files into \hia* data structures. The package
also enables rudimentary production of |.bib| files from \hia* reference
definitions.


\subsection{Producing Biblatex Files}

\DescribeMacro\hiBibFile
The |\hiBibFile|\marg{file} macro initiates production of a Biblatex file. The
command should be called before any \hia* references are defined.


\subsection{Reading a Biblatex File}

To use a Biblatex file for input, include it using the usual |\addbibresource|
command. The |hibib| package patches Biblatex's input commands so that each time
a reference is read, a corresponding \hia* reference is defined.

Note that for Biblatex to operate, the |.tex| file must be compiled first to
produce a |.bcf| file, which is then processed through the |biber| program to
produce a |.bbl| file that actually provides reference definitions. This package
requires the same process. The document with citation commands must be compiled
first, producing warnings about unknown references for every citation. Then
|biber| may be called and the document recompiled.


\paragraph{Saving Biblatex Entries in \hia* Format}

\DescribeMacro\hiBibConvert
The |\hiBibConvert|\marg{file} macro constructs a \hia* format reference file
based on any Biblatex entries read. This command should be called before any
entries are read via |\addbibresource|.


\subsection{Citation Command Compatibility}

Biblatex uses different commands for inserting citations. Fundamentally there
cannot be straightforward compatibility between those commands and \hia*,
because the underlying data model of citations is different. Nevertheless, some
partial compatibility is provided for the |\autocite| and |\autocites| commands,
which could help with automatic conversion of Pandoc markdown documents.

\clearpage
\appendix
\part{Appendix}
\label{p:appendix}
%%
%% \iffalse filename: conclusion.dtx \fi
%%

\PrintIndex

\end{document}
\endinput
%%
%% End of file `manual/hicite.tex'.
